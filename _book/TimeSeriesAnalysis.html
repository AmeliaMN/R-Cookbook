<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>14 Time Series Analysis | R Cookbook, 2nd Edition</title>
  <meta name="description" content="Second edition of R Cookbook" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="14 Time Series Analysis | R Cookbook, 2nd Edition" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Second edition of R Cookbook" />
  <meta name="github-repo" content="CerebralMastication/R-Cookbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="14 Time Series Analysis | R Cookbook, 2nd Edition" />
  
  <meta name="twitter:description" content="Second edition of R Cookbook" />
  

<meta name="author" content="James (JD) Long" />
<meta name="author" content="Paul Teetor" />


<meta name="date" content="2024-11-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="BeyondBasics.html"/>
<link rel="next" href="SimpleProgramming.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-129487349-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-129487349-3');
</script>



<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">R Cookbook 2nd Edition</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome to the R Cookbook 2nd Edition</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#the-recipes"><i class="fa fa-check"></i>The Recipes</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#a-note-on-terminology"><i class="fa fa-check"></i>A Note on Terminology</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-and-platform-notes"><i class="fa fa-check"></i>Software and Platform Notes</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-resources"><i class="fa fa-check"></i>Other Resources</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#conventions-used-in-this-book"><i class="fa fa-check"></i>Conventions Used in This Book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#using-code-examples"><i class="fa fa-check"></i>Using Code Examples</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#safari-books-online"><i class="fa fa-check"></i>Safari® Books Online</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-contact-us"><i class="fa fa-check"></i>How to Contact Us</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="GettingStarted.html"><a href="GettingStarted.html"><i class="fa fa-check"></i><b>1</b> Getting Started and Getting Help</a>
<ul>
<li class="chapter" data-level="" data-path="GettingStarted.html"><a href="GettingStarted.html#intro-GettingStarted"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1.1" data-path="GettingStarted.html"><a href="GettingStarted.html#recipe-id001"><i class="fa fa-check"></i><b>1.1</b> Downloading and Installing R</a></li>
<li class="chapter" data-level="1.2" data-path="GettingStarted.html"><a href="GettingStarted.html#recipe-id002b"><i class="fa fa-check"></i><b>1.2</b> Installing RStudio</a></li>
<li class="chapter" data-level="1.3" data-path="GettingStarted.html"><a href="GettingStarted.html#recipe-startingrstudio"><i class="fa fa-check"></i><b>1.3</b> Starting RStudio</a></li>
<li class="chapter" data-level="1.4" data-path="GettingStarted.html"><a href="GettingStarted.html#recipe-id007"><i class="fa fa-check"></i><b>1.4</b> Entering Commands</a></li>
<li class="chapter" data-level="1.5" data-path="GettingStarted.html"><a href="GettingStarted.html#recipe-id097"><i class="fa fa-check"></i><b>1.5</b> Exiting from RStudio</a></li>
<li class="chapter" data-level="1.6" data-path="GettingStarted.html"><a href="GettingStarted.html#recipe-id100"><i class="fa fa-check"></i><b>1.6</b> Interrupting R</a></li>
<li class="chapter" data-level="1.7" data-path="GettingStarted.html"><a href="GettingStarted.html#recipe-id265"><i class="fa fa-check"></i><b>1.7</b> Viewing the Supplied Documentation</a></li>
<li class="chapter" data-level="1.8" data-path="GettingStarted.html"><a href="GettingStarted.html#recipe-id003"><i class="fa fa-check"></i><b>1.8</b> Getting Help on a Function</a></li>
<li class="chapter" data-level="1.9" data-path="GettingStarted.html"><a href="GettingStarted.html#recipe-id267"><i class="fa fa-check"></i><b>1.9</b> Searching the Supplied Documentation</a></li>
<li class="chapter" data-level="1.10" data-path="GettingStarted.html"><a href="GettingStarted.html#recipe-id266"><i class="fa fa-check"></i><b>1.10</b> Getting Help on a Package</a></li>
<li class="chapter" data-level="1.11" data-path="GettingStarted.html"><a href="GettingStarted.html#recipe-id005"><i class="fa fa-check"></i><b>1.11</b> Searching the Web for Help</a></li>
<li class="chapter" data-level="1.12" data-path="GettingStarted.html"><a href="GettingStarted.html#recipe-id270"><i class="fa fa-check"></i><b>1.12</b> Finding Relevant Functions and Packages</a></li>
<li class="chapter" data-level="1.13" data-path="GettingStarted.html"><a href="GettingStarted.html#recipe-id268"><i class="fa fa-check"></i><b>1.13</b> Searching the Mailing Lists</a></li>
<li class="chapter" data-level="1.14" data-path="GettingStarted.html"><a href="GettingStarted.html#recipe-id269"><i class="fa fa-check"></i><b>1.14</b> Submitting Questions to Stack Overflow or Elsewhere in the Community</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="SomeBasics.html"><a href="SomeBasics.html"><i class="fa fa-check"></i><b>2</b> Some Basics</a>
<ul>
<li class="chapter" data-level="" data-path="SomeBasics.html"><a href="SomeBasics.html#intro-SomeBasics"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="2.1" data-path="SomeBasics.html"><a href="SomeBasics.html#recipe-id017"><i class="fa fa-check"></i><b>2.1</b> Printing Something to the Screen</a></li>
<li class="chapter" data-level="2.2" data-path="SomeBasics.html"><a href="SomeBasics.html#recipe-id016"><i class="fa fa-check"></i><b>2.2</b> Setting Variables</a></li>
<li class="chapter" data-level="2.3" data-path="SomeBasics.html"><a href="SomeBasics.html#recipe-id091"><i class="fa fa-check"></i><b>2.3</b> Listing Variables</a></li>
<li class="chapter" data-level="2.4" data-path="SomeBasics.html"><a href="SomeBasics.html#recipe-id075"><i class="fa fa-check"></i><b>2.4</b> Deleting Variables</a></li>
<li class="chapter" data-level="2.5" data-path="SomeBasics.html"><a href="SomeBasics.html#recipe-id038"><i class="fa fa-check"></i><b>2.5</b> Creating a Vector</a></li>
<li class="chapter" data-level="2.6" data-path="SomeBasics.html"><a href="SomeBasics.html#recipe-id101"><i class="fa fa-check"></i><b>2.6</b> Computing Basic Statistics</a></li>
<li class="chapter" data-level="2.7" data-path="SomeBasics.html"><a href="SomeBasics.html#recipe-id021"><i class="fa fa-check"></i><b>2.7</b> Creating Sequences</a></li>
<li class="chapter" data-level="2.8" data-path="SomeBasics.html"><a href="SomeBasics.html#recipe-id020"><i class="fa fa-check"></i><b>2.8</b> Comparing Vectors</a></li>
<li class="chapter" data-level="2.9" data-path="SomeBasics.html"><a href="SomeBasics.html#recipe-id039"><i class="fa fa-check"></i><b>2.9</b> Selecting Vector Elements</a></li>
<li class="chapter" data-level="2.10" data-path="SomeBasics.html"><a href="SomeBasics.html#recipe-id019"><i class="fa fa-check"></i><b>2.10</b> Performing Vector Arithmetic</a></li>
<li class="chapter" data-level="2.11" data-path="SomeBasics.html"><a href="SomeBasics.html#recipe-id018"><i class="fa fa-check"></i><b>2.11</b> Getting Operator Precedence Right</a></li>
<li class="chapter" data-level="2.12" data-path="SomeBasics.html"><a href="SomeBasics.html#recipe-id022"><i class="fa fa-check"></i><b>2.12</b> Typing Less and Accomplishing More</a></li>
<li class="chapter" data-level="2.13" data-path="SomeBasics.html"><a href="SomeBasics.html#recipe-pipe-2"><i class="fa fa-check"></i><b>2.13</b> Creating a Pipeline of Function Calls</a></li>
<li class="chapter" data-level="2.14" data-path="SomeBasics.html"><a href="SomeBasics.html#recipe-id025"><i class="fa fa-check"></i><b>2.14</b> Avoiding Some Common Mistakes</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html"><i class="fa fa-check"></i><b>3</b> Navigating the Software</a>
<ul>
<li class="chapter" data-level="" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#intro-NavigatingTheSoftware"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="3.1" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#recipe-id008"><i class="fa fa-check"></i><b>3.1</b> Getting and Setting the Working Directory</a></li>
<li class="chapter" data-level="3.2" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#recipe-CreateProject"><i class="fa fa-check"></i><b>3.2</b> Creating a New RStudio Project</a></li>
<li class="chapter" data-level="3.3" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#recipe-id009"><i class="fa fa-check"></i><b>3.3</b> Saving Your Workspace</a></li>
<li class="chapter" data-level="3.4" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#recipe-id023"><i class="fa fa-check"></i><b>3.4</b> Viewing Your Command History</a></li>
<li class="chapter" data-level="3.5" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#recipe-id024"><i class="fa fa-check"></i><b>3.5</b> Saving the Result of the Previous Command</a></li>
<li class="chapter" data-level="3.6" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#recipe-id010"><i class="fa fa-check"></i><b>3.6</b> Displaying Loaded Packages via the Search Path</a></li>
<li class="chapter" data-level="3.7" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#recipe-id094"><i class="fa fa-check"></i><b>3.7</b> Viewing the List of Installed Packages</a></li>
<li class="chapter" data-level="3.8" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#recipe-id013"><i class="fa fa-check"></i><b>3.8</b> Accessing the Functions in a Package</a></li>
<li class="chapter" data-level="3.9" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#recipe-id257"><i class="fa fa-check"></i><b>3.9</b> Accessing Built-in Datasets</a></li>
<li class="chapter" data-level="3.10" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#recipe-id012"><i class="fa fa-check"></i><b>3.10</b> Installing Packages from CRAN</a></li>
<li class="chapter" data-level="3.11" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#recipe-installGH"><i class="fa fa-check"></i><b>3.11</b> Installing a Package from GitHub</a></li>
<li class="chapter" data-level="3.12" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#recipe-id272"><i class="fa fa-check"></i><b>3.12</b> Setting or Changing a Default CRAN Mirror</a></li>
<li class="chapter" data-level="3.13" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#recipe-id014"><i class="fa fa-check"></i><b>3.13</b> Running a Script</a></li>
<li class="chapter" data-level="3.14" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#recipe-id015"><i class="fa fa-check"></i><b>3.14</b> Running a Batch Script</a></li>
<li class="chapter" data-level="3.15" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#recipe-id102"><i class="fa fa-check"></i><b>3.15</b> Locating the R Home Directory</a></li>
<li class="chapter" data-level="3.16" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#recipe-id099"><i class="fa fa-check"></i><b>3.16</b> Customizing R Startup</a></li>
<li class="chapter" data-level="3.17" data-path="NavigatingTheSoftware.html"><a href="NavigatingTheSoftware.html#recipe-Rcloud"><i class="fa fa-check"></i><b>3.17</b> Using R and RStudio in the Cloud</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="InputAndOutput.html"><a href="InputAndOutput.html"><i class="fa fa-check"></i><b>4</b> Input and Output</a>
<ul>
<li class="chapter" data-level="" data-path="InputAndOutput.html"><a href="InputAndOutput.html#intro-InputAndOutput"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="4.1" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-id035"><i class="fa fa-check"></i><b>4.1</b> Entering Data from the Keyboard</a></li>
<li class="chapter" data-level="4.2" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-id036"><i class="fa fa-check"></i><b>4.2</b> Printing Fewer Digits (or More Digits)</a></li>
<li class="chapter" data-level="4.3" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-id034"><i class="fa fa-check"></i><b>4.3</b> Redirecting Output to a File</a></li>
<li class="chapter" data-level="4.4" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-id030"><i class="fa fa-check"></i><b>4.4</b> Listing Files</a></li>
<li class="chapter" data-level="4.5" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-id033"><i class="fa fa-check"></i><b>4.5</b> Dealing with “Cannot Open File” in Windows</a></li>
<li class="chapter" data-level="4.6" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-id136"><i class="fa fa-check"></i><b>4.6</b> Reading Fixed-Width Records</a></li>
<li class="chapter" data-level="4.7" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-id245"><i class="fa fa-check"></i><b>4.7</b> Reading Tabular Data Files</a></li>
<li class="chapter" data-level="4.8" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-id027"><i class="fa fa-check"></i><b>4.8</b> Reading from CSV Files</a></li>
<li class="chapter" data-level="4.9" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-id028"><i class="fa fa-check"></i><b>4.9</b> Writing to CSV Files</a></li>
<li class="chapter" data-level="4.10" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-id031"><i class="fa fa-check"></i><b>4.10</b> Reading Tabular or CSV Data from the Web</a></li>
<li class="chapter" data-level="4.11" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-readexcel"><i class="fa fa-check"></i><b>4.11</b> Reading Data from Excel</a></li>
<li class="chapter" data-level="4.12" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-writeexcel"><i class="fa fa-check"></i><b>4.12</b> Writing a Data Frame to Excel</a></li>
<li class="chapter" data-level="4.13" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-readsas"><i class="fa fa-check"></i><b>4.13</b> Reading Data from a SAS file</a></li>
<li class="chapter" data-level="4.14" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-id246"><i class="fa fa-check"></i><b>4.14</b> Reading Data from HTML Tables</a></li>
<li class="chapter" data-level="4.15" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-id098"><i class="fa fa-check"></i><b>4.15</b> Reading Files with a Complex Structure</a></li>
<li class="chapter" data-level="4.16" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-id037"><i class="fa fa-check"></i><b>4.16</b> Reading from MySQL Databases</a></li>
<li class="chapter" data-level="4.17" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-dbplyr"><i class="fa fa-check"></i><b>4.17</b> Accessing a Database with dbplyr</a></li>
<li class="chapter" data-level="4.18" data-path="InputAndOutput.html"><a href="InputAndOutput.html#recipe-id029"><i class="fa fa-check"></i><b>4.18</b> Saving and Transporting Objects</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="DataStructures.html"><a href="DataStructures.html"><i class="fa fa-check"></i><b>5</b> Data Structures</a>
<ul>
<li class="chapter" data-level="" data-path="DataStructures.html"><a href="DataStructures.html#intro-DataStructures"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="5.1" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id048"><i class="fa fa-check"></i><b>5.1</b> Appending Data to a Vector</a></li>
<li class="chapter" data-level="5.2" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id049"><i class="fa fa-check"></i><b>5.2</b> Inserting Data into a Vector</a></li>
<li class="chapter" data-level="5.3" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id050"><i class="fa fa-check"></i><b>5.3</b> Understanding the Recycling Rule</a></li>
<li class="chapter" data-level="5.4" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id051"><i class="fa fa-check"></i><b>5.4</b> Creating a Factor (Categorical Variable)</a></li>
<li class="chapter" data-level="5.5" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id227"><i class="fa fa-check"></i><b>5.5</b> Combining Multiple Vectors into One Vector and a Factor</a></li>
<li class="chapter" data-level="5.6" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id053"><i class="fa fa-check"></i><b>5.6</b> Creating a List</a></li>
<li class="chapter" data-level="5.7" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id054"><i class="fa fa-check"></i><b>5.7</b> Selecting List Elements by Position</a></li>
<li class="chapter" data-level="5.8" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id253"><i class="fa fa-check"></i><b>5.8</b> Selecting List Elements by Name</a></li>
<li class="chapter" data-level="5.9" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id158"><i class="fa fa-check"></i><b>5.9</b> Building a Name/Value Association List</a></li>
<li class="chapter" data-level="5.10" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id056"><i class="fa fa-check"></i><b>5.10</b> Removing an Element from a List</a></li>
<li class="chapter" data-level="5.11" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id152"><i class="fa fa-check"></i><b>5.11</b> Flatten a List into a Vector</a></li>
<li class="chapter" data-level="5.12" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id058"><i class="fa fa-check"></i><b>5.12</b> Removing NULL Elements from a List</a></li>
<li class="chapter" data-level="5.13" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id060"><i class="fa fa-check"></i><b>5.13</b> Removing List Elements Using a Condition</a></li>
<li class="chapter" data-level="5.14" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id062"><i class="fa fa-check"></i><b>5.14</b> Initializing a Matrix</a></li>
<li class="chapter" data-level="5.15" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id139"><i class="fa fa-check"></i><b>5.15</b> Performing Matrix Operations</a></li>
<li class="chapter" data-level="5.16" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id063"><i class="fa fa-check"></i><b>5.16</b> Giving Descriptive Names to the Rows and Columns of a Matrix</a></li>
<li class="chapter" data-level="5.17" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id250"><i class="fa fa-check"></i><b>5.17</b> Selecting One Row or Column from a Matrix</a></li>
<li class="chapter" data-level="5.18" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id251"><i class="fa fa-check"></i><b>5.18</b> Initializing a Data Frame from Column Data</a></li>
<li class="chapter" data-level="5.19" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id252"><i class="fa fa-check"></i><b>5.19</b> Initializing a Data Frame from Row Data</a></li>
<li class="chapter" data-level="5.20" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id071"><i class="fa fa-check"></i><b>5.20</b> Appending Rows to a Data Frame</a></li>
<li class="chapter" data-level="5.21" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id068"><i class="fa fa-check"></i><b>5.21</b> Selecting Data Frame Columns by Position</a></li>
<li class="chapter" data-level="5.22" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id254"><i class="fa fa-check"></i><b>5.22</b> Selecting Data Frame Columns by Name</a></li>
<li class="chapter" data-level="5.23" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id069"><i class="fa fa-check"></i><b>5.23</b> Changing the Names of Data Frame Columns</a></li>
<li class="chapter" data-level="5.24" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id249"><i class="fa fa-check"></i><b>5.24</b> Removing NAs from a Data Frame</a></li>
<li class="chapter" data-level="5.25" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id072"><i class="fa fa-check"></i><b>5.25</b> Excluding Columns by Name</a></li>
<li class="chapter" data-level="5.26" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id155"><i class="fa fa-check"></i><b>5.26</b> Combining Two Data Frames</a></li>
<li class="chapter" data-level="5.27" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id057"><i class="fa fa-check"></i><b>5.27</b> Merging Data Frames by Common Column</a></li>
<li class="chapter" data-level="5.28" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id248"><i class="fa fa-check"></i><b>5.28</b> Converting One Atomic Value into Another</a></li>
<li class="chapter" data-level="5.29" data-path="DataStructures.html"><a href="DataStructures.html#recipe-id074"><i class="fa fa-check"></i><b>5.29</b> Converting One Structured Data Type into Another</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="DataTransformations.html"><a href="DataTransformations.html"><i class="fa fa-check"></i><b>6</b> Data Transformations</a>
<ul>
<li class="chapter" data-level="" data-path="DataTransformations.html"><a href="DataTransformations.html#intro-DataTransformations"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="6.1" data-path="DataTransformations.html"><a href="DataTransformations.html#recipe-id149"><i class="fa fa-check"></i><b>6.1</b> Applying a Function to Each List Element</a></li>
<li class="chapter" data-level="6.2" data-path="DataTransformations.html"><a href="DataTransformations.html#recipe-row_df"><i class="fa fa-check"></i><b>6.2</b> Applying a Function to Every Row of a Data Frame</a></li>
<li class="chapter" data-level="6.3" data-path="DataTransformations.html"><a href="DataTransformations.html#recipe-id146"><i class="fa fa-check"></i><b>6.3</b> Applying a Function to Every Row of a Matrix</a></li>
<li class="chapter" data-level="6.4" data-path="DataTransformations.html"><a href="DataTransformations.html#recipe-id157"><i class="fa fa-check"></i><b>6.4</b> Applying a Function to Every Column</a></li>
<li class="chapter" data-level="6.5" data-path="DataTransformations.html"><a href="DataTransformations.html#recipe-id275"><i class="fa fa-check"></i><b>6.5</b> Applying a Function to Parallel Vectors or Lists</a></li>
<li class="chapter" data-level="6.6" data-path="DataTransformations.html"><a href="DataTransformations.html#recipe-id148"><i class="fa fa-check"></i><b>6.6</b> Applying a Function to Groups of Data</a></li>
<li class="chapter" data-level="6.7" data-path="DataTransformations.html"><a href="DataTransformations.html#recipe-casewhen"><i class="fa fa-check"></i><b>6.7</b> Creating a New Column Based on Some Condition</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="StringsAndDates.html"><a href="StringsAndDates.html"><i class="fa fa-check"></i><b>7</b> Strings and Dates</a>
<ul>
<li class="chapter" data-level="" data-path="StringsAndDates.html"><a href="StringsAndDates.html#I_sect17_d1e17434"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="7.1" data-path="StringsAndDates.html"><a href="StringsAndDates.html#recipe-id093"><i class="fa fa-check"></i><b>7.1</b> Getting the Length of a String</a></li>
<li class="chapter" data-level="7.2" data-path="StringsAndDates.html"><a href="StringsAndDates.html#recipe-id040"><i class="fa fa-check"></i><b>7.2</b> Concatenating Strings</a></li>
<li class="chapter" data-level="7.3" data-path="StringsAndDates.html"><a href="StringsAndDates.html#recipe-id041"><i class="fa fa-check"></i><b>7.3</b> Extracting Substrings</a></li>
<li class="chapter" data-level="7.4" data-path="StringsAndDates.html"><a href="StringsAndDates.html#recipe-id276"><i class="fa fa-check"></i><b>7.4</b> Splitting a String According to a Delimiter</a></li>
<li class="chapter" data-level="7.5" data-path="StringsAndDates.html"><a href="StringsAndDates.html#recipe-id277"><i class="fa fa-check"></i><b>7.5</b> Replacing Substrings</a></li>
<li class="chapter" data-level="7.6" data-path="StringsAndDates.html"><a href="StringsAndDates.html#recipe-id109"><i class="fa fa-check"></i><b>7.6</b> Generating All Pairwise Combinations of Strings</a></li>
<li class="chapter" data-level="7.7" data-path="StringsAndDates.html"><a href="StringsAndDates.html#recipe-id045"><i class="fa fa-check"></i><b>7.7</b> Getting the Current Date</a></li>
<li class="chapter" data-level="7.8" data-path="StringsAndDates.html"><a href="StringsAndDates.html#recipe-id043"><i class="fa fa-check"></i><b>7.8</b> Converting a String into a Date</a></li>
<li class="chapter" data-level="7.9" data-path="StringsAndDates.html"><a href="StringsAndDates.html#recipe-id044"><i class="fa fa-check"></i><b>7.9</b> Converting a Date into a String</a></li>
<li class="chapter" data-level="7.10" data-path="StringsAndDates.html"><a href="StringsAndDates.html#recipe-id241"><i class="fa fa-check"></i><b>7.10</b> Converting Year, Month, and Day into a Date</a></li>
<li class="chapter" data-level="7.11" data-path="StringsAndDates.html"><a href="StringsAndDates.html#recipe-id042"><i class="fa fa-check"></i><b>7.11</b> Getting the Julian Date</a></li>
<li class="chapter" data-level="7.12" data-path="StringsAndDates.html"><a href="StringsAndDates.html#recipe-id046"><i class="fa fa-check"></i><b>7.12</b> Extracting the Parts of a Date</a></li>
<li class="chapter" data-level="7.13" data-path="StringsAndDates.html"><a href="StringsAndDates.html#recipe-id047"><i class="fa fa-check"></i><b>7.13</b> Creating a Sequence of Dates</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="Probability.html"><a href="Probability.html"><i class="fa fa-check"></i><b>8</b> Probability</a>
<ul>
<li class="chapter" data-level="" data-path="Probability.html"><a href="Probability.html#intro-Probability"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="8.1" data-path="Probability.html"><a href="Probability.html#recipe-id163"><i class="fa fa-check"></i><b>8.1</b> Counting the Number of Combinations</a></li>
<li class="chapter" data-level="8.2" data-path="Probability.html"><a href="Probability.html#recipe-id198"><i class="fa fa-check"></i><b>8.2</b> Generating Combinations</a></li>
<li class="chapter" data-level="8.3" data-path="Probability.html"><a href="Probability.html#recipe-id165"><i class="fa fa-check"></i><b>8.3</b> Generating Random Numbers</a></li>
<li class="chapter" data-level="8.4" data-path="Probability.html"><a href="Probability.html#recipe-id201"><i class="fa fa-check"></i><b>8.4</b> Generating Reproducible Random Numbers</a></li>
<li class="chapter" data-level="8.5" data-path="Probability.html"><a href="Probability.html#recipe-id199"><i class="fa fa-check"></i><b>8.5</b> Generating a Random Sample</a></li>
<li class="chapter" data-level="8.6" data-path="Probability.html"><a href="Probability.html#recipe-id200"><i class="fa fa-check"></i><b>8.6</b> Generating Random Sequences</a></li>
<li class="chapter" data-level="8.7" data-path="Probability.html"><a href="Probability.html#recipe-id151"><i class="fa fa-check"></i><b>8.7</b> Randomly Permuting a Vector</a></li>
<li class="chapter" data-level="8.8" data-path="Probability.html"><a href="Probability.html#recipe-id196"><i class="fa fa-check"></i><b>8.8</b> Calculating Probabilities for Discrete Distributions</a></li>
<li class="chapter" data-level="8.9" data-path="Probability.html"><a href="Probability.html#recipe-id197"><i class="fa fa-check"></i><b>8.9</b> Calculating Probabilities for Continuous Distributions</a></li>
<li class="chapter" data-level="8.10" data-path="Probability.html"><a href="Probability.html#recipe-id168"><i class="fa fa-check"></i><b>8.10</b> Converting Probabilities to Quantiles</a></li>
<li class="chapter" data-level="8.11" data-path="Probability.html"><a href="Probability.html#recipe-id166"><i class="fa fa-check"></i><b>8.11</b> Plotting a Density Function</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html"><i class="fa fa-check"></i><b>9</b> General Statistics</a>
<ul>
<li class="chapter" data-level="" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#intro-GeneralStatistics"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="9.1" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id119"><i class="fa fa-check"></i><b>9.1</b> Summarizing Your Data</a></li>
<li class="chapter" data-level="9.2" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id229"><i class="fa fa-check"></i><b>9.2</b> Calculating Relative Frequencies</a></li>
<li class="chapter" data-level="9.3" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id124"><i class="fa fa-check"></i><b>9.3</b> Tabulating Factors and Creating Contingency Tables</a></li>
<li class="chapter" data-level="9.4" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id125"><i class="fa fa-check"></i><b>9.4</b> Testing Categorical Variables for Independence</a></li>
<li class="chapter" data-level="9.5" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id143"><i class="fa fa-check"></i><b>9.5</b> Calculating Quantiles (and Quartiles) of a Dataset</a></li>
<li class="chapter" data-level="9.6" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id142"><i class="fa fa-check"></i><b>9.6</b> Inverting a Quantile</a></li>
<li class="chapter" data-level="9.7" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id133"><i class="fa fa-check"></i><b>9.7</b> Converting Data to z-Scores</a></li>
<li class="chapter" data-level="9.8" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id121"><i class="fa fa-check"></i><b>9.8</b> Testing the Mean of a Sample (t Test)</a></li>
<li class="chapter" data-level="9.9" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id123"><i class="fa fa-check"></i><b>9.9</b> Forming a Confidence Interval for a Mean</a></li>
<li class="chapter" data-level="9.10" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id135"><i class="fa fa-check"></i><b>9.10</b> Forming a Confidence Interval for a Median</a></li>
<li class="chapter" data-level="9.11" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id225"><i class="fa fa-check"></i><b>9.11</b> Testing a Sample Proportion</a></li>
<li class="chapter" data-level="9.12" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id226"><i class="fa fa-check"></i><b>9.12</b> Forming a Confidence Interval for a Proportion</a></li>
<li class="chapter" data-level="9.13" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id126"><i class="fa fa-check"></i><b>9.13</b> Testing for Normality</a></li>
<li class="chapter" data-level="9.14" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id131"><i class="fa fa-check"></i><b>9.14</b> Testing for Runs</a></li>
<li class="chapter" data-level="9.15" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id122"><i class="fa fa-check"></i><b>9.15</b> Comparing the Means of Two Samples</a></li>
<li class="chapter" data-level="9.16" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id130"><i class="fa fa-check"></i><b>9.16</b> Comparing the Locations of Two Samples Nonparametrically</a></li>
<li class="chapter" data-level="9.17" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id132"><i class="fa fa-check"></i><b>9.17</b> Testing a Correlation for Significance</a></li>
<li class="chapter" data-level="9.18" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id134"><i class="fa fa-check"></i><b>9.18</b> Testing Groups for Equal Proportions</a></li>
<li class="chapter" data-level="9.19" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id127"><i class="fa fa-check"></i><b>9.19</b> Performing Pairwise Comparisons Between Group Means</a></li>
<li class="chapter" data-level="9.20" data-path="GeneralStatistics.html"><a href="GeneralStatistics.html#recipe-id129"><i class="fa fa-check"></i><b>9.20</b> Testing Two Samples for the Same Distribution</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Graphics.html"><a href="Graphics.html"><i class="fa fa-check"></i><b>10</b> Graphics</a>
<ul>
<li class="chapter" data-level="" data-path="Graphics.html"><a href="Graphics.html#intro-Graphics"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="10.1" data-path="Graphics.html"><a href="Graphics.html#recipe-id171"><i class="fa fa-check"></i><b>10.1</b> Creating a Scatter Plot</a></li>
<li class="chapter" data-level="10.2" data-path="Graphics.html"><a href="Graphics.html#recipe-id259"><i class="fa fa-check"></i><b>10.2</b> Adding a Title and Labels</a></li>
<li class="chapter" data-level="10.3" data-path="Graphics.html"><a href="Graphics.html#recipe-id261"><i class="fa fa-check"></i><b>10.3</b> Adding (or Removing) a Grid</a></li>
<li class="chapter" data-level="10.4" data-path="Graphics.html"><a href="Graphics.html#recipe-theme"><i class="fa fa-check"></i><b>10.4</b> Applying a Theme to a ggplot Figure</a></li>
<li class="chapter" data-level="10.5" data-path="Graphics.html"><a href="Graphics.html#recipe-id262"><i class="fa fa-check"></i><b>10.5</b> Creating a Scatter Plot of Multiple Groups</a></li>
<li class="chapter" data-level="10.6" data-path="Graphics.html"><a href="Graphics.html#recipe-id260"><i class="fa fa-check"></i><b>10.6</b> Adding (or Removing) a Legend</a></li>
<li class="chapter" data-level="10.7" data-path="Graphics.html"><a href="Graphics.html#recipe-id217"><i class="fa fa-check"></i><b>10.7</b> Plotting the Regression Line of a Scatter Plot</a></li>
<li class="chapter" data-level="10.8" data-path="Graphics.html"><a href="Graphics.html#recipe-id184"><i class="fa fa-check"></i><b>10.8</b> Plotting All Variables Against All Other Variables</a></li>
<li class="chapter" data-level="10.9" data-path="Graphics.html"><a href="Graphics.html#recipe-id185"><i class="fa fa-check"></i><b>10.9</b> Creating One Scatter Plot for Each Group</a></li>
<li class="chapter" data-level="10.10" data-path="Graphics.html"><a href="Graphics.html#recipe-id175"><i class="fa fa-check"></i><b>10.10</b> Creating a Bar Chart</a></li>
<li class="chapter" data-level="10.11" data-path="Graphics.html"><a href="Graphics.html#recipe-id177"><i class="fa fa-check"></i><b>10.11</b> Adding Confidence Intervals to a Bar Chart</a></li>
<li class="chapter" data-level="10.12" data-path="Graphics.html"><a href="Graphics.html#recipe-id176"><i class="fa fa-check"></i><b>10.12</b> Coloring a Bar Chart</a></li>
<li class="chapter" data-level="10.13" data-path="Graphics.html"><a href="Graphics.html#recipe-id174"><i class="fa fa-check"></i><b>10.13</b> Plotting a Line from x and y Points</a></li>
<li class="chapter" data-level="10.14" data-path="Graphics.html"><a href="Graphics.html#recipe-id256"><i class="fa fa-check"></i><b>10.14</b> Changing the Type, Width, or Color of a Line</a></li>
<li class="chapter" data-level="10.15" data-path="Graphics.html"><a href="Graphics.html#recipe-id263"><i class="fa fa-check"></i><b>10.15</b> Plotting Multiple Datasets</a></li>
<li class="chapter" data-level="10.16" data-path="Graphics.html"><a href="Graphics.html#recipe-id186"><i class="fa fa-check"></i><b>10.16</b> Adding Vertical or Horizontal Lines</a></li>
<li class="chapter" data-level="10.17" data-path="Graphics.html"><a href="Graphics.html#recipe-id178"><i class="fa fa-check"></i><b>10.17</b> Creating a Boxplot</a></li>
<li class="chapter" data-level="10.18" data-path="Graphics.html"><a href="Graphics.html#recipe-id179"><i class="fa fa-check"></i><b>10.18</b> Creating One Boxplot for Each Factor Level</a></li>
<li class="chapter" data-level="10.19" data-path="Graphics.html"><a href="Graphics.html#recipe-id182"><i class="fa fa-check"></i><b>10.19</b> Creating a Histogram</a></li>
<li class="chapter" data-level="10.20" data-path="Graphics.html"><a href="Graphics.html#recipe-id183"><i class="fa fa-check"></i><b>10.20</b> Adding a Density Estimate to a Histogram</a></li>
<li class="chapter" data-level="10.21" data-path="Graphics.html"><a href="Graphics.html#recipe-id180"><i class="fa fa-check"></i><b>10.21</b> Creating a Normal Quantile–Quantile Plot</a></li>
<li class="chapter" data-level="10.22" data-path="Graphics.html"><a href="Graphics.html#recipe-id181"><i class="fa fa-check"></i><b>10.22</b> Creating Other Quantile–Quantile Plots</a></li>
<li class="chapter" data-level="10.23" data-path="Graphics.html"><a href="Graphics.html#recipe-id191"><i class="fa fa-check"></i><b>10.23</b> Plotting a Variable in Multiple Colors</a></li>
<li class="chapter" data-level="10.24" data-path="Graphics.html"><a href="Graphics.html#recipe-id192"><i class="fa fa-check"></i><b>10.24</b> Graphing a Function</a></li>
<li class="chapter" data-level="10.25" data-path="Graphics.html"><a href="Graphics.html#recipe-id190"><i class="fa fa-check"></i><b>10.25</b> Displaying Several Figures on One Page</a></li>
<li class="chapter" data-level="10.26" data-path="Graphics.html"><a href="Graphics.html#recipe-id188"><i class="fa fa-check"></i><b>10.26</b> Writing Your Plot to a File</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html"><i class="fa fa-check"></i><b>11</b> Linear Regression and ANOVA</a>
<ul>
<li class="chapter" data-level="" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#intro-LinearRegressionAndANOVA"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="11.1" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id203"><i class="fa fa-check"></i><b>11.1</b> Performing Simple Linear Regression</a></li>
<li class="chapter" data-level="11.2" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id204"><i class="fa fa-check"></i><b>11.2</b> Performing Multiple Linear Regression</a></li>
<li class="chapter" data-level="11.3" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id231"><i class="fa fa-check"></i><b>11.3</b> Getting Regression Statistics</a></li>
<li class="chapter" data-level="11.4" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id240"><i class="fa fa-check"></i><b>11.4</b> Understanding the Regression Summary</a></li>
<li class="chapter" data-level="11.5" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id205"><i class="fa fa-check"></i><b>11.5</b> Performing Linear Regression Without an Intercept</a></li>
<li class="chapter" data-level="11.6" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#title-highcor"><i class="fa fa-check"></i><b>11.6</b> Regressing Only Variables That Highly Correlate with Your Dependent Variable</a></li>
<li class="chapter" data-level="11.7" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id206"><i class="fa fa-check"></i><b>11.7</b> Performing Linear Regression with Interaction Terms</a></li>
<li class="chapter" data-level="11.8" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id236"><i class="fa fa-check"></i><b>11.8</b> Selecting the Best Regression Variables</a></li>
<li class="chapter" data-level="11.9" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id209"><i class="fa fa-check"></i><b>11.9</b> Regressing on a Subset of Your Data</a></li>
<li class="chapter" data-level="11.10" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id244"><i class="fa fa-check"></i><b>11.10</b> Using an Expression Inside a Regression Formula</a></li>
<li class="chapter" data-level="11.11" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id243"><i class="fa fa-check"></i><b>11.11</b> Regressing on a Polynomial</a></li>
<li class="chapter" data-level="11.12" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id208"><i class="fa fa-check"></i><b>11.12</b> Regressing on Transformed Data</a></li>
<li class="chapter" data-level="11.13" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id210"><i class="fa fa-check"></i><b>11.13</b> Finding the Best Power Transformation (Box–Cox Procedure)</a></li>
<li class="chapter" data-level="11.14" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id211"><i class="fa fa-check"></i><b>11.14</b> Forming Confidence Intervals for Regression Coefficients</a></li>
<li class="chapter" data-level="11.15" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id216"><i class="fa fa-check"></i><b>11.15</b> Plotting Regression Residuals</a></li>
<li class="chapter" data-level="11.16" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id212"><i class="fa fa-check"></i><b>11.16</b> Diagnosing a Linear Regression</a></li>
<li class="chapter" data-level="11.17" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id233"><i class="fa fa-check"></i><b>11.17</b> Identifying Influential Observations</a></li>
<li class="chapter" data-level="11.18" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id213"><i class="fa fa-check"></i><b>11.18</b> Testing Residuals for Autocorrelation (Durbin–Watson Test)</a></li>
<li class="chapter" data-level="11.19" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id214"><i class="fa fa-check"></i><b>11.19</b> Predicting New Values</a></li>
<li class="chapter" data-level="11.20" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id215"><i class="fa fa-check"></i><b>11.20</b> Forming Prediction Intervals</a></li>
<li class="chapter" data-level="11.21" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id218"><i class="fa fa-check"></i><b>11.21</b> Performing One-Way ANOVA</a></li>
<li class="chapter" data-level="11.22" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id221"><i class="fa fa-check"></i><b>11.22</b> Creating an Interaction Plot</a></li>
<li class="chapter" data-level="11.23" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id220"><i class="fa fa-check"></i><b>11.23</b> Finding Differences Between Means of Groups</a></li>
<li class="chapter" data-level="11.24" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id228"><i class="fa fa-check"></i><b>11.24</b> Performing Robust ANOVA (Kruskal–Wallis Test)</a></li>
<li class="chapter" data-level="11.25" data-path="LinearRegressionAndANOVA.html"><a href="LinearRegressionAndANOVA.html#recipe-id232"><i class="fa fa-check"></i><b>11.25</b> Comparing Models by Using ANOVA</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="UsefulTricks.html"><a href="UsefulTricks.html"><i class="fa fa-check"></i><b>12</b> Useful Tricks</a>
<ul>
<li class="chapter" data-level="" data-path="UsefulTricks.html"><a href="UsefulTricks.html#intro-UsefulTricks"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="12.1" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id278"><i class="fa fa-check"></i><b>12.1</b> Peeking at Your Data</a></li>
<li class="chapter" data-level="12.2" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id271"><i class="fa fa-check"></i><b>12.2</b> Printing the Result of an Assignment</a></li>
<li class="chapter" data-level="12.3" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id138"><i class="fa fa-check"></i><b>12.3</b> Summing Rows and Columns</a></li>
<li class="chapter" data-level="12.4" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id112"><i class="fa fa-check"></i><b>12.4</b> Printing Data in Columns</a></li>
<li class="chapter" data-level="12.5" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id137"><i class="fa fa-check"></i><b>12.5</b> Binning Your Data</a></li>
<li class="chapter" data-level="12.6" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id116"><i class="fa fa-check"></i><b>12.6</b> Finding the Position of a Particular Value</a></li>
<li class="chapter" data-level="12.7" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id103"><i class="fa fa-check"></i><b>12.7</b> Selecting Every nth Element of a Vector</a></li>
<li class="chapter" data-level="12.8" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id107"><i class="fa fa-check"></i><b>12.8</b> Finding Minimums or Maximums</a></li>
<li class="chapter" data-level="12.9" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id110"><i class="fa fa-check"></i><b>12.9</b> Generating All Combinations of Several Variables</a></li>
<li class="chapter" data-level="12.10" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id153"><i class="fa fa-check"></i><b>12.10</b> Flattening a Data Frame</a></li>
<li class="chapter" data-level="12.11" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id247"><i class="fa fa-check"></i><b>12.11</b> Sorting a Data Frame</a></li>
<li class="chapter" data-level="12.12" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id223"><i class="fa fa-check"></i><b>12.12</b> Stripping Attributes from a Variable</a></li>
<li class="chapter" data-level="12.13" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id202"><i class="fa fa-check"></i><b>12.13</b> Revealing the Structure of an Object</a></li>
<li class="chapter" data-level="12.14" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id224"><i class="fa fa-check"></i><b>12.14</b> Timing Your Code</a></li>
<li class="chapter" data-level="12.15" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id113"><i class="fa fa-check"></i><b>12.15</b> Suppressing Warnings and Error Messages</a></li>
<li class="chapter" data-level="12.16" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id118"><i class="fa fa-check"></i><b>12.16</b> Taking Function Arguments from a List</a></li>
<li class="chapter" data-level="12.17" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id114"><i class="fa fa-check"></i><b>12.17</b> Defining Your Own Binary Operators</a></li>
<li class="chapter" data-level="12.18" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id111"><i class="fa fa-check"></i><b>12.18</b> Suppressing the Startup Message</a></li>
<li class="chapter" data-level="12.19" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-id106"><i class="fa fa-check"></i><b>12.19</b> Getting and Setting Environment Variables</a></li>
<li class="chapter" data-level="12.20" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-codesections"><i class="fa fa-check"></i><b>12.20</b> Use Code Sections</a></li>
<li class="chapter" data-level="12.21" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-parallel_local"><i class="fa fa-check"></i><b>12.21</b> Executing R in Parallel Locally</a></li>
<li class="chapter" data-level="12.22" data-path="UsefulTricks.html"><a href="UsefulTricks.html#recipe-parallel_remote"><i class="fa fa-check"></i><b>12.22</b> Executing R in Parallel Remotely</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="BeyondBasics.html"><a href="BeyondBasics.html"><i class="fa fa-check"></i><b>13</b> Beyond Basic Numerics and Statistics</a>
<ul>
<li class="chapter" data-level="" data-path="BeyondBasics.html"><a href="BeyondBasics.html#intro-BeyondBasics"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="13.1" data-path="BeyondBasics.html"><a href="BeyondBasics.html#recipe-id234"><i class="fa fa-check"></i><b>13.1</b> Minimizing or Maximizing a Single-Parameter Function</a></li>
<li class="chapter" data-level="13.2" data-path="BeyondBasics.html"><a href="BeyondBasics.html#recipe-id235"><i class="fa fa-check"></i><b>13.2</b> Minimizing or Maximizing a Multiparameter Function</a></li>
<li class="chapter" data-level="13.3" data-path="BeyondBasics.html"><a href="BeyondBasics.html#recipe-id140"><i class="fa fa-check"></i><b>13.3</b> Calculating Eigenvalues and Eigenvectors</a></li>
<li class="chapter" data-level="13.4" data-path="BeyondBasics.html"><a href="BeyondBasics.html#recipe-id162"><i class="fa fa-check"></i><b>13.4</b> Performing Principal Component Analysis</a></li>
<li class="chapter" data-level="13.5" data-path="BeyondBasics.html"><a href="BeyondBasics.html#recipe-id264"><i class="fa fa-check"></i><b>13.5</b> Performing Simple Orthogonal Regression</a></li>
<li class="chapter" data-level="13.6" data-path="BeyondBasics.html"><a href="BeyondBasics.html#recipe-id160"><i class="fa fa-check"></i><b>13.6</b> Finding Clusters in Your Data</a></li>
<li class="chapter" data-level="13.7" data-path="BeyondBasics.html"><a href="BeyondBasics.html#recipe-id161"><i class="fa fa-check"></i><b>13.7</b> Predicting a Binary-Valued Variable (Logistic Regression)</a></li>
<li class="chapter" data-level="13.8" data-path="BeyondBasics.html"><a href="BeyondBasics.html#recipe-id159"><i class="fa fa-check"></i><b>13.8</b> Bootstrapping a Statistic</a></li>
<li class="chapter" data-level="13.9" data-path="BeyondBasics.html"><a href="BeyondBasics.html#recipe-id193"><i class="fa fa-check"></i><b>13.9</b> Factor Analysis</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html"><i class="fa fa-check"></i><b>14</b> Time Series Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#introduction"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="14.1" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id076"><i class="fa fa-check"></i><b>14.1</b> Representing Time Series Data</a></li>
<li class="chapter" data-level="14.2" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id089"><i class="fa fa-check"></i><b>14.2</b> Plotting Time Series Data</a></li>
<li class="chapter" data-level="14.3" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id077"><i class="fa fa-check"></i><b>14.3</b> Extracting the Oldest or Newest Observations</a></li>
<li class="chapter" data-level="14.4" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id281"><i class="fa fa-check"></i><b>14.4</b> Subsetting a Time Series</a></li>
<li class="chapter" data-level="14.5" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id079"><i class="fa fa-check"></i><b>14.5</b> Merging Several Time Series</a></li>
<li class="chapter" data-level="14.6" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id239"><i class="fa fa-check"></i><b>14.6</b> Filling or Padding a Time Series</a></li>
<li class="chapter" data-level="14.7" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id280"><i class="fa fa-check"></i><b>14.7</b> Lagging a Time Series</a></li>
<li class="chapter" data-level="14.8" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id141"><i class="fa fa-check"></i><b>14.8</b> Computing Successive Differences</a></li>
<li class="chapter" data-level="14.9" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id080"><i class="fa fa-check"></i><b>14.9</b> Performing Calculations on Time Series</a></li>
<li class="chapter" data-level="14.10" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id279"><i class="fa fa-check"></i><b>14.10</b> Computing a Moving Average</a></li>
<li class="chapter" data-level="14.11" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id282"><i class="fa fa-check"></i><b>14.11</b> Applying a Function by Calendar Period</a></li>
<li class="chapter" data-level="14.12" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id081"><i class="fa fa-check"></i><b>14.12</b> Applying a Rolling Function</a></li>
<li class="chapter" data-level="14.13" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id082"><i class="fa fa-check"></i><b>14.13</b> Plotting the Autocorrelation Function</a></li>
<li class="chapter" data-level="14.14" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id104"><i class="fa fa-check"></i><b>14.14</b> Testing a Time Series for Autocorrelation</a></li>
<li class="chapter" data-level="14.15" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id083"><i class="fa fa-check"></i><b>14.15</b> Plotting the Partial Autocorrelation Function</a></li>
<li class="chapter" data-level="14.16" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id084"><i class="fa fa-check"></i><b>14.16</b> Finding Lagged Correlations Between Two Time Series</a></li>
<li class="chapter" data-level="14.17" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id088"><i class="fa fa-check"></i><b>14.17</b> Detrending a Time Series</a></li>
<li class="chapter" data-level="14.18" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id085"><i class="fa fa-check"></i><b>14.18</b> Fitting an ARIMA Model</a></li>
<li class="chapter" data-level="14.19" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id237"><i class="fa fa-check"></i><b>14.19</b> Removing Insignificant ARIMA Coefficients</a></li>
<li class="chapter" data-level="14.20" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id238"><i class="fa fa-check"></i><b>14.20</b> Running Diagnostics on an ARIMA Model</a></li>
<li class="chapter" data-level="14.21" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id086"><i class="fa fa-check"></i><b>14.21</b> Making Forecasts from an ARIMA Model</a></li>
<li class="chapter" data-level="14.22" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-plotting_forecast"><i class="fa fa-check"></i><b>14.22</b> Plotting a Forecast</a></li>
<li class="chapter" data-level="14.23" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id087"><i class="fa fa-check"></i><b>14.23</b> Testing for Mean Reversion</a></li>
<li class="chapter" data-level="14.24" data-path="TimeSeriesAnalysis.html"><a href="TimeSeriesAnalysis.html#recipe-id195"><i class="fa fa-check"></i><b>14.24</b> Smoothing a Time Series</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="SimpleProgramming.html"><a href="SimpleProgramming.html"><i class="fa fa-check"></i><b>15</b> Simple Programming</a>
<ul>
<li class="chapter" data-level="" data-path="SimpleProgramming.html"><a href="SimpleProgramming.html#intro-SimpleProgramming"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="15.1" data-path="SimpleProgramming.html"><a href="SimpleProgramming.html#recipe-creating_if_logic"><i class="fa fa-check"></i><b>15.1</b> Choosing Between Two Alternatives: if-else</a></li>
<li class="chapter" data-level="15.2" data-path="SimpleProgramming.html"><a href="SimpleProgramming.html#recipe-for_loop"><i class="fa fa-check"></i><b>15.2</b> Iterating with a Loop</a></li>
<li class="chapter" data-level="15.3" data-path="SimpleProgramming.html"><a href="SimpleProgramming.html#recipe-id117"><i class="fa fa-check"></i><b>15.3</b> Defining a Function</a></li>
<li class="chapter" data-level="15.4" data-path="SimpleProgramming.html"><a href="SimpleProgramming.html#recipe-variable"><i class="fa fa-check"></i><b>15.4</b> Creating a Local Variable</a></li>
<li class="chapter" data-level="15.5" data-path="SimpleProgramming.html"><a href="SimpleProgramming.html#choosing-between-multiple-alternatives-switch"><i class="fa fa-check"></i><b>15.5</b> Choosing Between Multiple Alternatives: switch</a></li>
<li class="chapter" data-level="15.6" data-path="SimpleProgramming.html"><a href="SimpleProgramming.html#recipe-title"><i class="fa fa-check"></i><b>15.6</b> Defining Defaults for Function Parameters</a></li>
<li class="chapter" data-level="15.7" data-path="SimpleProgramming.html"><a href="SimpleProgramming.html#signaling-errors"><i class="fa fa-check"></i><b>15.7</b> Signaling Errors</a></li>
<li class="chapter" data-level="15.8" data-path="SimpleProgramming.html"><a href="SimpleProgramming.html#protecting-against-errors"><i class="fa fa-check"></i><b>15.8</b> Protecting Against Errors</a></li>
<li class="chapter" data-level="15.9" data-path="SimpleProgramming.html"><a href="SimpleProgramming.html#recipe-anon-function"><i class="fa fa-check"></i><b>15.9</b> Creating an Anonymous Function</a></li>
<li class="chapter" data-level="15.10" data-path="SimpleProgramming.html"><a href="SimpleProgramming.html#creating-a-collection-of-reusable-functions"><i class="fa fa-check"></i><b>15.10</b> Creating a Collection of Reusable Functions</a></li>
<li class="chapter" data-level="15.11" data-path="SimpleProgramming.html"><a href="SimpleProgramming.html#recipe-indent"><i class="fa fa-check"></i><b>15.11</b> Automatically Reindent Code</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="RMarkdown.html"><a href="RMarkdown.html"><i class="fa fa-check"></i><b>16</b> R Markdown and Publishing</a>
<ul>
<li class="chapter" data-level="" data-path="RMarkdown.html"><a href="RMarkdown.html#intro-Rmd_pub"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="16.1" data-path="RMarkdown.html"><a href="RMarkdown.html#recipe-new_doc"><i class="fa fa-check"></i><b>16.1</b> Creating a New Document</a></li>
<li class="chapter" data-level="16.2" data-path="RMarkdown.html"><a href="RMarkdown.html#recipe-metadata"><i class="fa fa-check"></i><b>16.2</b> Adding a Title, Author, or Date</a></li>
<li class="chapter" data-level="16.3" data-path="RMarkdown.html"><a href="RMarkdown.html#recipe-doc-text"><i class="fa fa-check"></i><b>16.3</b> Formatting Document Text</a></li>
<li class="chapter" data-level="16.4" data-path="RMarkdown.html"><a href="RMarkdown.html#recipe-headings"><i class="fa fa-check"></i><b>16.4</b> Inserting Document Headings</a></li>
<li class="chapter" data-level="16.5" data-path="RMarkdown.html"><a href="RMarkdown.html#recipe-list"><i class="fa fa-check"></i><b>16.5</b> Inserting a List</a></li>
<li class="chapter" data-level="16.6" data-path="RMarkdown.html"><a href="RMarkdown.html#recipe-exec_r"><i class="fa fa-check"></i><b>16.6</b> Showing Output from R Code</a></li>
<li class="chapter" data-level="16.7" data-path="RMarkdown.html"><a href="RMarkdown.html#recipe-code-results"><i class="fa fa-check"></i><b>16.7</b> Controlling Which Code and Results Are Shown</a></li>
<li class="chapter" data-level="16.8" data-path="RMarkdown.html"><a href="RMarkdown.html#recipe-doc_plot"><i class="fa fa-check"></i><b>16.8</b> Inserting a Plot</a></li>
<li class="chapter" data-level="16.9" data-path="RMarkdown.html"><a href="RMarkdown.html#recipe-static-table"><i class="fa fa-check"></i><b>16.9</b> Inserting a Table</a></li>
<li class="chapter" data-level="16.10" data-path="RMarkdown.html"><a href="RMarkdown.html#recipe-tables"><i class="fa fa-check"></i><b>16.10</b> Inserting a Table of Data</a></li>
<li class="chapter" data-level="16.11" data-path="RMarkdown.html"><a href="RMarkdown.html#recipe-equations"><i class="fa fa-check"></i><b>16.11</b> Inserting Math Equations</a></li>
<li class="chapter" data-level="16.12" data-path="RMarkdown.html"><a href="RMarkdown.html#recipe-html"><i class="fa fa-check"></i><b>16.12</b> Generating HTML Output</a></li>
<li class="chapter" data-level="16.13" data-path="RMarkdown.html"><a href="RMarkdown.html#recipe-pdf"><i class="fa fa-check"></i><b>16.13</b> Generating PDF Output</a></li>
<li class="chapter" data-level="16.14" data-path="RMarkdown.html"><a href="RMarkdown.html#recipe-word"><i class="fa fa-check"></i><b>16.14</b> Generating Microsoft Word Output</a></li>
<li class="chapter" data-level="16.15" data-path="RMarkdown.html"><a href="RMarkdown.html#recipe-prez"><i class="fa fa-check"></i><b>16.15</b> Generating Presentation Output</a></li>
<li class="chapter" data-level="16.16" data-path="RMarkdown.html"><a href="RMarkdown.html#recipe-param_report"><i class="fa fa-check"></i><b>16.16</b> Creating a Parameterized Report</a></li>
<li class="chapter" data-level="16.17" data-path="RMarkdown.html"><a href="RMarkdown.html#recipe-rmd_org"><i class="fa fa-check"></i><b>16.17</b> Organizing Your R Markdown Workflow</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Cookbook, 2nd Edition</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="TimeSeriesAnalysis" class="section level1 hasAnchor" number="14">
<h1><span class="header-section-number">14</span> Time Series Analysis<a href="TimeSeriesAnalysis.html#TimeSeriesAnalysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction" class="section level2 unnumbered hasAnchor">
<h2>Introduction<a href="TimeSeriesAnalysis.html#introduction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<pre><code>#&gt; [conflicted] Will prefer stats::lag over any other package.
#&gt; [conflicted] Will prefer xts::first over any other package.
#&gt; [conflicted] Will prefer xts::last over any other package.</code></pre>
<p>Time series analysis has become a hot topic with the rise of
quantitative finance and automated trading of securities. Many of the
facilities described in this chapter were invented by practitioners and
researchers in finance, securities trading, and portfolio management.</p>
<p>Before you start any time series analysis in R, a key decision is your
choice of data representation (object class). This is especially
critical in an object-oriented language such as R, because the choice
affects more than how the data is stored; it also dictates which
functions (methods) will be available for loading, processing,
analyzing, printing, and plotting your data. When many people start using
R they simply store time series data in vectors. That
seems natural. However, they quickly discover that none of the coolest
analytics for time series analysis work with simple vectors. We’ve found when users
switch to using an object class intended for time series data,
the analysis gets easier, opening a gateway to valuable functions and analytics.</p>
<p>This chapter’s first recipe recommends using the <code>zoo</code> or <code>xts</code> packages
for representing time series data. They are quite general and should
meet the needs of most users. Nearly every subsequent recipe assumes you
are using one of those two representations.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>The <code>xts</code> implementation is a superset of <code>zoo</code>, so <code>xts</code> can do
everything that <code>zoo</code> can do. In this chapter, whenever a recipe works
for a <code>zoo</code> object, you can safely assume (unless stated otherwise)
that it also works for an <code>xts</code> object.</p>
</blockquote>
<div id="other-representations" class="section level3 unnumbered hasAnchor">
<h3>Other Representations<a href="TimeSeriesAnalysis.html#other-representations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Other representations of time series data are available in the R universe, including:</p>
<ul>
<li><code>fts</code> package</li>
<li><code>irts</code> from the <code>tseries</code> package</li>
<li><code>timeSeries</code> package</li>
<li><code>ts</code> (base distribution)</li>
<li><code>tsibble</code> package, a tidyverse style package for time series</li>
</ul>
<p>In fact, there is a whole toolkit, called <code>tsbox</code>, just for converting between representations.</p>
<p>Two representations deserve special mention.</p>
<div id="ts-base-distribution" class="section level4 unnumbered hasAnchor">
<h4>ts (base distribution)<a href="TimeSeriesAnalysis.html#ts-base-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The base distribution of R includes a time series class called <code>ts</code>. We
don’t recommend this representation for general use because the
implementation itself is too limited and restrictive.</p>
<p>However, the base distribution includes some important time series analytics
that depend upon <code>ts</code>, such as the autocorrelation function (<code>acf</code>)
and the cross-correlation function (<code>ccf</code>).
To use those base functions on <code>xts</code> data, use the <code>to.ts</code> function
to “downshift” your data into the <code>ts</code> representation before calling the function.
For example, if <code>x</code> is an <code>xts</code> object, you can compute its autocorrelation
like this:</p>
<pre><code>acf(as.ts(x))</code></pre>
</div>
<div id="tsibble-package" class="section level4 unnumbered hasAnchor">
<h4>tsibble package<a href="TimeSeriesAnalysis.html#tsibble-package" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>tsibble</code> package is a recent extension to the tidyverse,
specifically designed for working with time series data
within the tidyverse.
We find it useful for <em>cross-sectional</em> data—that is, data for which the observations are grouped by date,
and you want to perform analytics <em>within</em> dates more
than <em>across</em> dates.</p>
</div>
</div>
<div id="date-versus-datetime" class="section level3 unnumbered hasAnchor">
<h3>Date Versus Datetime<a href="TimeSeriesAnalysis.html#date-versus-datetime" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Every observation in a time series has an associated date or time. The
object classes used in this chapter, <code>zoo</code> and <code>xts</code>, give you the
choice of using either dates or datetimes for representing the data’s
time component. You would use dates to represent daily data, of course,
and also for weekly, monthly, or even annual data; in these cases, the
date gives the day on which the observation occurred. You would use
datetimes for intraday data, where both the date and time of observation
are needed.</p>
<p>In describing this chapter’s recipes, we found it pretty cumbersome to keep
saying “date or datetime.” So we simplified the prose by assuming that
your data are daily and thus use whole dates. Please bear in mind, of
course, that you are free and able to use timestamps below the
resolution of a calendar date.</p>
</div>
<div id="see-also-5" class="section level3 unnumbered hasAnchor">
<h3>See Also<a href="TimeSeriesAnalysis.html#see-also-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>R has many useful functions and packages for time series analysis.
You’ll find pointers to them in the
<a href="http://cran.r-project.org/web/views/TimeSeries.html">task view for Time Series Analysis</a>.</p>
</div>
</div>
<div id="recipe-id076" class="section level2 hasAnchor" number="14.1">
<h2><span class="header-section-number">14.1</span> Representing Time Series Data<a href="TimeSeriesAnalysis.html#recipe-id076" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id076" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id076" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You want an R data structure that can represent time series data.</p>
</div>
<div id="solution-id076" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id076" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We recommend the <code>zoo</code> and <code>xts</code> packages. They define a data structure
for time series, and they contain many useful functions for working with
time series data. Create a <code>zoo</code> object this way where <code>x</code> is a vector, matrix,
or data frame, and <code>dt</code> is a vector of corresponding dates or datetimes:</p>
<div class="sourceCode" id="cb981"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb981-1"><a href="TimeSeriesAnalysis.html#cb981-1" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb981-2"><a href="TimeSeriesAnalysis.html#cb981-2" tabindex="-1"></a>ts <span class="ot">&lt;-</span> <span class="fu">zoo</span>(x, dt)</span></code></pre></div>
<p>Create an <code>xts</code> object in this way:</p>
<div class="sourceCode" id="cb982"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb982-1"><a href="TimeSeriesAnalysis.html#cb982-1" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb982-2"><a href="TimeSeriesAnalysis.html#cb982-2" tabindex="-1"></a>ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(x, dt)</span></code></pre></div>
<p>Convert between representations of the time series data by using
<code>as.zoo</code> and <code>as.xts</code>:</p>
<dl>
<dt><code>as.zoo(ts)</code></dt>
<dd>
<p>Converts <code>ts</code> to a <code>zoo</code> object</p>
</dd>
<dt><code>as.xts(ts)</code></dt>
<dd>
<p>Converts <code>ts</code> to an <code>xts</code> object</p>
</dd>
</dl>
</div>
<div id="discussion-id076" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id076" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>R has at least eight different implementations of data structures for
representing time series. We haven’t tried them all, but we can say that <code>zoo</code> and <code>xts</code> are excellent packages for working with
time series data and better than the others that we have tried.</p>
<p>These representations assume you have two vectors: a vector of
observations (data) and a vector of dates or times of those
observations. The <code>zoo</code> function combines them into a <code>zoo</code> object:</p>
<div class="sourceCode" id="cb983"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb983-1"><a href="TimeSeriesAnalysis.html#cb983-1" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb983-2"><a href="TimeSeriesAnalysis.html#cb983-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">8</span>)</span>
<span id="cb983-3"><a href="TimeSeriesAnalysis.html#cb983-3" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2018-01-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2018-01-05&quot;</span>), <span class="at">by =</span> <span class="st">&quot;days&quot;</span>)</span>
<span id="cb983-4"><a href="TimeSeriesAnalysis.html#cb983-4" tabindex="-1"></a></span>
<span id="cb983-5"><a href="TimeSeriesAnalysis.html#cb983-5" tabindex="-1"></a>ts <span class="ot">&lt;-</span> <span class="fu">zoo</span>(x, dt)</span>
<span id="cb983-6"><a href="TimeSeriesAnalysis.html#cb983-6" tabindex="-1"></a><span class="fu">print</span>(ts)</span>
<span id="cb983-7"><a href="TimeSeriesAnalysis.html#cb983-7" tabindex="-1"></a><span class="co">#&gt; 2018-01-01 2018-01-02 2018-01-03 2018-01-04 2018-01-05 </span></span>
<span id="cb983-8"><a href="TimeSeriesAnalysis.html#cb983-8" tabindex="-1"></a><span class="co">#&gt;          3          4          1          4          8</span></span></code></pre></div>
<p>The <code>xts</code> function is similar, returning an <code>xts</code> object:</p>
<div class="sourceCode" id="cb984"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb984-1"><a href="TimeSeriesAnalysis.html#cb984-1" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb984-2"><a href="TimeSeriesAnalysis.html#cb984-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb984-3"><a href="TimeSeriesAnalysis.html#cb984-3" tabindex="-1"></a><span class="co">#&gt; ######################### Warning from &#39;xts&#39; package ##########################</span></span>
<span id="cb984-4"><a href="TimeSeriesAnalysis.html#cb984-4" tabindex="-1"></a><span class="co">#&gt; #                                                                             #</span></span>
<span id="cb984-5"><a href="TimeSeriesAnalysis.html#cb984-5" tabindex="-1"></a><span class="co">#&gt; # The dplyr lag() function breaks how base R&#39;s lag() function is supposed to  #</span></span>
<span id="cb984-6"><a href="TimeSeriesAnalysis.html#cb984-6" tabindex="-1"></a><span class="co">#&gt; # work, which breaks lag(my_xts). Calls to lag(my_xts) that you type or       #</span></span>
<span id="cb984-7"><a href="TimeSeriesAnalysis.html#cb984-7" tabindex="-1"></a><span class="co">#&gt; # source() into this session won&#39;t work correctly.                            #</span></span>
<span id="cb984-8"><a href="TimeSeriesAnalysis.html#cb984-8" tabindex="-1"></a><span class="co">#&gt; #                                                                             #</span></span>
<span id="cb984-9"><a href="TimeSeriesAnalysis.html#cb984-9" tabindex="-1"></a><span class="co">#&gt; # Use stats::lag() to make sure you&#39;re not using dplyr::lag(), or you can add #</span></span>
<span id="cb984-10"><a href="TimeSeriesAnalysis.html#cb984-10" tabindex="-1"></a><span class="co">#&gt; # conflictRules(&#39;dplyr&#39;, exclude = &#39;lag&#39;) to your .Rprofile to stop           #</span></span>
<span id="cb984-11"><a href="TimeSeriesAnalysis.html#cb984-11" tabindex="-1"></a><span class="co">#&gt; # dplyr from breaking base R&#39;s lag() function.                                #</span></span>
<span id="cb984-12"><a href="TimeSeriesAnalysis.html#cb984-12" tabindex="-1"></a><span class="co">#&gt; #                                                                             #</span></span>
<span id="cb984-13"><a href="TimeSeriesAnalysis.html#cb984-13" tabindex="-1"></a><span class="co">#&gt; # Code in packages is not affected. It&#39;s protected by R&#39;s namespace mechanism #</span></span>
<span id="cb984-14"><a href="TimeSeriesAnalysis.html#cb984-14" tabindex="-1"></a><span class="co">#&gt; # Set `options(xts.warn_dplyr_breaks_lag = FALSE)` to suppress this warning.  #</span></span>
<span id="cb984-15"><a href="TimeSeriesAnalysis.html#cb984-15" tabindex="-1"></a><span class="co">#&gt; #                                                                             #</span></span>
<span id="cb984-16"><a href="TimeSeriesAnalysis.html#cb984-16" tabindex="-1"></a><span class="co">#&gt; ###############################################################################</span></span>
<span id="cb984-17"><a href="TimeSeriesAnalysis.html#cb984-17" tabindex="-1"></a>ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(x, dt)</span>
<span id="cb984-18"><a href="TimeSeriesAnalysis.html#cb984-18" tabindex="-1"></a><span class="fu">print</span>(ts)</span>
<span id="cb984-19"><a href="TimeSeriesAnalysis.html#cb984-19" tabindex="-1"></a><span class="co">#&gt;            [,1]</span></span>
<span id="cb984-20"><a href="TimeSeriesAnalysis.html#cb984-20" tabindex="-1"></a><span class="co">#&gt; 2018-01-01    3</span></span>
<span id="cb984-21"><a href="TimeSeriesAnalysis.html#cb984-21" tabindex="-1"></a><span class="co">#&gt; 2018-01-02    4</span></span>
<span id="cb984-22"><a href="TimeSeriesAnalysis.html#cb984-22" tabindex="-1"></a><span class="co">#&gt; 2018-01-03    1</span></span>
<span id="cb984-23"><a href="TimeSeriesAnalysis.html#cb984-23" tabindex="-1"></a><span class="co">#&gt; 2018-01-04    4</span></span>
<span id="cb984-24"><a href="TimeSeriesAnalysis.html#cb984-24" tabindex="-1"></a><span class="co">#&gt; 2018-01-05    8</span></span></code></pre></div>
<p>The data, <code>x</code>, should be numeric. The vector of dates or datetimes,
<code>dt</code>, is called the <em>index</em>. Legal indices vary between the packages:</p>
<dl>
<dt><code>zoo</code></dt>
<dd>
<p>The index can be any ordered values, such as <code>Date</code> objects,
<code>POSIXct</code> objects, integers, or even floating-point values.</p>
</dd>
<dt><code>xts</code></dt>
<dd>
<p>The index must be a supported date or time class. This includes
<code>Date</code>, <code>POSIXct</code>, and <code>chron</code> objects. Those should be sufficient
for most applications, but you can also use <code>yearmon</code>, <code>yearqtr</code>,
and <code>dateTime</code> objects. The <code>xts</code> package is more restrictive than
<code>zoo</code> because it implements powerful operations that require a
time-based index.</p>
</dd>
</dl>
<p>The following example creates a <code>zoo</code> object that contains the price of
IBM stock for the first five days of 2010; it uses <code>Date</code> objects for
the index:</p>
<div class="sourceCode" id="cb985"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb985-1"><a href="TimeSeriesAnalysis.html#cb985-1" tabindex="-1"></a>prices <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">132.45</span>, <span class="fl">130.85</span>, <span class="fl">130.00</span>, <span class="fl">129.55</span>, <span class="fl">130.85</span>)</span>
<span id="cb985-2"><a href="TimeSeriesAnalysis.html#cb985-2" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(</span>
<span id="cb985-3"><a href="TimeSeriesAnalysis.html#cb985-3" tabindex="-1"></a>  <span class="st">&quot;2010-01-04&quot;</span>, <span class="st">&quot;2010-01-05&quot;</span>, <span class="st">&quot;2010-01-06&quot;</span>,</span>
<span id="cb985-4"><a href="TimeSeriesAnalysis.html#cb985-4" tabindex="-1"></a>  <span class="st">&quot;2010-01-07&quot;</span>, <span class="st">&quot;2010-01-08&quot;</span></span>
<span id="cb985-5"><a href="TimeSeriesAnalysis.html#cb985-5" tabindex="-1"></a>))</span>
<span id="cb985-6"><a href="TimeSeriesAnalysis.html#cb985-6" tabindex="-1"></a>ibm.daily <span class="ot">&lt;-</span> <span class="fu">zoo</span>(prices, dates)</span>
<span id="cb985-7"><a href="TimeSeriesAnalysis.html#cb985-7" tabindex="-1"></a><span class="fu">print</span>(ibm.daily)</span>
<span id="cb985-8"><a href="TimeSeriesAnalysis.html#cb985-8" tabindex="-1"></a><span class="co">#&gt; 2010-01-04 2010-01-05 2010-01-06 2010-01-07 2010-01-08 </span></span>
<span id="cb985-9"><a href="TimeSeriesAnalysis.html#cb985-9" tabindex="-1"></a><span class="co">#&gt;        132        131        130        130        131</span></span></code></pre></div>
<p>In contrast, the next example captures the price of IBM stock at
one-second intervals. It represents time by the number of hours past
midnight starting at 9:30 a.m. (1 second = 0.00027778 hours, more or less):</p>
<div class="sourceCode" id="cb986"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb986-1"><a href="TimeSeriesAnalysis.html#cb986-1" tabindex="-1"></a>prices <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">131.18</span>, <span class="fl">131.20</span>, <span class="fl">131.17</span>, <span class="fl">131.15</span>, <span class="fl">131.17</span>)</span>
<span id="cb986-2"><a href="TimeSeriesAnalysis.html#cb986-2" tabindex="-1"></a>seconds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">9.5</span>, <span class="fl">9.500278</span>, <span class="fl">9.500556</span>, <span class="fl">9.500833</span>, <span class="fl">9.501111</span>)</span>
<span id="cb986-3"><a href="TimeSeriesAnalysis.html#cb986-3" tabindex="-1"></a>ibm.sec <span class="ot">&lt;-</span> <span class="fu">zoo</span>(prices, seconds)</span>
<span id="cb986-4"><a href="TimeSeriesAnalysis.html#cb986-4" tabindex="-1"></a><span class="fu">print</span>(ibm.sec)</span>
<span id="cb986-5"><a href="TimeSeriesAnalysis.html#cb986-5" tabindex="-1"></a><span class="co">#&gt;  10  10  10  10  10 </span></span>
<span id="cb986-6"><a href="TimeSeriesAnalysis.html#cb986-6" tabindex="-1"></a><span class="co">#&gt; 131 131 131 131 131</span></span></code></pre></div>
<p>Those two examples used a single time series, where the data came from a
vector. Both <code>zoo</code> and <code>xts</code> can also handle multiple, parallel time
series. For this, capture the several time series in a matrix or data frame and
then create a multivariate time series by calling the <code>zoo</code> (or <code>xts</code>)
function:</p>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb987-1"><a href="TimeSeriesAnalysis.html#cb987-1" tabindex="-1"></a>ts <span class="ot">&lt;-</span> <span class="fu">zoo</span>(df, dt) <span class="co"># OR: ts &lt;- xts(dfrm, dt)</span></span></code></pre></div>
<p>The second argument is a vector of dates (or datetimes) for each
observation. There is only one vector of dates for all the time series;
in other words, all observations in each row of the matrix or data frame must have
the same date. See Recipe <a href="TimeSeriesAnalysis.html#recipe-id079">14.5</a>, <a href="TimeSeriesAnalysis.html#recipe-id079">“Merging Several Time Series”</a> if your
data has mismatched dates.</p>
<p>Once the data is captured inside a <code>zoo</code> or <code>xts</code> object, you can
extract the pure data via <code>coredata</code>, which returns a simple vector (or
matrix):</p>
<div class="sourceCode" id="cb988"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb988-1"><a href="TimeSeriesAnalysis.html#cb988-1" tabindex="-1"></a><span class="fu">coredata</span>(ibm.daily)</span>
<span id="cb988-2"><a href="TimeSeriesAnalysis.html#cb988-2" tabindex="-1"></a><span class="co">#&gt; [1] 132 131 130 130 131</span></span></code></pre></div>
<p>You can extract the date or time portion via <code>index</code>:</p>
<div class="sourceCode" id="cb989"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb989-1"><a href="TimeSeriesAnalysis.html#cb989-1" tabindex="-1"></a><span class="fu">index</span>(ibm.daily)</span>
<span id="cb989-2"><a href="TimeSeriesAnalysis.html#cb989-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2010-01-04&quot; &quot;2010-01-05&quot; &quot;2010-01-06&quot; &quot;2010-01-07&quot; &quot;2010-01-08&quot;</span></span></code></pre></div>
<p>The <code>xts</code> package is very similar to <code>zoo</code>. It is optimized for
speed, so is especially well suited for processing large volumes of
data. It is also clever about converting to and from other time series
representations.</p>
<p>One big advantage of capturing data inside a <code>zoo</code> or <code>xts</code> object is
that special-purpose functions become available for printing, plotting,
differencing, merging, periodic sampling, applying rolling functions,
and other useful operations. There is even a function, <code>read.zoo</code>,
dedicated to reading time series data from ASCII files.</p>
<p>Remember that the <code>xts</code> package can do everything that the <code>zoo</code> package
can do, so everywhere that this chapter talks about <code>zoo</code> objects you
can also use <code>xts</code> objects.</p>
<p>If you are a serious user of time series data, we strongly recommend
studying the documentation of these packages in order to learn about the
ways they can improve your life. They are rich packages with many useful
features.</p>
</div>
<div id="see_also-id076" class="section level3 unnumbered hasAnchor">
<h3>See Also<a href="TimeSeriesAnalysis.html#see_also-id076" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>See CRAN for documentation on
<a href="http://cran.r-project.org/web/packages/zoo/"><code>zoo</code></a> and
<a href="http://cran.r-project.org/web/packages/xts/"><code>xts</code></a>, including reference manuals, vignettes, and quick reference cards. If the
packages are already installed on your computer, view their
documentation using the <code>vignette</code> function:</p>
<div class="sourceCode" id="cb990"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb990-1"><a href="TimeSeriesAnalysis.html#cb990-1" tabindex="-1"></a><span class="fu">vignette</span>(<span class="st">&quot;zoo&quot;</span>)</span>
<span id="cb990-2"><a href="TimeSeriesAnalysis.html#cb990-2" tabindex="-1"></a><span class="fu">vignette</span>(<span class="st">&quot;xts&quot;</span>)</span></code></pre></div>
<p>The <code>timeSeries</code> package is another good implementation of a time series
object. It is part of the Rmetrics project for quantitative finance.</p>
</div>
</div>
<div id="recipe-id089" class="section level2 hasAnchor" number="14.2">
<h2><span class="header-section-number">14.2</span> Plotting Time Series Data<a href="TimeSeriesAnalysis.html#recipe-id089" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id089" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id089" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You want to plot one or more time series.</p>
</div>
<div id="solution-id089" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id089" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use <code>plot(x)</code>, which works for <code>zoo</code> objects and <code>xts</code> objects
containing either single or multiple time series.</p>
<p>For a simple vector <code>v</code> of time series observations, you can use either
<code>plot(v,type = "l")</code> or <code>plot.ts(v)</code>.</p>
</div>
<div id="discussion-id089" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id089" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The generic <code>plot</code> function has a version for <code>zoo</code> objects and <code>xts</code>
objects. It can plot objects that contain a single time series or
multiple time series. In the latter case, it can plot each series in a
separate plot or together in one plot.</p>
<p>Suppose that <code>ibm.infl</code> is a <code>zoo</code> object that contains two time series.
One shows the quoted price of IBM stock from January 2000 through December 2017, and the other is that same price adjusted for inflation. If you plot the object, R will plot the two time series together in one plot, as shown in Figure <a href="TimeSeriesAnalysis.html#fig:ibmplot">14.1</a>:</p>
<div class="sourceCode" id="cb991"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb991-1"><a href="TimeSeriesAnalysis.html#cb991-1" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;./data/ibm.rdata&quot;</span>)</span>
<span id="cb991-2"><a href="TimeSeriesAnalysis.html#cb991-2" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb991-3"><a href="TimeSeriesAnalysis.html#cb991-3" tabindex="-1"></a></span>
<span id="cb991-4"><a href="TimeSeriesAnalysis.html#cb991-4" tabindex="-1"></a>main <span class="ot">&lt;-</span> <span class="st">&quot;IBM: Historical vs. Inflation-Adjusted&quot;</span></span>
<span id="cb991-5"><a href="TimeSeriesAnalysis.html#cb991-5" tabindex="-1"></a>lty <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;dotted&quot;</span>, <span class="st">&quot;solid&quot;</span>)</span>
<span id="cb991-6"><a href="TimeSeriesAnalysis.html#cb991-6" tabindex="-1"></a></span>
<span id="cb991-7"><a href="TimeSeriesAnalysis.html#cb991-7" tabindex="-1"></a><span class="co"># Plot the xts object</span></span>
<span id="cb991-8"><a href="TimeSeriesAnalysis.html#cb991-8" tabindex="-1"></a><span class="fu">plot</span>(ibm.infl,</span>
<span id="cb991-9"><a href="TimeSeriesAnalysis.html#cb991-9" tabindex="-1"></a>  <span class="at">lty =</span> lty, <span class="at">main =</span> main,</span>
<span id="cb991-10"><a href="TimeSeriesAnalysis.html#cb991-10" tabindex="-1"></a>  <span class="at">legend.loc =</span> <span class="st">&quot;left&quot;</span></span>
<span id="cb991-11"><a href="TimeSeriesAnalysis.html#cb991-11" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:ibmplot"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/ibmplot-1.png" alt="Example xts plot" width="85%" />
<p class="caption">
Figure 14.1: Example xts plot
</p>
</div>
<p>The <code>plot</code> function for <code>xts</code> provides a default title as simply the name of the <code>xts</code> object. As we show here, it’s common to set the <code>main</code> parameter to a more meaningful title.</p>
<p>The code specifies two line types (<code>lty</code>) so that the two lines are
drawn in two different styles, making them easier to distinguish.</p>
</div>
<div id="see_also-id089" class="section level3 unnumbered hasAnchor">
<h3>See Also<a href="TimeSeriesAnalysis.html#see_also-id089" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For working with financial data, the <code>quantmod</code> package contains special
plotting functions that produce beautiful, stylized plots.</p>
</div>
</div>
<div id="recipe-id077" class="section level2 hasAnchor" number="14.3">
<h2><span class="header-section-number">14.3</span> Extracting the Oldest or Newest Observations<a href="TimeSeriesAnalysis.html#recipe-id077" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id077" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id077" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You want to see only the oldest or newest observations of your time
series.</p>
</div>
<div id="solution-id077" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id077" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use <code>head</code> to view the oldest observations:</p>
<div class="sourceCode" id="cb992"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb992-1"><a href="TimeSeriesAnalysis.html#cb992-1" tabindex="-1"></a><span class="fu">head</span>(ts)</span></code></pre></div>
<p>Use <code>tail</code> to view the newest observations:</p>
<div class="sourceCode" id="cb993"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb993-1"><a href="TimeSeriesAnalysis.html#cb993-1" tabindex="-1"></a><span class="fu">tail</span>(ts)</span></code></pre></div>
</div>
<div id="discussion-id077" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id077" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>head</code> and <code>tail</code> functions are generic, so they will work whether
your data is stored in a simple vector, a <code>zoo</code> object, or an <code>xts</code>
object.</p>
<p>Suppose you have a <code>xts</code> object with a multiyear history of the price of
IBM stock like the one used in the prior recipe. You can’t display the whole dataset because it would scroll
off your screen. But you can view the initial observations:</p>
<div class="sourceCode" id="cb994"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb994-1"><a href="TimeSeriesAnalysis.html#cb994-1" tabindex="-1"></a>ibm <span class="ot">&lt;-</span> ibm.infl<span class="sc">$</span>ibm <span class="co"># grab one column for illustration</span></span>
<span id="cb994-2"><a href="TimeSeriesAnalysis.html#cb994-2" tabindex="-1"></a><span class="fu">head</span>(ibm)</span>
<span id="cb994-3"><a href="TimeSeriesAnalysis.html#cb994-3" tabindex="-1"></a><span class="co">#&gt;             ibm</span></span>
<span id="cb994-4"><a href="TimeSeriesAnalysis.html#cb994-4" tabindex="-1"></a><span class="co">#&gt; 2000-01-01 78.6</span></span>
<span id="cb994-5"><a href="TimeSeriesAnalysis.html#cb994-5" tabindex="-1"></a><span class="co">#&gt; 2000-01-03 82.0</span></span>
<span id="cb994-6"><a href="TimeSeriesAnalysis.html#cb994-6" tabindex="-1"></a><span class="co">#&gt; 2000-01-04 79.2</span></span>
<span id="cb994-7"><a href="TimeSeriesAnalysis.html#cb994-7" tabindex="-1"></a><span class="co">#&gt; 2000-01-05 82.0</span></span>
<span id="cb994-8"><a href="TimeSeriesAnalysis.html#cb994-8" tabindex="-1"></a><span class="co">#&gt; 2000-01-06 80.6</span></span>
<span id="cb994-9"><a href="TimeSeriesAnalysis.html#cb994-9" tabindex="-1"></a><span class="co">#&gt; 2000-01-07 80.2</span></span></code></pre></div>
<p>And you can view the final observations:</p>
<div class="sourceCode" id="cb995"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb995-1"><a href="TimeSeriesAnalysis.html#cb995-1" tabindex="-1"></a><span class="fu">tail</span>(ibm)</span>
<span id="cb995-2"><a href="TimeSeriesAnalysis.html#cb995-2" tabindex="-1"></a><span class="co">#&gt;            ibm</span></span>
<span id="cb995-3"><a href="TimeSeriesAnalysis.html#cb995-3" tabindex="-1"></a><span class="co">#&gt; 2017-12-21 148</span></span>
<span id="cb995-4"><a href="TimeSeriesAnalysis.html#cb995-4" tabindex="-1"></a><span class="co">#&gt; 2017-12-22 149</span></span>
<span id="cb995-5"><a href="TimeSeriesAnalysis.html#cb995-5" tabindex="-1"></a><span class="co">#&gt; 2017-12-26 150</span></span>
<span id="cb995-6"><a href="TimeSeriesAnalysis.html#cb995-6" tabindex="-1"></a><span class="co">#&gt; 2017-12-27 150</span></span>
<span id="cb995-7"><a href="TimeSeriesAnalysis.html#cb995-7" tabindex="-1"></a><span class="co">#&gt; 2017-12-28 151</span></span>
<span id="cb995-8"><a href="TimeSeriesAnalysis.html#cb995-8" tabindex="-1"></a><span class="co">#&gt; 2017-12-29 150</span></span></code></pre></div>
<p>By default, <code>head</code> and <code>tail</code> show (respectively) the six oldest and six
newest observations. You can see more observations by providing a second
argument—for example, <code>tail(ibm, 20)</code>.</p>
<p>The <code>xts</code> package also includes <code>first</code> and <code>last</code> functions, which use
calendar periods instead of number of observations. We can use <code>first</code>
and <code>last</code> to select data by number of days, weeks, months, or even
years:</p>
<div class="sourceCode" id="cb996"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb996-1"><a href="TimeSeriesAnalysis.html#cb996-1" tabindex="-1"></a><span class="fu">first</span>(ibm, <span class="st">&quot;2 week&quot;</span>)</span>
<span id="cb996-2"><a href="TimeSeriesAnalysis.html#cb996-2" tabindex="-1"></a><span class="co">#&gt;             ibm</span></span>
<span id="cb996-3"><a href="TimeSeriesAnalysis.html#cb996-3" tabindex="-1"></a><span class="co">#&gt; 2000-01-01 78.6</span></span>
<span id="cb996-4"><a href="TimeSeriesAnalysis.html#cb996-4" tabindex="-1"></a><span class="co">#&gt; 2000-01-03 82.0</span></span>
<span id="cb996-5"><a href="TimeSeriesAnalysis.html#cb996-5" tabindex="-1"></a><span class="co">#&gt; 2000-01-04 79.2</span></span>
<span id="cb996-6"><a href="TimeSeriesAnalysis.html#cb996-6" tabindex="-1"></a><span class="co">#&gt; 2000-01-05 82.0</span></span>
<span id="cb996-7"><a href="TimeSeriesAnalysis.html#cb996-7" tabindex="-1"></a><span class="co">#&gt; 2000-01-06 80.6</span></span>
<span id="cb996-8"><a href="TimeSeriesAnalysis.html#cb996-8" tabindex="-1"></a><span class="co">#&gt; 2000-01-07 80.2</span></span></code></pre></div>
<p>At first glance this output might be confusing. We asked for <code>"2 week"</code> and <code>xts</code> returned six days. That might seem off until we look at a calendar of January 2000.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-17"></span>
<img src="images_v2/cal.png" alt="January 2000 calendar" width="85%" />
<p class="caption">
Figure 14.2: January 2000 calendar
</p>
</div>
<p>We can see from the calendar that the first week of January 2000 has only one day, Saturday the 1st. Then the second week runs from the 2nd to the 8th. Our data has no value for the 8th, so when we ask <code>first</code> for the first <code>"2 week"</code> it returns all the values from the first two calendar weeks. In our example dataset the first two calendar weeks contain only six values.</p>
<p>Similarly, we can ask <code>last</code> to give us the last month’s worth of data:</p>
<div class="sourceCode" id="cb997"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb997-1"><a href="TimeSeriesAnalysis.html#cb997-1" tabindex="-1"></a><span class="fu">last</span>(ibm, <span class="st">&quot;month&quot;</span>)</span>
<span id="cb997-2"><a href="TimeSeriesAnalysis.html#cb997-2" tabindex="-1"></a><span class="co">#&gt;            ibm</span></span>
<span id="cb997-3"><a href="TimeSeriesAnalysis.html#cb997-3" tabindex="-1"></a><span class="co">#&gt; 2017-12-01 152</span></span>
<span id="cb997-4"><a href="TimeSeriesAnalysis.html#cb997-4" tabindex="-1"></a><span class="co">#&gt; 2017-12-04 153</span></span>
<span id="cb997-5"><a href="TimeSeriesAnalysis.html#cb997-5" tabindex="-1"></a><span class="co">#&gt; 2017-12-05 152</span></span>
<span id="cb997-6"><a href="TimeSeriesAnalysis.html#cb997-6" tabindex="-1"></a><span class="co">#&gt; 2017-12-06 151</span></span>
<span id="cb997-7"><a href="TimeSeriesAnalysis.html#cb997-7" tabindex="-1"></a><span class="co">#&gt; 2017-12-07 150</span></span>
<span id="cb997-8"><a href="TimeSeriesAnalysis.html#cb997-8" tabindex="-1"></a><span class="co">#&gt; 2017-12-08 152</span></span>
<span id="cb997-9"><a href="TimeSeriesAnalysis.html#cb997-9" tabindex="-1"></a><span class="co">#&gt; 2017-12-11 152</span></span>
<span id="cb997-10"><a href="TimeSeriesAnalysis.html#cb997-10" tabindex="-1"></a><span class="co">#&gt; 2017-12-12 154</span></span>
<span id="cb997-11"><a href="TimeSeriesAnalysis.html#cb997-11" tabindex="-1"></a><span class="co">#&gt; 2017-12-13 151</span></span>
<span id="cb997-12"><a href="TimeSeriesAnalysis.html#cb997-12" tabindex="-1"></a><span class="co">#&gt; 2017-12-14 151</span></span>
<span id="cb997-13"><a href="TimeSeriesAnalysis.html#cb997-13" tabindex="-1"></a><span class="co">#&gt; 2017-12-15 149</span></span>
<span id="cb997-14"><a href="TimeSeriesAnalysis.html#cb997-14" tabindex="-1"></a><span class="co">#&gt; 2017-12-18 150</span></span>
<span id="cb997-15"><a href="TimeSeriesAnalysis.html#cb997-15" tabindex="-1"></a><span class="co">#&gt; 2017-12-19 150</span></span>
<span id="cb997-16"><a href="TimeSeriesAnalysis.html#cb997-16" tabindex="-1"></a><span class="co">#&gt; 2017-12-20 150</span></span>
<span id="cb997-17"><a href="TimeSeriesAnalysis.html#cb997-17" tabindex="-1"></a><span class="co">#&gt; 2017-12-21 148</span></span>
<span id="cb997-18"><a href="TimeSeriesAnalysis.html#cb997-18" tabindex="-1"></a><span class="co">#&gt; 2017-12-22 149</span></span>
<span id="cb997-19"><a href="TimeSeriesAnalysis.html#cb997-19" tabindex="-1"></a><span class="co">#&gt; 2017-12-26 150</span></span>
<span id="cb997-20"><a href="TimeSeriesAnalysis.html#cb997-20" tabindex="-1"></a><span class="co">#&gt; 2017-12-27 150</span></span>
<span id="cb997-21"><a href="TimeSeriesAnalysis.html#cb997-21" tabindex="-1"></a><span class="co">#&gt; 2017-12-28 151</span></span>
<span id="cb997-22"><a href="TimeSeriesAnalysis.html#cb997-22" tabindex="-1"></a><span class="co">#&gt; 2017-12-29 150</span></span></code></pre></div>
<p>If we had been using <code>zoo</code> objects here, we would need to have converted them to <code>xts</code> objects before passing the objects to <code>first</code> or <code>last</code>, as those are <code>xts</code> functions.</p>
</div>
<div id="see-also-6" class="section level3 unnumbered hasAnchor">
<h3>See Also<a href="TimeSeriesAnalysis.html#see-also-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>See <code>help(first.xts)</code> and <code>help(last.xts)</code> for details on the <code>first</code>
and <code>last</code> functions, respectively.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>The <code>tidyverse</code> package <code>dplyr</code> also has functions called <code>first</code> and <code>last</code>. If your workflow involves loading both <code>xts</code> and <code>dplyr</code> packages, make sure to be explicit about which function you are calling by using the <code>*package*::*function*</code> notation (for example, <code>xts::first</code>).</p>
</blockquote>
</div>
</div>
<div id="recipe-id281" class="section level2 hasAnchor" number="14.4">
<h2><span class="header-section-number">14.4</span> Subsetting a Time Series<a href="TimeSeriesAnalysis.html#recipe-id281" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id281" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id281" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You want to select one or more elements from a time series.</p>
</div>
<div id="solution-id281" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id281" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can index a <code>zoo</code> or <code>xts</code> object by position. Use one or two
subscripts, depending upon whether the object contains one time series
or multiple time series:</p>
<dl>
<dt><code>ts[i]</code></dt>
<dd>
<p>Selects the <em>i</em>th observation from a single time series</p>
</dd>
<dt><code>ts[j,i]</code></dt>
<dd>
<p>Selects the <em>i</em>th observation of the <em>j</em>th time series of multiple
time series</p>
</dd>
</dl>
<p>You can index the time series by date. Use the same type of
object as the index of your time series. This example assumes that the
index contains <code>Date</code> objects:</p>
<div class="sourceCode" id="cb998"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb998-1"><a href="TimeSeriesAnalysis.html#cb998-1" tabindex="-1"></a>ts[<span class="fu">as.Date</span>(<span class="st">&quot;yyyy-mm-dd&quot;</span>)]</span></code></pre></div>
<p>You can index it by a sequence of dates:</p>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb999-1"><a href="TimeSeriesAnalysis.html#cb999-1" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">seq</span>(startdate, enddate, increment)</span>
<span id="cb999-2"><a href="TimeSeriesAnalysis.html#cb999-2" tabindex="-1"></a>ts[dates]</span></code></pre></div>
<p>The <code>window</code> function can select a range by start and end date:</p>
<div class="sourceCode" id="cb1000"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1000-1"><a href="TimeSeriesAnalysis.html#cb1000-1" tabindex="-1"></a><span class="fu">window</span>(ts, <span class="at">start =</span> startdate, <span class="at">end =</span> enddate)</span></code></pre></div>
</div>
<div id="discussion-id281" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id281" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Recall our <code>xts</code> object that is a sample of inflation-adjusted IBM stock prices from the previous recipe:</p>
<div class="sourceCode" id="cb1001"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1001-1"><a href="TimeSeriesAnalysis.html#cb1001-1" tabindex="-1"></a><span class="fu">head</span>(ibm)</span>
<span id="cb1001-2"><a href="TimeSeriesAnalysis.html#cb1001-2" tabindex="-1"></a><span class="co">#&gt;             ibm</span></span>
<span id="cb1001-3"><a href="TimeSeriesAnalysis.html#cb1001-3" tabindex="-1"></a><span class="co">#&gt; 2000-01-01 78.6</span></span>
<span id="cb1001-4"><a href="TimeSeriesAnalysis.html#cb1001-4" tabindex="-1"></a><span class="co">#&gt; 2000-01-03 82.0</span></span>
<span id="cb1001-5"><a href="TimeSeriesAnalysis.html#cb1001-5" tabindex="-1"></a><span class="co">#&gt; 2000-01-04 79.2</span></span>
<span id="cb1001-6"><a href="TimeSeriesAnalysis.html#cb1001-6" tabindex="-1"></a><span class="co">#&gt; 2000-01-05 82.0</span></span>
<span id="cb1001-7"><a href="TimeSeriesAnalysis.html#cb1001-7" tabindex="-1"></a><span class="co">#&gt; 2000-01-06 80.6</span></span>
<span id="cb1001-8"><a href="TimeSeriesAnalysis.html#cb1001-8" tabindex="-1"></a><span class="co">#&gt; 2000-01-07 80.2</span></span></code></pre></div>
<p>We can select an observation by position, just like selecting elements
from a vector (see Recipe <a href="SomeBasics.html#recipe-id039">2.9</a>, <a href="SomeBasics.html#recipe-id039">“Selecting Vector Elements”</a>):</p>
<div class="sourceCode" id="cb1002"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1002-1"><a href="TimeSeriesAnalysis.html#cb1002-1" tabindex="-1"></a>ibm[<span class="dv">2</span>]</span>
<span id="cb1002-2"><a href="TimeSeriesAnalysis.html#cb1002-2" tabindex="-1"></a><span class="co">#&gt;            ibm</span></span>
<span id="cb1002-3"><a href="TimeSeriesAnalysis.html#cb1002-3" tabindex="-1"></a><span class="co">#&gt; 2000-01-03  82</span></span></code></pre></div>
<p>We can also select multiple observations by position:</p>
<div class="sourceCode" id="cb1003"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1003-1"><a href="TimeSeriesAnalysis.html#cb1003-1" tabindex="-1"></a>ibm[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb1003-2"><a href="TimeSeriesAnalysis.html#cb1003-2" tabindex="-1"></a><span class="co">#&gt;             ibm</span></span>
<span id="cb1003-3"><a href="TimeSeriesAnalysis.html#cb1003-3" tabindex="-1"></a><span class="co">#&gt; 2000-01-03 82.0</span></span>
<span id="cb1003-4"><a href="TimeSeriesAnalysis.html#cb1003-4" tabindex="-1"></a><span class="co">#&gt; 2000-01-04 79.2</span></span>
<span id="cb1003-5"><a href="TimeSeriesAnalysis.html#cb1003-5" tabindex="-1"></a><span class="co">#&gt; 2000-01-05 82.0</span></span></code></pre></div>
<p>Sometimes it’s more useful to select by date.
Simpy use the date itself as the index.</p>
<div class="sourceCode" id="cb1004"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1004-1"><a href="TimeSeriesAnalysis.html#cb1004-1" tabindex="-1"></a>ibm[<span class="fu">as.Date</span>(<span class="st">&quot;2010-01-05&quot;</span>)]</span>
<span id="cb1004-2"><a href="TimeSeriesAnalysis.html#cb1004-2" tabindex="-1"></a><span class="co">#&gt;            ibm</span></span>
<span id="cb1004-3"><a href="TimeSeriesAnalysis.html#cb1004-3" tabindex="-1"></a><span class="co">#&gt; 2010-01-05 103</span></span></code></pre></div>
<p>Our <code>ibm</code> data is an <code>xts</code> object, so we can use date-like subsetting, too. (The <code>zoo</code> object does not offer this flexibility.)</p>
<pre><code>ibm[&#39;2010-01-05&#39;]

ibm[&#39;20100105&#39;]</code></pre>
<p>We can also select by a vector of <code>Date</code> objects:</p>
<div class="sourceCode" id="cb1006"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1006-1"><a href="TimeSeriesAnalysis.html#cb1006-1" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2010-01-04&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2010-01-08&quot;</span>), <span class="at">by =</span> <span class="dv">2</span>)</span>
<span id="cb1006-2"><a href="TimeSeriesAnalysis.html#cb1006-2" tabindex="-1"></a>ibm[dates]</span>
<span id="cb1006-3"><a href="TimeSeriesAnalysis.html#cb1006-3" tabindex="-1"></a><span class="co">#&gt;            ibm</span></span>
<span id="cb1006-4"><a href="TimeSeriesAnalysis.html#cb1006-4" tabindex="-1"></a><span class="co">#&gt; 2010-01-04 104</span></span>
<span id="cb1006-5"><a href="TimeSeriesAnalysis.html#cb1006-5" tabindex="-1"></a><span class="co">#&gt; 2010-01-06 102</span></span>
<span id="cb1006-6"><a href="TimeSeriesAnalysis.html#cb1006-6" tabindex="-1"></a><span class="co">#&gt; 2010-01-08 103</span></span></code></pre></div>
<p>The <code>window</code> function is easier for selecting a range of consecutive
dates:</p>
<div class="sourceCode" id="cb1007"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1007-1"><a href="TimeSeriesAnalysis.html#cb1007-1" tabindex="-1"></a><span class="fu">window</span>(ibm, <span class="at">start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2010-01-05&quot;</span>), <span class="at">end =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2010-01-07&quot;</span>))</span>
<span id="cb1007-2"><a href="TimeSeriesAnalysis.html#cb1007-2" tabindex="-1"></a><span class="co">#&gt;            ibm</span></span>
<span id="cb1007-3"><a href="TimeSeriesAnalysis.html#cb1007-3" tabindex="-1"></a><span class="co">#&gt; 2010-01-05 103</span></span>
<span id="cb1007-4"><a href="TimeSeriesAnalysis.html#cb1007-4" tabindex="-1"></a><span class="co">#&gt; 2010-01-06 102</span></span>
<span id="cb1007-5"><a href="TimeSeriesAnalysis.html#cb1007-5" tabindex="-1"></a><span class="co">#&gt; 2010-01-07 102</span></span></code></pre></div>
<p>We can select a year/month combination using <code>yyyymm</code> subsetting:</p>
<div class="sourceCode" id="cb1008"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1008-1"><a href="TimeSeriesAnalysis.html#cb1008-1" tabindex="-1"></a>ibm[<span class="st">&#39;201001&#39;</span>]  <span class="co"># Jan 2010</span></span></code></pre></div>
<p>Select year ranges using <code>/</code> like so:</p>
<div class="sourceCode" id="cb1009"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1009-1"><a href="TimeSeriesAnalysis.html#cb1009-1" tabindex="-1"></a>ibm[<span class="st">&#39;2009/2011&#39;</span>] <span class="co"># all of 2009 - 2011</span></span></code></pre></div>
<p>Or use <code>/</code> to select ranges including months:</p>
<div class="sourceCode" id="cb1010"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1010-1"><a href="TimeSeriesAnalysis.html#cb1010-1" tabindex="-1"></a>ibm[<span class="st">&#39;2009/201001&#39;</span>] <span class="co"># all of 2009 plus Jan 2010</span></span>
<span id="cb1010-2"><a href="TimeSeriesAnalysis.html#cb1010-2" tabindex="-1"></a>ibm[<span class="st">&#39;200906/201005&#39;</span>] <span class="co"># June 2009 through May 2010</span></span></code></pre></div>
</div>
<div id="see_also-id281" class="section level3 unnumbered hasAnchor">
<h3>See Also<a href="TimeSeriesAnalysis.html#see_also-id281" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>xts</code> package provides many other clever ways to index a time
series. See the package documentation.</p>
</div>
</div>
<div id="recipe-id079" class="section level2 hasAnchor" number="14.5">
<h2><span class="header-section-number">14.5</span> Merging Several Time Series<a href="TimeSeriesAnalysis.html#recipe-id079" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id079" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id079" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You have two or more time series. You want to merge them into a single
time series object.</p>
</div>
<div id="solution-id079" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id079" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use a <code>zoo</code> or <code>xts</code> object to represent the time series, then use the <code>merge</code>
function to combine them:</p>
<div class="sourceCode" id="cb1011"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1011-1"><a href="TimeSeriesAnalysis.html#cb1011-1" tabindex="-1"></a><span class="fu">merge</span>(ts1, ts2)</span></code></pre></div>
</div>
<div id="discussion-id079" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id079" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Merging two time series is an incredible headache when the two series
have differing timestamps. Consider these two time series: the daily
price of IBM stock from 1999 through 2017, and the monthly Consumer
Price Index (CPI) for the same period:</p>
<div class="sourceCode" id="cb1012"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1012-1"><a href="TimeSeriesAnalysis.html#cb1012-1" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;./data/ibm.rdata&quot;</span>)</span>
<span id="cb1012-2"><a href="TimeSeriesAnalysis.html#cb1012-2" tabindex="-1"></a><span class="fu">head</span>(ibm)</span>
<span id="cb1012-3"><a href="TimeSeriesAnalysis.html#cb1012-3" tabindex="-1"></a><span class="co">#&gt;             ibm</span></span>
<span id="cb1012-4"><a href="TimeSeriesAnalysis.html#cb1012-4" tabindex="-1"></a><span class="co">#&gt; 1999-01-04 64.2</span></span>
<span id="cb1012-5"><a href="TimeSeriesAnalysis.html#cb1012-5" tabindex="-1"></a><span class="co">#&gt; 1999-01-05 66.5</span></span>
<span id="cb1012-6"><a href="TimeSeriesAnalysis.html#cb1012-6" tabindex="-1"></a><span class="co">#&gt; 1999-01-06 66.2</span></span>
<span id="cb1012-7"><a href="TimeSeriesAnalysis.html#cb1012-7" tabindex="-1"></a><span class="co">#&gt; 1999-01-07 66.7</span></span>
<span id="cb1012-8"><a href="TimeSeriesAnalysis.html#cb1012-8" tabindex="-1"></a><span class="co">#&gt; 1999-01-08 65.8</span></span>
<span id="cb1012-9"><a href="TimeSeriesAnalysis.html#cb1012-9" tabindex="-1"></a><span class="co">#&gt; 1999-01-11 66.4</span></span>
<span id="cb1012-10"><a href="TimeSeriesAnalysis.html#cb1012-10" tabindex="-1"></a><span class="fu">head</span>(cpi)</span>
<span id="cb1012-11"><a href="TimeSeriesAnalysis.html#cb1012-11" tabindex="-1"></a><span class="co">#&gt;              cpi</span></span>
<span id="cb1012-12"><a href="TimeSeriesAnalysis.html#cb1012-12" tabindex="-1"></a><span class="co">#&gt; 1999-01-01 0.938</span></span>
<span id="cb1012-13"><a href="TimeSeriesAnalysis.html#cb1012-13" tabindex="-1"></a><span class="co">#&gt; 1999-02-01 0.938</span></span>
<span id="cb1012-14"><a href="TimeSeriesAnalysis.html#cb1012-14" tabindex="-1"></a><span class="co">#&gt; 1999-03-01 0.938</span></span>
<span id="cb1012-15"><a href="TimeSeriesAnalysis.html#cb1012-15" tabindex="-1"></a><span class="co">#&gt; 1999-04-01 0.945</span></span>
<span id="cb1012-16"><a href="TimeSeriesAnalysis.html#cb1012-16" tabindex="-1"></a><span class="co">#&gt; 1999-05-01 0.945</span></span>
<span id="cb1012-17"><a href="TimeSeriesAnalysis.html#cb1012-17" tabindex="-1"></a><span class="co">#&gt; 1999-06-01 0.945</span></span></code></pre></div>
<p>Obviously, the two time series have different timestamps because one is
daily data and the other is monthly data. Even worse, the downloaded CPI
data is timestamped for the first day of every month, even when that day
is a holiday or weekend (e.g., New Year’s Day).</p>
<p>Thank goodness for the <code>merge</code> function, which handles the messy details
of reconciling the different dates:</p>
<div class="sourceCode" id="cb1013"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1013-1"><a href="TimeSeriesAnalysis.html#cb1013-1" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">merge</span>(ibm, cpi))</span>
<span id="cb1013-2"><a href="TimeSeriesAnalysis.html#cb1013-2" tabindex="-1"></a><span class="co">#&gt;             ibm   cpi</span></span>
<span id="cb1013-3"><a href="TimeSeriesAnalysis.html#cb1013-3" tabindex="-1"></a><span class="co">#&gt; 1999-01-01   NA 0.938</span></span>
<span id="cb1013-4"><a href="TimeSeriesAnalysis.html#cb1013-4" tabindex="-1"></a><span class="co">#&gt; 1999-01-04 64.2    NA</span></span>
<span id="cb1013-5"><a href="TimeSeriesAnalysis.html#cb1013-5" tabindex="-1"></a><span class="co">#&gt; 1999-01-05 66.5    NA</span></span>
<span id="cb1013-6"><a href="TimeSeriesAnalysis.html#cb1013-6" tabindex="-1"></a><span class="co">#&gt; 1999-01-06 66.2    NA</span></span>
<span id="cb1013-7"><a href="TimeSeriesAnalysis.html#cb1013-7" tabindex="-1"></a><span class="co">#&gt; 1999-01-07 66.7    NA</span></span>
<span id="cb1013-8"><a href="TimeSeriesAnalysis.html#cb1013-8" tabindex="-1"></a><span class="co">#&gt; 1999-01-08 65.8    NA</span></span></code></pre></div>
<p>By default, <code>merge</code> finds the <em>union</em> of all dates: the output contains
all dates from both inputs, and missing observations are filled with <code>NA</code>
values. You can replace those <code>NA</code> values with the most recent observation
by using the <code>na.locf</code> function from the <code>zoo</code> package:</p>
<div class="sourceCode" id="cb1014"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1014-1"><a href="TimeSeriesAnalysis.html#cb1014-1" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">na.locf</span>(<span class="fu">merge</span>(ibm, cpi)))</span>
<span id="cb1014-2"><a href="TimeSeriesAnalysis.html#cb1014-2" tabindex="-1"></a><span class="co">#&gt;             ibm   cpi</span></span>
<span id="cb1014-3"><a href="TimeSeriesAnalysis.html#cb1014-3" tabindex="-1"></a><span class="co">#&gt; 1999-01-01   NA 0.938</span></span>
<span id="cb1014-4"><a href="TimeSeriesAnalysis.html#cb1014-4" tabindex="-1"></a><span class="co">#&gt; 1999-01-04 64.2 0.938</span></span>
<span id="cb1014-5"><a href="TimeSeriesAnalysis.html#cb1014-5" tabindex="-1"></a><span class="co">#&gt; 1999-01-05 66.5 0.938</span></span>
<span id="cb1014-6"><a href="TimeSeriesAnalysis.html#cb1014-6" tabindex="-1"></a><span class="co">#&gt; 1999-01-06 66.2 0.938</span></span>
<span id="cb1014-7"><a href="TimeSeriesAnalysis.html#cb1014-7" tabindex="-1"></a><span class="co">#&gt; 1999-01-07 66.7 0.938</span></span>
<span id="cb1014-8"><a href="TimeSeriesAnalysis.html#cb1014-8" tabindex="-1"></a><span class="co">#&gt; 1999-01-08 65.8 0.938</span></span></code></pre></div>
<p>(Here <code>locf</code> stands for “last observation carried forward.”) Observe
that the <code>NA</code>s were replaced. However, <code>na.locf</code> left an NA in the first
observation (1999-01-01) because there was no IBM stock price on that
day.</p>
<p>You can get the <em>intersection</em> of all dates by setting <code>all = FALSE</code>:</p>
<div class="sourceCode" id="cb1015"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1015-1"><a href="TimeSeriesAnalysis.html#cb1015-1" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">merge</span>(ibm, cpi, <span class="at">all =</span> <span class="cn">FALSE</span>))</span>
<span id="cb1015-2"><a href="TimeSeriesAnalysis.html#cb1015-2" tabindex="-1"></a><span class="co">#&gt;             ibm   cpi</span></span>
<span id="cb1015-3"><a href="TimeSeriesAnalysis.html#cb1015-3" tabindex="-1"></a><span class="co">#&gt; 1999-02-01 63.1 0.938</span></span>
<span id="cb1015-4"><a href="TimeSeriesAnalysis.html#cb1015-4" tabindex="-1"></a><span class="co">#&gt; 1999-03-01 59.2 0.938</span></span>
<span id="cb1015-5"><a href="TimeSeriesAnalysis.html#cb1015-5" tabindex="-1"></a><span class="co">#&gt; 1999-04-01 62.3 0.945</span></span>
<span id="cb1015-6"><a href="TimeSeriesAnalysis.html#cb1015-6" tabindex="-1"></a><span class="co">#&gt; 1999-06-01 79.0 0.945</span></span>
<span id="cb1015-7"><a href="TimeSeriesAnalysis.html#cb1015-7" tabindex="-1"></a><span class="co">#&gt; 1999-07-01 92.4 0.949</span></span>
<span id="cb1015-8"><a href="TimeSeriesAnalysis.html#cb1015-8" tabindex="-1"></a><span class="co">#&gt; 1999-09-01 89.8 0.956</span></span></code></pre></div>
<p>Now the output is limited to observations that are <em>common</em> to both
files.</p>
<p>Notice, however, that the intersection begins on February 1, not January 1.
The reason is that January 1 is a holiday, so there is no IBM stock price for that date and hence no
intersection with the CPI data. To fix this, see Recipe <a href="TimeSeriesAnalysis.html#recipe-id239">14.6</a>, <a href="TimeSeriesAnalysis.html#recipe-id239">“Filling or Padding a Time Series”</a>.</p>
</div>
</div>
<div id="recipe-id239" class="section level2 hasAnchor" number="14.6">
<h2><span class="header-section-number">14.6</span> Filling or Padding a Time Series<a href="TimeSeriesAnalysis.html#recipe-id239" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id239" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id239" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Your time series data is missing observations. You want to fill or pad
the data with the missing dates/times.</p>
</div>
<div id="solution-id239" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id239" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Create a zero-width (dataless) <code>zoo</code> or <code>xts</code> object with the missing
dates/times. Then merge your data with the zero-width object, taking the
union of all dates:</p>
<div class="sourceCode" id="cb1016"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1016-1"><a href="TimeSeriesAnalysis.html#cb1016-1" tabindex="-1"></a>empty <span class="ot">&lt;-</span> <span class="fu">zoo</span>(, dates) <span class="co"># &#39;dates&#39; is vector of the missing dates</span></span>
<span id="cb1016-2"><a href="TimeSeriesAnalysis.html#cb1016-2" tabindex="-1"></a><span class="fu">merge</span>(ts, empty, <span class="at">all =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="discussion-id239" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id239" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>zoo</code> package includes a handy feature in the constructor for <code>zoo</code>
objects: you can omit the data and build a zero-width object. The object
contains no data, just dates. We can use these “Frankenstein” objects to
perform such operations as filling and padding on other time series
objects.</p>
<p>Suppose you download monthly CPI data used in the last recipe. The data is
timestamped with the first day of each month:</p>
<div class="sourceCode" id="cb1017"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1017-1"><a href="TimeSeriesAnalysis.html#cb1017-1" tabindex="-1"></a><span class="fu">head</span>(cpi)</span>
<span id="cb1017-2"><a href="TimeSeriesAnalysis.html#cb1017-2" tabindex="-1"></a><span class="co">#&gt;              cpi</span></span>
<span id="cb1017-3"><a href="TimeSeriesAnalysis.html#cb1017-3" tabindex="-1"></a><span class="co">#&gt; 1999-01-01 0.938</span></span>
<span id="cb1017-4"><a href="TimeSeriesAnalysis.html#cb1017-4" tabindex="-1"></a><span class="co">#&gt; 1999-02-01 0.938</span></span>
<span id="cb1017-5"><a href="TimeSeriesAnalysis.html#cb1017-5" tabindex="-1"></a><span class="co">#&gt; 1999-03-01 0.938</span></span>
<span id="cb1017-6"><a href="TimeSeriesAnalysis.html#cb1017-6" tabindex="-1"></a><span class="co">#&gt; 1999-04-01 0.945</span></span>
<span id="cb1017-7"><a href="TimeSeriesAnalysis.html#cb1017-7" tabindex="-1"></a><span class="co">#&gt; 1999-05-01 0.945</span></span>
<span id="cb1017-8"><a href="TimeSeriesAnalysis.html#cb1017-8" tabindex="-1"></a><span class="co">#&gt; 1999-06-01 0.945</span></span></code></pre></div>
<p>As far as R knows, we have no observations for the other days of the
months. However, we know that each CPI value applies to the subsequent
days through month-end. So first we build a zero-width object with every
day of the decade, but no data:</p>
<div class="sourceCode" id="cb1018"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1018-1"><a href="TimeSeriesAnalysis.html#cb1018-1" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(<span class="fu">index</span>(cpi)), <span class="at">to =</span> <span class="fu">max</span>(<span class="fu">index</span>(cpi)), <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb1018-2"><a href="TimeSeriesAnalysis.html#cb1018-2" tabindex="-1"></a>empty <span class="ot">&lt;-</span> <span class="fu">zoo</span>(, dates)</span></code></pre></div>
<p>We use the <code>min(index(cpi))</code> and <code>max(index(cpi))</code> to get the minimum and maximum index value from our <code>cpi</code>data. So our resulting <code>empty</code> object is just an index of daily dates with the same range as our <code>cpi</code> data.</p>
<p>Then we take the union the CPI data and the zero-width object, yielding
a dataset filled with <code>NA</code> values:</p>
<div class="sourceCode" id="cb1019"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1019-1"><a href="TimeSeriesAnalysis.html#cb1019-1" tabindex="-1"></a>filled.cpi <span class="ot">&lt;-</span> <span class="fu">merge</span>(cpi, empty, <span class="at">all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1019-2"><a href="TimeSeriesAnalysis.html#cb1019-2" tabindex="-1"></a><span class="fu">head</span>(filled.cpi)</span>
<span id="cb1019-3"><a href="TimeSeriesAnalysis.html#cb1019-3" tabindex="-1"></a><span class="co">#&gt;              cpi</span></span>
<span id="cb1019-4"><a href="TimeSeriesAnalysis.html#cb1019-4" tabindex="-1"></a><span class="co">#&gt; 1999-01-01 0.938</span></span>
<span id="cb1019-5"><a href="TimeSeriesAnalysis.html#cb1019-5" tabindex="-1"></a><span class="co">#&gt; 1999-01-02    NA</span></span>
<span id="cb1019-6"><a href="TimeSeriesAnalysis.html#cb1019-6" tabindex="-1"></a><span class="co">#&gt; 1999-01-03    NA</span></span>
<span id="cb1019-7"><a href="TimeSeriesAnalysis.html#cb1019-7" tabindex="-1"></a><span class="co">#&gt; 1999-01-04    NA</span></span>
<span id="cb1019-8"><a href="TimeSeriesAnalysis.html#cb1019-8" tabindex="-1"></a><span class="co">#&gt; 1999-01-05    NA</span></span>
<span id="cb1019-9"><a href="TimeSeriesAnalysis.html#cb1019-9" tabindex="-1"></a><span class="co">#&gt; 1999-01-06    NA</span></span></code></pre></div>
<p>The resulting time series contains every calendar day, with <code>NA</code>s where
there was no observation. That might be what you need. However, a more
common requirement is to replace each <code>NA</code> with the most recent
observation as of that date. The <code>na.locf</code> function from the <code>zoo</code>
package does exactly that:</p>
<div class="sourceCode" id="cb1020"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1020-1"><a href="TimeSeriesAnalysis.html#cb1020-1" tabindex="-1"></a>filled.cpi <span class="ot">&lt;-</span> <span class="fu">na.locf</span>(<span class="fu">merge</span>(cpi, empty, <span class="at">all =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1020-2"><a href="TimeSeriesAnalysis.html#cb1020-2" tabindex="-1"></a><span class="fu">head</span>(filled.cpi)</span>
<span id="cb1020-3"><a href="TimeSeriesAnalysis.html#cb1020-3" tabindex="-1"></a><span class="co">#&gt;              cpi</span></span>
<span id="cb1020-4"><a href="TimeSeriesAnalysis.html#cb1020-4" tabindex="-1"></a><span class="co">#&gt; 1999-01-01 0.938</span></span>
<span id="cb1020-5"><a href="TimeSeriesAnalysis.html#cb1020-5" tabindex="-1"></a><span class="co">#&gt; 1999-01-02 0.938</span></span>
<span id="cb1020-6"><a href="TimeSeriesAnalysis.html#cb1020-6" tabindex="-1"></a><span class="co">#&gt; 1999-01-03 0.938</span></span>
<span id="cb1020-7"><a href="TimeSeriesAnalysis.html#cb1020-7" tabindex="-1"></a><span class="co">#&gt; 1999-01-04 0.938</span></span>
<span id="cb1020-8"><a href="TimeSeriesAnalysis.html#cb1020-8" tabindex="-1"></a><span class="co">#&gt; 1999-01-05 0.938</span></span>
<span id="cb1020-9"><a href="TimeSeriesAnalysis.html#cb1020-9" tabindex="-1"></a><span class="co">#&gt; 1999-01-06 0.938</span></span></code></pre></div>
<p>January’s value of <code>1</code> is carried forward until February 1, at which
time it is replaced by the February value. Now every day has the
latest CPI value as of that date. Note that in this dataset, the CPI is based on January 1, 1999 = 100% and all CPI values are relative to the value on that date.</p>
<div class="sourceCode" id="cb1021"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1021-1"><a href="TimeSeriesAnalysis.html#cb1021-1" tabindex="-1"></a><span class="fu">tail</span>(filled.cpi)</span>
<span id="cb1021-2"><a href="TimeSeriesAnalysis.html#cb1021-2" tabindex="-1"></a><span class="co">#&gt;             cpi</span></span>
<span id="cb1021-3"><a href="TimeSeriesAnalysis.html#cb1021-3" tabindex="-1"></a><span class="co">#&gt; 2017-11-26 1.41</span></span>
<span id="cb1021-4"><a href="TimeSeriesAnalysis.html#cb1021-4" tabindex="-1"></a><span class="co">#&gt; 2017-11-27 1.41</span></span>
<span id="cb1021-5"><a href="TimeSeriesAnalysis.html#cb1021-5" tabindex="-1"></a><span class="co">#&gt; 2017-11-28 1.41</span></span>
<span id="cb1021-6"><a href="TimeSeriesAnalysis.html#cb1021-6" tabindex="-1"></a><span class="co">#&gt; 2017-11-29 1.41</span></span>
<span id="cb1021-7"><a href="TimeSeriesAnalysis.html#cb1021-7" tabindex="-1"></a><span class="co">#&gt; 2017-11-30 1.41</span></span>
<span id="cb1021-8"><a href="TimeSeriesAnalysis.html#cb1021-8" tabindex="-1"></a><span class="co">#&gt; 2017-12-01 1.41</span></span></code></pre></div>
<p>We can use this recipe to fix the problem mentioned in Recipe <a href="TimeSeriesAnalysis.html#recipe-id079">14.5</a>, <a href="TimeSeriesAnalysis.html#recipe-id079">“Merging Several Time Series”</a>. There, the daily price of
IBM stock and the monthly CPI data had no intersection on certain days.
We can fix that using several different methods. One way is to pad the
IBM data to include the CPI dates and then take the intersection (recall
that <code>index(cpi)</code> returns all the dates in the CPI time series):</p>
<div class="sourceCode" id="cb1022"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1022-1"><a href="TimeSeriesAnalysis.html#cb1022-1" tabindex="-1"></a>filled.ibm <span class="ot">&lt;-</span> <span class="fu">na.locf</span>(<span class="fu">merge</span>(ibm, <span class="fu">zoo</span>(, <span class="fu">index</span>(cpi))))</span>
<span id="cb1022-2"><a href="TimeSeriesAnalysis.html#cb1022-2" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">merge</span>(filled.ibm, cpi, <span class="at">all =</span> <span class="cn">FALSE</span>))</span>
<span id="cb1022-3"><a href="TimeSeriesAnalysis.html#cb1022-3" tabindex="-1"></a><span class="co">#&gt;             ibm   cpi</span></span>
<span id="cb1022-4"><a href="TimeSeriesAnalysis.html#cb1022-4" tabindex="-1"></a><span class="co">#&gt; 1999-01-01   NA 0.938</span></span>
<span id="cb1022-5"><a href="TimeSeriesAnalysis.html#cb1022-5" tabindex="-1"></a><span class="co">#&gt; 1999-02-01 63.1 0.938</span></span>
<span id="cb1022-6"><a href="TimeSeriesAnalysis.html#cb1022-6" tabindex="-1"></a><span class="co">#&gt; 1999-03-01 59.2 0.938</span></span>
<span id="cb1022-7"><a href="TimeSeriesAnalysis.html#cb1022-7" tabindex="-1"></a><span class="co">#&gt; 1999-04-01 62.3 0.945</span></span>
<span id="cb1022-8"><a href="TimeSeriesAnalysis.html#cb1022-8" tabindex="-1"></a><span class="co">#&gt; 1999-05-01 73.6 0.945</span></span>
<span id="cb1022-9"><a href="TimeSeriesAnalysis.html#cb1022-9" tabindex="-1"></a><span class="co">#&gt; 1999-06-01 79.0 0.945</span></span></code></pre></div>
<p>That gives monthly observations. Another way is to fill out the CPI data
(as described previously) and then take the intersection with the IBM
data. That gives daily observations, as follows:</p>
<div class="sourceCode" id="cb1023"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1023-1"><a href="TimeSeriesAnalysis.html#cb1023-1" tabindex="-1"></a>filled_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(ibm, filled.cpi, <span class="at">all =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1023-2"><a href="TimeSeriesAnalysis.html#cb1023-2" tabindex="-1"></a><span class="fu">head</span>(filled_data)</span>
<span id="cb1023-3"><a href="TimeSeriesAnalysis.html#cb1023-3" tabindex="-1"></a><span class="co">#&gt;             ibm   cpi</span></span>
<span id="cb1023-4"><a href="TimeSeriesAnalysis.html#cb1023-4" tabindex="-1"></a><span class="co">#&gt; 1999-01-04 64.2 0.938</span></span>
<span id="cb1023-5"><a href="TimeSeriesAnalysis.html#cb1023-5" tabindex="-1"></a><span class="co">#&gt; 1999-01-05 66.5 0.938</span></span>
<span id="cb1023-6"><a href="TimeSeriesAnalysis.html#cb1023-6" tabindex="-1"></a><span class="co">#&gt; 1999-01-06 66.2 0.938</span></span>
<span id="cb1023-7"><a href="TimeSeriesAnalysis.html#cb1023-7" tabindex="-1"></a><span class="co">#&gt; 1999-01-07 66.7 0.938</span></span>
<span id="cb1023-8"><a href="TimeSeriesAnalysis.html#cb1023-8" tabindex="-1"></a><span class="co">#&gt; 1999-01-08 65.8 0.938</span></span>
<span id="cb1023-9"><a href="TimeSeriesAnalysis.html#cb1023-9" tabindex="-1"></a><span class="co">#&gt; 1999-01-11 66.4 0.938</span></span></code></pre></div>
<p>Another common method for filling missing values uses the <em>cubic spline</em> technique,
which interpolates smooth intermediate values from the known data.
We can use the <code>zoo</code> function <code>na.spline</code> to fill our missing values using a cubic spline.</p>
<div class="sourceCode" id="cb1024"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1024-1"><a href="TimeSeriesAnalysis.html#cb1024-1" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(ibm, cpi, <span class="at">all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1024-2"><a href="TimeSeriesAnalysis.html#cb1024-2" tabindex="-1"></a><span class="fu">head</span>(combined_data)</span>
<span id="cb1024-3"><a href="TimeSeriesAnalysis.html#cb1024-3" tabindex="-1"></a><span class="co">#&gt;             ibm   cpi</span></span>
<span id="cb1024-4"><a href="TimeSeriesAnalysis.html#cb1024-4" tabindex="-1"></a><span class="co">#&gt; 1999-01-01   NA 0.938</span></span>
<span id="cb1024-5"><a href="TimeSeriesAnalysis.html#cb1024-5" tabindex="-1"></a><span class="co">#&gt; 1999-01-04 64.2    NA</span></span>
<span id="cb1024-6"><a href="TimeSeriesAnalysis.html#cb1024-6" tabindex="-1"></a><span class="co">#&gt; 1999-01-05 66.5    NA</span></span>
<span id="cb1024-7"><a href="TimeSeriesAnalysis.html#cb1024-7" tabindex="-1"></a><span class="co">#&gt; 1999-01-06 66.2    NA</span></span>
<span id="cb1024-8"><a href="TimeSeriesAnalysis.html#cb1024-8" tabindex="-1"></a><span class="co">#&gt; 1999-01-07 66.7    NA</span></span>
<span id="cb1024-9"><a href="TimeSeriesAnalysis.html#cb1024-9" tabindex="-1"></a><span class="co">#&gt; 1999-01-08 65.8    NA</span></span>
<span id="cb1024-10"><a href="TimeSeriesAnalysis.html#cb1024-10" tabindex="-1"></a></span>
<span id="cb1024-11"><a href="TimeSeriesAnalysis.html#cb1024-11" tabindex="-1"></a>combined_spline <span class="ot">&lt;-</span> <span class="fu">na.spline</span>(combined_data)</span>
<span id="cb1024-12"><a href="TimeSeriesAnalysis.html#cb1024-12" tabindex="-1"></a><span class="fu">head</span>(combined_spline)</span>
<span id="cb1024-13"><a href="TimeSeriesAnalysis.html#cb1024-13" tabindex="-1"></a><span class="co">#&gt;              ibm   cpi</span></span>
<span id="cb1024-14"><a href="TimeSeriesAnalysis.html#cb1024-14" tabindex="-1"></a><span class="co">#&gt; 1999-01-01  4.59 0.938</span></span>
<span id="cb1024-15"><a href="TimeSeriesAnalysis.html#cb1024-15" tabindex="-1"></a><span class="co">#&gt; 1999-01-04 64.19 0.938</span></span>
<span id="cb1024-16"><a href="TimeSeriesAnalysis.html#cb1024-16" tabindex="-1"></a><span class="co">#&gt; 1999-01-05 66.52 0.938</span></span>
<span id="cb1024-17"><a href="TimeSeriesAnalysis.html#cb1024-17" tabindex="-1"></a><span class="co">#&gt; 1999-01-06 66.21 0.938</span></span>
<span id="cb1024-18"><a href="TimeSeriesAnalysis.html#cb1024-18" tabindex="-1"></a><span class="co">#&gt; 1999-01-07 66.71 0.938</span></span>
<span id="cb1024-19"><a href="TimeSeriesAnalysis.html#cb1024-19" tabindex="-1"></a><span class="co">#&gt; 1999-01-08 65.79 0.938</span></span></code></pre></div>
<p>Notice that both the missing values for <code>cpi</code> and <code>ibm</code> were filled. However, the value filled in for January 1, 1999 for the <code>ibm</code> column seems out of line with the January 4th observation. This illustrates one of the challenges with cubic splines: they can become quite unstable if the value that is being interpolated is at the very beginning or the very end of a series. To get around this instability, we could get some data points from before January 1st, 1999, then interpolate using <code>na.spline</code>, or we could simply choose a different interpolation method.</p>
</div>
</div>
<div id="recipe-id280" class="section level2 hasAnchor" number="14.7">
<h2><span class="header-section-number">14.7</span> Lagging a Time Series<a href="TimeSeriesAnalysis.html#recipe-id280" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id280" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id280" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You want to shift a time series in time, either forward or backward.</p>
</div>
<div id="solution-id280" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id280" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use the <code>lag</code> function. The second argument, <code>k</code>, is the number of periods
to shift the data:</p>
<div class="sourceCode" id="cb1025"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1025-1"><a href="TimeSeriesAnalysis.html#cb1025-1" tabindex="-1"></a><span class="fu">lag</span>(ts, k)</span></code></pre></div>
<p>Use positive <code>k</code> to shift the data forward in time (tomorrow’s data
becomes today’s data). Use a negative <code>k</code> to shift the data backward in
time (yesterday’s data becomes today’s data).</p>
</div>
<div id="discussion-id280" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id280" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Recall the <code>zoo</code> object containing five days of IBM stock prices from Recipe <a href="TimeSeriesAnalysis.html#recipe-id076">14.1</a>, <a href="TimeSeriesAnalysis.html#recipe-id076">“Representing Time Series Data”</a>:</p>
<div class="sourceCode" id="cb1026"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1026-1"><a href="TimeSeriesAnalysis.html#cb1026-1" tabindex="-1"></a>ibm.daily</span>
<span id="cb1026-2"><a href="TimeSeriesAnalysis.html#cb1026-2" tabindex="-1"></a><span class="co">#&gt; 2010-01-04 2010-01-05 2010-01-06 2010-01-07 2010-01-08 </span></span>
<span id="cb1026-3"><a href="TimeSeriesAnalysis.html#cb1026-3" tabindex="-1"></a><span class="co">#&gt;        132        131        130        130        131</span></span></code></pre></div>
<p>To shift the data forward one day, we use <code>k = +1</code>:</p>
<div class="sourceCode" id="cb1027"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1027-1"><a href="TimeSeriesAnalysis.html#cb1027-1" tabindex="-1"></a><span class="fu">lag</span>(ibm.daily, <span class="at">k =</span> <span class="sc">+</span><span class="dv">1</span>, <span class="at">na.pad =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1027-2"><a href="TimeSeriesAnalysis.html#cb1027-2" tabindex="-1"></a><span class="co">#&gt; 2010-01-04 2010-01-05 2010-01-06 2010-01-07 2010-01-08 </span></span>
<span id="cb1027-3"><a href="TimeSeriesAnalysis.html#cb1027-3" tabindex="-1"></a><span class="co">#&gt;        131        130        130        131         NA</span></span></code></pre></div>
<p>We also set <code>na.pad = TRUE</code> to fill the trailing dates with <code>NA</code>. Otherwise,
they would simply be dropped, resulting in a shortened time series.</p>
<p>To shift the data backward one day, we use <code>k = -1</code>. Again we use
<code>na.pad = TRUE</code> to pad the beginning with <code>NA</code>s:</p>
<div class="sourceCode" id="cb1028"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1028-1"><a href="TimeSeriesAnalysis.html#cb1028-1" tabindex="-1"></a><span class="fu">lag</span>(ibm.daily, <span class="at">k =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">na.pad =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1028-2"><a href="TimeSeriesAnalysis.html#cb1028-2" tabindex="-1"></a><span class="co">#&gt; 2010-01-04 2010-01-05 2010-01-06 2010-01-07 2010-01-08 </span></span>
<span id="cb1028-3"><a href="TimeSeriesAnalysis.html#cb1028-3" tabindex="-1"></a><span class="co">#&gt;         NA        132        131        130        130</span></span></code></pre></div>
<p>If the sign convention for <code>k</code> seems odd to you, you are not alone.</p>
<blockquote>
<p><strong>Warning</strong></p>
<p>The function is called <code>lag</code>, but a positive <code>k</code> actually generates
<em>leading</em> data, not lagging data. Use a negative <code>k</code> to get <em>lagging</em>
data. Yes, this is bizarre. Perhaps the function should have been
called <code>lead</code>.</p>
</blockquote>
<p>The other thing to be careful with when using <code>lag</code> is that the <code>dplyr</code> package contains a function named <code>lag</code> as well. The arguments for <code>dplyr::lag</code> are not exactly the same as the Base R <code>lag</code> function. In particular, <code>dplyr</code> uses <code>n</code> instead of <code>k</code>:</p>
<div class="sourceCode" id="cb1029"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1029-1"><a href="TimeSeriesAnalysis.html#cb1029-1" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">lag</span>(ibm.daily, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb1029-2"><a href="TimeSeriesAnalysis.html#cb1029-2" tabindex="-1"></a><span class="co">#&gt; 2010-01-04 2010-01-05 2010-01-06 2010-01-07       &lt;NA&gt; </span></span>
<span id="cb1029-3"><a href="TimeSeriesAnalysis.html#cb1029-3" tabindex="-1"></a><span class="co">#&gt;        132        131        130        130         NA</span></span></code></pre></div>
<blockquote>
<p><strong>Warning</strong></p>
<p>If you want to load <code>dplyr</code>, you should use the namespace to be explicit about which <code>lag</code> function you are using. The Base R function is <code>stats::lag</code>, while the dplyr function is, naturally, <code>dplyr::lag</code>.</p>
</blockquote>
</div>
</div>
<div id="recipe-id141" class="section level2 hasAnchor" number="14.8">
<h2><span class="header-section-number">14.8</span> Computing Successive Differences<a href="TimeSeriesAnalysis.html#recipe-id141" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id141" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id141" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Given a time series, <em>x</em>, you want to compute the difference between
successive observations: (<em>x</em><sub>2</sub> – <em>x</em><sub>1</sub>), (<em>x</em><sub>3</sub> – <em>x</em><sub>2</sub>), (<em>x</em><sub>4</sub> –
<em>x</em><sub>3</sub>), ….</p>
</div>
<div id="solution-id141" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id141" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use the <code>diff</code> function:</p>
<div class="sourceCode" id="cb1030"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1030-1"><a href="TimeSeriesAnalysis.html#cb1030-1" tabindex="-1"></a><span class="fu">diff</span>(x)</span></code></pre></div>
</div>
<div id="discussion-id141" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id141" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>diff</code> function is generic, so it works on simple vectors, <code>xts</code> objects, and
<code>zoo</code> objects. The beauty of differencing a <code>zoo</code> or <code>xts</code> object is that the
result is the same type object you started with <em>and</em> the differences have the correct
dates. Here we compute the differences for successive prices of IBM
stock:</p>
<div class="sourceCode" id="cb1031"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1031-1"><a href="TimeSeriesAnalysis.html#cb1031-1" tabindex="-1"></a>ibm.daily</span>
<span id="cb1031-2"><a href="TimeSeriesAnalysis.html#cb1031-2" tabindex="-1"></a><span class="co">#&gt; 2010-01-04 2010-01-05 2010-01-06 2010-01-07 2010-01-08 </span></span>
<span id="cb1031-3"><a href="TimeSeriesAnalysis.html#cb1031-3" tabindex="-1"></a><span class="co">#&gt;        132        131        130        130        131</span></span>
<span id="cb1031-4"><a href="TimeSeriesAnalysis.html#cb1031-4" tabindex="-1"></a><span class="fu">diff</span>(ibm.daily)</span>
<span id="cb1031-5"><a href="TimeSeriesAnalysis.html#cb1031-5" tabindex="-1"></a><span class="co">#&gt; 2010-01-05 2010-01-06 2010-01-07 2010-01-08 </span></span>
<span id="cb1031-6"><a href="TimeSeriesAnalysis.html#cb1031-6" tabindex="-1"></a><span class="co">#&gt;      -1.60      -0.85      -0.45       1.30</span></span></code></pre></div>
<p>The difference labeled 2010-01-05 is the change from the previous day
(2010-01-04), which is usually what you want. The differenced series is
shorter than the original series by one element because R can’t compute
the change as of 2010-01-04, of course.</p>
<p>By default, <code>diff</code> computes successive differences. You can compute
differences that are more widely spaced by using its <code>lag</code> parameter.
Suppose you have monthly CPI data and want to compute the change from
the previous 12 months, giving the year-over-year change. Specify a <code>lag</code>
of <code>12</code>:</p>
<div class="sourceCode" id="cb1032"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1032-1"><a href="TimeSeriesAnalysis.html#cb1032-1" tabindex="-1"></a><span class="fu">head</span>(cpi, <span class="dv">24</span>)</span>
<span id="cb1032-2"><a href="TimeSeriesAnalysis.html#cb1032-2" tabindex="-1"></a><span class="co">#&gt;              cpi</span></span>
<span id="cb1032-3"><a href="TimeSeriesAnalysis.html#cb1032-3" tabindex="-1"></a><span class="co">#&gt; 1999-01-01 0.938</span></span>
<span id="cb1032-4"><a href="TimeSeriesAnalysis.html#cb1032-4" tabindex="-1"></a><span class="co">#&gt; 1999-02-01 0.938</span></span>
<span id="cb1032-5"><a href="TimeSeriesAnalysis.html#cb1032-5" tabindex="-1"></a><span class="co">#&gt; 1999-03-01 0.938</span></span>
<span id="cb1032-6"><a href="TimeSeriesAnalysis.html#cb1032-6" tabindex="-1"></a><span class="co">#&gt; 1999-04-01 0.945</span></span>
<span id="cb1032-7"><a href="TimeSeriesAnalysis.html#cb1032-7" tabindex="-1"></a><span class="co">#&gt; 1999-05-01 0.945</span></span>
<span id="cb1032-8"><a href="TimeSeriesAnalysis.html#cb1032-8" tabindex="-1"></a><span class="co">#&gt; 1999-06-01 0.945</span></span>
<span id="cb1032-9"><a href="TimeSeriesAnalysis.html#cb1032-9" tabindex="-1"></a><span class="co">#&gt; 1999-07-01 0.949</span></span>
<span id="cb1032-10"><a href="TimeSeriesAnalysis.html#cb1032-10" tabindex="-1"></a><span class="co">#&gt; 1999-08-01 0.952</span></span>
<span id="cb1032-11"><a href="TimeSeriesAnalysis.html#cb1032-11" tabindex="-1"></a><span class="co">#&gt; 1999-09-01 0.956</span></span>
<span id="cb1032-12"><a href="TimeSeriesAnalysis.html#cb1032-12" tabindex="-1"></a><span class="co">#&gt; 1999-10-01 0.957</span></span>
<span id="cb1032-13"><a href="TimeSeriesAnalysis.html#cb1032-13" tabindex="-1"></a><span class="co">#&gt; 1999-11-01 0.959</span></span>
<span id="cb1032-14"><a href="TimeSeriesAnalysis.html#cb1032-14" tabindex="-1"></a><span class="co">#&gt; 1999-12-01 0.961</span></span>
<span id="cb1032-15"><a href="TimeSeriesAnalysis.html#cb1032-15" tabindex="-1"></a><span class="co">#&gt; 2000-01-01 0.964</span></span>
<span id="cb1032-16"><a href="TimeSeriesAnalysis.html#cb1032-16" tabindex="-1"></a><span class="co">#&gt; 2000-02-01 0.968</span></span>
<span id="cb1032-17"><a href="TimeSeriesAnalysis.html#cb1032-17" tabindex="-1"></a><span class="co">#&gt; 2000-03-01 0.974</span></span>
<span id="cb1032-18"><a href="TimeSeriesAnalysis.html#cb1032-18" tabindex="-1"></a><span class="co">#&gt; 2000-04-01 0.973</span></span>
<span id="cb1032-19"><a href="TimeSeriesAnalysis.html#cb1032-19" tabindex="-1"></a><span class="co">#&gt; 2000-05-01 0.975</span></span>
<span id="cb1032-20"><a href="TimeSeriesAnalysis.html#cb1032-20" tabindex="-1"></a><span class="co">#&gt; 2000-06-01 0.981</span></span>
<span id="cb1032-21"><a href="TimeSeriesAnalysis.html#cb1032-21" tabindex="-1"></a><span class="co">#&gt; 2000-07-01 0.983</span></span>
<span id="cb1032-22"><a href="TimeSeriesAnalysis.html#cb1032-22" tabindex="-1"></a><span class="co">#&gt; 2000-08-01 0.983</span></span>
<span id="cb1032-23"><a href="TimeSeriesAnalysis.html#cb1032-23" tabindex="-1"></a><span class="co">#&gt; 2000-09-01 0.989</span></span>
<span id="cb1032-24"><a href="TimeSeriesAnalysis.html#cb1032-24" tabindex="-1"></a><span class="co">#&gt; 2000-10-01 0.990</span></span>
<span id="cb1032-25"><a href="TimeSeriesAnalysis.html#cb1032-25" tabindex="-1"></a><span class="co">#&gt; 2000-11-01 0.992</span></span>
<span id="cb1032-26"><a href="TimeSeriesAnalysis.html#cb1032-26" tabindex="-1"></a><span class="co">#&gt; 2000-12-01 0.994</span></span>
<span id="cb1032-27"><a href="TimeSeriesAnalysis.html#cb1032-27" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">diff</span>(cpi, <span class="at">lag =</span> <span class="dv">12</span>), <span class="dv">24</span>) <span class="co"># Compute year-over-year change</span></span>
<span id="cb1032-28"><a href="TimeSeriesAnalysis.html#cb1032-28" tabindex="-1"></a><span class="co">#&gt;               cpi</span></span>
<span id="cb1032-29"><a href="TimeSeriesAnalysis.html#cb1032-29" tabindex="-1"></a><span class="co">#&gt; 1999-01-01     NA</span></span>
<span id="cb1032-30"><a href="TimeSeriesAnalysis.html#cb1032-30" tabindex="-1"></a><span class="co">#&gt; 1999-02-01     NA</span></span>
<span id="cb1032-31"><a href="TimeSeriesAnalysis.html#cb1032-31" tabindex="-1"></a><span class="co">#&gt; 1999-03-01     NA</span></span>
<span id="cb1032-32"><a href="TimeSeriesAnalysis.html#cb1032-32" tabindex="-1"></a><span class="co">#&gt; 1999-04-01     NA</span></span>
<span id="cb1032-33"><a href="TimeSeriesAnalysis.html#cb1032-33" tabindex="-1"></a><span class="co">#&gt; 1999-05-01     NA</span></span>
<span id="cb1032-34"><a href="TimeSeriesAnalysis.html#cb1032-34" tabindex="-1"></a><span class="co">#&gt; 1999-06-01     NA</span></span>
<span id="cb1032-35"><a href="TimeSeriesAnalysis.html#cb1032-35" tabindex="-1"></a><span class="co">#&gt; 1999-07-01     NA</span></span>
<span id="cb1032-36"><a href="TimeSeriesAnalysis.html#cb1032-36" tabindex="-1"></a><span class="co">#&gt; 1999-08-01     NA</span></span>
<span id="cb1032-37"><a href="TimeSeriesAnalysis.html#cb1032-37" tabindex="-1"></a><span class="co">#&gt; 1999-09-01     NA</span></span>
<span id="cb1032-38"><a href="TimeSeriesAnalysis.html#cb1032-38" tabindex="-1"></a><span class="co">#&gt; 1999-10-01     NA</span></span>
<span id="cb1032-39"><a href="TimeSeriesAnalysis.html#cb1032-39" tabindex="-1"></a><span class="co">#&gt; 1999-11-01     NA</span></span>
<span id="cb1032-40"><a href="TimeSeriesAnalysis.html#cb1032-40" tabindex="-1"></a><span class="co">#&gt; 1999-12-01     NA</span></span>
<span id="cb1032-41"><a href="TimeSeriesAnalysis.html#cb1032-41" tabindex="-1"></a><span class="co">#&gt; 2000-01-01 0.0262</span></span>
<span id="cb1032-42"><a href="TimeSeriesAnalysis.html#cb1032-42" tabindex="-1"></a><span class="co">#&gt; 2000-02-01 0.0302</span></span>
<span id="cb1032-43"><a href="TimeSeriesAnalysis.html#cb1032-43" tabindex="-1"></a><span class="co">#&gt; 2000-03-01 0.0353</span></span>
<span id="cb1032-44"><a href="TimeSeriesAnalysis.html#cb1032-44" tabindex="-1"></a><span class="co">#&gt; 2000-04-01 0.0285</span></span>
<span id="cb1032-45"><a href="TimeSeriesAnalysis.html#cb1032-45" tabindex="-1"></a><span class="co">#&gt; 2000-05-01 0.0296</span></span>
<span id="cb1032-46"><a href="TimeSeriesAnalysis.html#cb1032-46" tabindex="-1"></a><span class="co">#&gt; 2000-06-01 0.0353</span></span>
<span id="cb1032-47"><a href="TimeSeriesAnalysis.html#cb1032-47" tabindex="-1"></a><span class="co">#&gt; 2000-07-01 0.0342</span></span>
<span id="cb1032-48"><a href="TimeSeriesAnalysis.html#cb1032-48" tabindex="-1"></a><span class="co">#&gt; 2000-08-01 0.0319</span></span>
<span id="cb1032-49"><a href="TimeSeriesAnalysis.html#cb1032-49" tabindex="-1"></a><span class="co">#&gt; 2000-09-01 0.0330</span></span>
<span id="cb1032-50"><a href="TimeSeriesAnalysis.html#cb1032-50" tabindex="-1"></a><span class="co">#&gt; 2000-10-01 0.0330</span></span>
<span id="cb1032-51"><a href="TimeSeriesAnalysis.html#cb1032-51" tabindex="-1"></a><span class="co">#&gt; 2000-11-01 0.0330</span></span>
<span id="cb1032-52"><a href="TimeSeriesAnalysis.html#cb1032-52" tabindex="-1"></a><span class="co">#&gt; 2000-12-01 0.0330</span></span></code></pre></div>
</div>
</div>
<div id="recipe-id080" class="section level2 hasAnchor" number="14.9">
<h2><span class="header-section-number">14.9</span> Performing Calculations on Time Series<a href="TimeSeriesAnalysis.html#recipe-id080" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id080" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id080" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You want to use arithmetic and common functions on time series data.</p>
</div>
<div id="solution-id080" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id080" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>No problem. R is pretty clever about operations on <code>zoo</code> and <code>xts</code> objects. You
can use arithmetic operators (<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, etc.) as well as
common functions (<code>sqrt</code>, <code>log</code>, etc.) and usually get what you
expect.</p>
</div>
<div id="discussion-id080" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id080" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When you perform arithmetic on <code>zoo</code> or <code>xts</code> objects, R aligns the objects
according to date so that the results make sense. Suppose we want to
compute the percentage change in IBM stock. We need to divide the daily
change by the price, but those two time series are not naturally
aligned—they have different start times and different lengths. Here’s an illustration with a <code>zoo</code> object:</p>
<div class="sourceCode" id="cb1033"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1033-1"><a href="TimeSeriesAnalysis.html#cb1033-1" tabindex="-1"></a>ibm.daily</span>
<span id="cb1033-2"><a href="TimeSeriesAnalysis.html#cb1033-2" tabindex="-1"></a><span class="co">#&gt; 2010-01-04 2010-01-05 2010-01-06 2010-01-07 2010-01-08 </span></span>
<span id="cb1033-3"><a href="TimeSeriesAnalysis.html#cb1033-3" tabindex="-1"></a><span class="co">#&gt;        132        131        130        130        131</span></span>
<span id="cb1033-4"><a href="TimeSeriesAnalysis.html#cb1033-4" tabindex="-1"></a><span class="fu">diff</span>(ibm.daily)</span>
<span id="cb1033-5"><a href="TimeSeriesAnalysis.html#cb1033-5" tabindex="-1"></a><span class="co">#&gt; 2010-01-05 2010-01-06 2010-01-07 2010-01-08 </span></span>
<span id="cb1033-6"><a href="TimeSeriesAnalysis.html#cb1033-6" tabindex="-1"></a><span class="co">#&gt;      -1.60      -0.85      -0.45       1.30</span></span></code></pre></div>
<p>Fortunately, when we divide one series by the other, R aligns the series
for us and returns a <code>zoo</code> object:</p>
<div class="sourceCode" id="cb1034"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1034-1"><a href="TimeSeriesAnalysis.html#cb1034-1" tabindex="-1"></a><span class="fu">diff</span>(ibm.daily) <span class="sc">/</span> ibm.daily</span>
<span id="cb1034-2"><a href="TimeSeriesAnalysis.html#cb1034-2" tabindex="-1"></a><span class="co">#&gt; 2010-01-05 2010-01-06 2010-01-07 2010-01-08 </span></span>
<span id="cb1034-3"><a href="TimeSeriesAnalysis.html#cb1034-3" tabindex="-1"></a><span class="co">#&gt;   -0.01223   -0.00654   -0.00347    0.00994</span></span></code></pre></div>
<p>We can scale the result by 100 to compute the percentage change, and the
result is another <code>zoo</code> object:</p>
<div class="sourceCode" id="cb1035"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1035-1"><a href="TimeSeriesAnalysis.html#cb1035-1" tabindex="-1"></a><span class="dv">100</span> <span class="sc">*</span> (<span class="fu">diff</span>(ibm.daily) <span class="sc">/</span> ibm.daily)</span>
<span id="cb1035-2"><a href="TimeSeriesAnalysis.html#cb1035-2" tabindex="-1"></a><span class="co">#&gt; 2010-01-05 2010-01-06 2010-01-07 2010-01-08 </span></span>
<span id="cb1035-3"><a href="TimeSeriesAnalysis.html#cb1035-3" tabindex="-1"></a><span class="co">#&gt;     -1.223     -0.654     -0.347      0.994</span></span></code></pre></div>
<p>Functions work just as well. If we compute the logarithm or square root
of a <code>zoo</code> object, the result is a <code>zoo</code> object with the timestamps
preserved:</p>
<div class="sourceCode" id="cb1036"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1036-1"><a href="TimeSeriesAnalysis.html#cb1036-1" tabindex="-1"></a><span class="fu">log</span>(ibm.daily)</span>
<span id="cb1036-2"><a href="TimeSeriesAnalysis.html#cb1036-2" tabindex="-1"></a><span class="co">#&gt; 2010-01-04 2010-01-05 2010-01-06 2010-01-07 2010-01-08 </span></span>
<span id="cb1036-3"><a href="TimeSeriesAnalysis.html#cb1036-3" tabindex="-1"></a><span class="co">#&gt;       4.89       4.87       4.87       4.86       4.87</span></span></code></pre></div>
<p>In investment management, computing the difference of logarithms of
prices is quite common. That’s a piece of cake in R:</p>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="TimeSeriesAnalysis.html#cb1037-1" tabindex="-1"></a><span class="fu">diff</span>(<span class="fu">log</span>(ibm.daily))</span>
<span id="cb1037-2"><a href="TimeSeriesAnalysis.html#cb1037-2" tabindex="-1"></a><span class="co">#&gt; 2010-01-05 2010-01-06 2010-01-07 2010-01-08 </span></span>
<span id="cb1037-3"><a href="TimeSeriesAnalysis.html#cb1037-3" tabindex="-1"></a><span class="co">#&gt;   -0.01215   -0.00652   -0.00347    0.00998</span></span></code></pre></div>
</div>
<div id="see_also-id080" class="section level3 unnumbered hasAnchor">
<h3>See Also<a href="TimeSeriesAnalysis.html#see_also-id080" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>See Recipe <a href="TimeSeriesAnalysis.html#recipe-id141">14.8</a>, <a href="TimeSeriesAnalysis.html#recipe-id141">“Computing Successive Differences”</a>, for the special
case of computing the difference between successive values.</p>
</div>
</div>
<div id="recipe-id279" class="section level2 hasAnchor" number="14.10">
<h2><span class="header-section-number">14.10</span> Computing a Moving Average<a href="TimeSeriesAnalysis.html#recipe-id279" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id279" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id279" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You want to compute the moving average of a time series.</p>
</div>
<div id="solution-id279" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id279" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use the <code>rollmean</code> function of the <code>zoo</code> package to calculate the
<em>k</em>-period moving average:</p>
<div class="sourceCode" id="cb1038"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1038-1"><a href="TimeSeriesAnalysis.html#cb1038-1" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb1038-2"><a href="TimeSeriesAnalysis.html#cb1038-2" tabindex="-1"></a>ma <span class="ot">&lt;-</span> <span class="fu">rollmean</span>(ts, k)</span></code></pre></div>
<p>Here <code>ts</code> is the time series data, captured in a <code>zoo</code> object, and <code>k</code> is
the number of periods.</p>
<p>For most financial applications, you want <code>rollmean</code> to calculate the
mean using only historical data; that is, for each day, use only the
data available that day. To do that, specify <code>align = right</code>. Otherwise,
<code>rollmean</code> will “cheat” and use future data that was actually
unavailable at the time:</p>
<div class="sourceCode" id="cb1039"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1039-1"><a href="TimeSeriesAnalysis.html#cb1039-1" tabindex="-1"></a>ma <span class="ot">&lt;-</span> <span class="fu">rollmean</span>(ts, k, <span class="at">align =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
</div>
<div id="discussion-id279" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id279" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Traders are fond of moving averages for smoothing out fluctuations in
prices. The formal name is the <em>rolling mean</em>. You could calculate the
rolling mean as described in Recipe <a href="TimeSeriesAnalysis.html#recipe-id081">14.12</a>, <a href="TimeSeriesAnalysis.html#recipe-id081">“Applying a Rolling Function”</a>, by combining the
<code>rollapply</code> function and the <code>mean</code> function, but <code>rollmean</code> is much
faster.</p>
<p>Beside speed, the beauty of <code>rollmean</code> is that it returns the same type of time series object it’s called on (i.e., <code>xts</code> or <code>zoo</code>). For each element in the object, its date is the “as of” date for
a calculated mean. Because the result is a time series object, you can easily merge the
original data and the moving average and then plot them together as in Figure <a href="TimeSeriesAnalysis.html#fig:ibmroll">14.3</a>:</p>
<div class="sourceCode" id="cb1040"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1040-1"><a href="TimeSeriesAnalysis.html#cb1040-1" tabindex="-1"></a>ibm_year <span class="ot">&lt;-</span> ibm[<span class="st">&quot;2016&quot;</span>]</span>
<span id="cb1040-2"><a href="TimeSeriesAnalysis.html#cb1040-2" tabindex="-1"></a>ma_ibm <span class="ot">&lt;-</span> <span class="fu">rollmean</span>(ibm_year, <span class="dv">7</span>, <span class="at">align =</span> <span class="st">&quot;right&quot;</span>)</span>
<span id="cb1040-3"><a href="TimeSeriesAnalysis.html#cb1040-3" tabindex="-1"></a>ma_ibm <span class="ot">&lt;-</span> <span class="fu">merge</span>(ma_ibm, ibm_year)</span>
<span id="cb1040-4"><a href="TimeSeriesAnalysis.html#cb1040-4" tabindex="-1"></a><span class="fu">plot</span>(ma_ibm)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:ibmroll"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/ibmroll-1.png" alt="Rolling average plot" width="85%" />
<p class="caption">
Figure 14.3: Rolling average plot
</p>
</div>
<p>The output is normally missing a few initial data points, since
<code>rollmean</code> needs a full <code>k</code> observations to compute the mean.
Consequently, the output is shorter than the input. If that’s a problem,
specify <code>na.pad = TRUE</code>; then <code>rollmean</code> will pad the initial output with
<code>NA</code> values.</p>
</div>
<div id="see_also-id279" class="section level3 unnumbered hasAnchor">
<h3>See Also<a href="TimeSeriesAnalysis.html#see_also-id279" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>See Recipe <a href="TimeSeriesAnalysis.html#recipe-id081">14.12</a>, <a href="TimeSeriesAnalysis.html#recipe-id081">“Applying a Rolling Function”</a>, for more about the
<code>align</code> parameter.</p>
<p>The moving average described here is a simple moving average. The
<code>quantmod</code>, <code>TTR</code>, and <code>fTrading</code> packages contain functions for
computing and plotting many kinds of moving averages, including simple
ones.</p>
</div>
</div>
<div id="recipe-id282" class="section level2 hasAnchor" number="14.11">
<h2><span class="header-section-number">14.11</span> Applying a Function by Calendar Period<a href="TimeSeriesAnalysis.html#recipe-id282" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id282" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id282" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Given a time series, you want to group the contents by a calendar period
(e.g., week, month, or year) and then apply a function to each group.</p>
</div>
<div id="solution-id282" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id282" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>xts</code> package includes functions for processing a time series by
day, week, month, quarter, or year:</p>
<div class="sourceCode" id="cb1041"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1041-1"><a href="TimeSeriesAnalysis.html#cb1041-1" tabindex="-1"></a><span class="fu">apply.daily</span>(ts, f)</span>
<span id="cb1041-2"><a href="TimeSeriesAnalysis.html#cb1041-2" tabindex="-1"></a><span class="fu">apply.weekly</span>(ts, f)</span>
<span id="cb1041-3"><a href="TimeSeriesAnalysis.html#cb1041-3" tabindex="-1"></a><span class="fu">apply.monthly</span>(ts, f)</span>
<span id="cb1041-4"><a href="TimeSeriesAnalysis.html#cb1041-4" tabindex="-1"></a><span class="fu">apply.quarterly</span>(ts, f)</span>
<span id="cb1041-5"><a href="TimeSeriesAnalysis.html#cb1041-5" tabindex="-1"></a><span class="fu">apply.yearly</span>(ts, f)</span></code></pre></div>
<p>Here <code>ts</code> is an <code>xts</code> time series, and <code>f</code> is the function to apply to each
day, week, month, quarter, or year.</p>
<p>If your time series is a <code>zoo</code> object, convert to an <code>xts</code> object first
so you can access these functions; for example:</p>
<div class="sourceCode" id="cb1042"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1042-1"><a href="TimeSeriesAnalysis.html#cb1042-1" tabindex="-1"></a><span class="fu">apply.monthly</span>(<span class="fu">as.xts</span>(ts), f)</span></code></pre></div>
</div>
<div id="discussion-id282" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id282" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It is common to process time series data according to calendar period.
But figuring calendar periods is tedious at best and bizarre at worst.
Let these functions do the heavy lifting.</p>
<p>Suppose we have a five-year history of IBM stock prices stored in an
<code>xts</code> object:</p>
<div class="sourceCode" id="cb1043"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1043-1"><a href="TimeSeriesAnalysis.html#cb1043-1" tabindex="-1"></a>ibm_5 <span class="ot">&lt;-</span> ibm[<span class="st">&quot;2012/2017&quot;</span>]</span>
<span id="cb1043-2"><a href="TimeSeriesAnalysis.html#cb1043-2" tabindex="-1"></a><span class="fu">head</span>(ibm_5)</span>
<span id="cb1043-3"><a href="TimeSeriesAnalysis.html#cb1043-3" tabindex="-1"></a><span class="co">#&gt;            ibm</span></span>
<span id="cb1043-4"><a href="TimeSeriesAnalysis.html#cb1043-4" tabindex="-1"></a><span class="co">#&gt; 2012-01-03 152</span></span>
<span id="cb1043-5"><a href="TimeSeriesAnalysis.html#cb1043-5" tabindex="-1"></a><span class="co">#&gt; 2012-01-04 151</span></span>
<span id="cb1043-6"><a href="TimeSeriesAnalysis.html#cb1043-6" tabindex="-1"></a><span class="co">#&gt; 2012-01-05 150</span></span>
<span id="cb1043-7"><a href="TimeSeriesAnalysis.html#cb1043-7" tabindex="-1"></a><span class="co">#&gt; 2012-01-06 149</span></span>
<span id="cb1043-8"><a href="TimeSeriesAnalysis.html#cb1043-8" tabindex="-1"></a><span class="co">#&gt; 2012-01-09 148</span></span>
<span id="cb1043-9"><a href="TimeSeriesAnalysis.html#cb1043-9" tabindex="-1"></a><span class="co">#&gt; 2012-01-10 148</span></span></code></pre></div>
<p>We can calculate the average price by month if we use <code>apply.monthly</code>
and <code>mean</code> together:</p>
<div class="sourceCode" id="cb1044"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1044-1"><a href="TimeSeriesAnalysis.html#cb1044-1" tabindex="-1"></a>ibm_mm <span class="ot">&lt;-</span> <span class="fu">apply.monthly</span>(ibm_5, mean)</span>
<span id="cb1044-2"><a href="TimeSeriesAnalysis.html#cb1044-2" tabindex="-1"></a><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: `apply.monthly(..., FUN = mean)` operates by column, unlike other math</span></span>
<span id="cb1044-3"><a href="TimeSeriesAnalysis.html#cb1044-3" tabindex="-1"></a><span class="co">#&gt;   functions (e.g. median, sum, var, sd). Please use `FUN = colMeans` instead,</span></span>
<span id="cb1044-4"><a href="TimeSeriesAnalysis.html#cb1044-4" tabindex="-1"></a><span class="co">#&gt;   and use `FUN = function(x) mean(x)` to take the mean of all columns. Set</span></span>
<span id="cb1044-5"><a href="TimeSeriesAnalysis.html#cb1044-5" tabindex="-1"></a><span class="co">#&gt;   `options(xts.message.period.apply.mean = FALSE)` to suppress this message.</span></span>
<span id="cb1044-6"><a href="TimeSeriesAnalysis.html#cb1044-6" tabindex="-1"></a><span class="fu">head</span>(ibm_mm)</span>
<span id="cb1044-7"><a href="TimeSeriesAnalysis.html#cb1044-7" tabindex="-1"></a><span class="co">#&gt;            ibm</span></span>
<span id="cb1044-8"><a href="TimeSeriesAnalysis.html#cb1044-8" tabindex="-1"></a><span class="co">#&gt; 2012-01-31 151</span></span>
<span id="cb1044-9"><a href="TimeSeriesAnalysis.html#cb1044-9" tabindex="-1"></a><span class="co">#&gt; 2012-02-29 158</span></span>
<span id="cb1044-10"><a href="TimeSeriesAnalysis.html#cb1044-10" tabindex="-1"></a><span class="co">#&gt; 2012-03-30 166</span></span>
<span id="cb1044-11"><a href="TimeSeriesAnalysis.html#cb1044-11" tabindex="-1"></a><span class="co">#&gt; 2012-04-30 167</span></span>
<span id="cb1044-12"><a href="TimeSeriesAnalysis.html#cb1044-12" tabindex="-1"></a><span class="co">#&gt; 2012-05-31 164</span></span>
<span id="cb1044-13"><a href="TimeSeriesAnalysis.html#cb1044-13" tabindex="-1"></a><span class="co">#&gt; 2012-06-29 159</span></span></code></pre></div>
<p>Notice that the IBM data is in an <code>xts</code> object from the start. Had the data been in a <code>zoo</code> object, we would have needed to convert it to <code>xts</code> using <code>as.xts</code>.</p>
<p>A more interesting application is calculating volatility by calendar
month, where volatility is measured as the standard deviation of daily
log-returns. Daily log-returns are calculated this way:</p>
<div class="sourceCode" id="cb1045"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1045-1"><a href="TimeSeriesAnalysis.html#cb1045-1" tabindex="-1"></a><span class="fu">diff</span>(<span class="fu">log</span>(ibm_5))</span></code></pre></div>
<p>We calculate their standard deviation, month by month, like this:</p>
<div class="sourceCode" id="cb1046"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1046-1"><a href="TimeSeriesAnalysis.html#cb1046-1" tabindex="-1"></a><span class="fu">apply.monthly</span>(<span class="fu">as.xts</span>(<span class="fu">diff</span>(<span class="fu">log</span>(ibm_5))), sd)</span></code></pre></div>
<p>We can scale the daily number to estimate annualized volatility, as shown in Figure <a href="TimeSeriesAnalysis.html#fig:volplot">14.4</a>:</p>
<div class="sourceCode" id="cb1047"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1047-1"><a href="TimeSeriesAnalysis.html#cb1047-1" tabindex="-1"></a>ibm_vol <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">251</span>) <span class="sc">*</span> <span class="fu">apply.monthly</span>(<span class="fu">as.xts</span>(<span class="fu">diff</span>(<span class="fu">log</span>(ibm_5))), sd)</span>
<span id="cb1047-2"><a href="TimeSeriesAnalysis.html#cb1047-2" tabindex="-1"></a><span class="fu">plot</span>(ibm_vol,</span>
<span id="cb1047-3"><a href="TimeSeriesAnalysis.html#cb1047-3" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;IBM: Monthly Volatility&quot;</span></span>
<span id="cb1047-4"><a href="TimeSeriesAnalysis.html#cb1047-4" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:volplot"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/volplot-1.png" alt="IBM volatility plot" width="85%" />
<p class="caption">
Figure 14.4: IBM volatility plot
</p>
</div>
</div>
</div>
<div id="recipe-id081" class="section level2 hasAnchor" number="14.12">
<h2><span class="header-section-number">14.12</span> Applying a Rolling Function<a href="TimeSeriesAnalysis.html#recipe-id081" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id081" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id081" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You want to apply a function to a time series in a rolling manner:
calculate the function at a data point using some window of time around that point, move to the next data point, calculate the function around that point, move to the next data point, and
so forth.</p>
</div>
<div id="solution-id081" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id081" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use the <code>rollapply</code> function in the <code>zoo</code> package. The <code>width</code> parameter
defines how many data points from the time series (<code>ts</code>) should be
processed by the function (<code>f</code>) at each point:</p>
<div class="sourceCode" id="cb1048"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1048-1"><a href="TimeSeriesAnalysis.html#cb1048-1" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb1048-2"><a href="TimeSeriesAnalysis.html#cb1048-2" tabindex="-1"></a><span class="fu">rollapply</span>(ts, width, f)</span></code></pre></div>
<p>For many applications, you will likely set <code>align = "right"</code> to avoid
computing <code>f</code> with historical data that was unavailable at the time:</p>
<div class="sourceCode" id="cb1049"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1049-1"><a href="TimeSeriesAnalysis.html#cb1049-1" tabindex="-1"></a><span class="fu">rollapply</span>(ts, width, f, <span class="at">align =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
</div>
<div id="discussion-id081" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id081" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>rollapply</code> function extracts a “window” of data from your time
series, calls your function with that data, saves the result, and moves
to the next window—and repeats this pattern for the entire input. As an
illustration, consider calling <code>rollapply</code> with <code>width = 21</code>:</p>
<div class="sourceCode" id="cb1050"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1050-1"><a href="TimeSeriesAnalysis.html#cb1050-1" tabindex="-1"></a><span class="fu">rollapply</span>(ts, <span class="dv">21</span>, f)</span></code></pre></div>
<p><code>rollapply</code> will repeatedly call the function, <code>f</code>, with a sliding
window of data, like this:</p>
<ol style="list-style-type: decimal">
<li><p><code>f(ts[1:21])</code></p></li>
<li><p><code>f(ts[2:22])</code></p></li>
<li><p><code>f(ts[3:23])</code></p></li>
<li><p>… <code>etc.</code> …</p></li>
</ol>
<p>Observe that the function should expect one argument, which is a vector
of values. <code>rollapply</code> will save the returned values before packaging
them into a <code>zoo</code> object along with a timestamp for every value. The
choice of timestamp depends on the <code>align</code> parameter given to
<code>rollapply</code>:</p>
<dl>
<dt><code>align="right"</code></dt>
<dd>
<p>The timestamp is taken from the rightmost value.</p>
</dd>
<dt><code>align="left"</code></dt>
<dd>
<p>The timestamp is taken from the leftmost value.</p>
</dd>
<dt><code>align="center" (default)</code></dt>
<dd>
<p>The timestamp is taken from the middle value.</p>
</dd>
</dl>
<p>By default, <code>rollapply</code> will recalculate the function at successive data
points. You may instead want to calculate the function at every <em>n</em>th
data point. Use the <code>by = n</code> parameter to have <code>rollapply</code> move ahead <em>n</em>
points after each function call. When we calculate the rolling standard
deviation of a time series, for example, we usually want each window of
data to be separate, not overlapping, so we set the <code>by</code> value equal
to the window size:</p>
<div class="sourceCode" id="cb1051"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1051-1"><a href="TimeSeriesAnalysis.html#cb1051-1" tabindex="-1"></a>ibm_sds <span class="ot">&lt;-</span> <span class="fu">rollapply</span>(ibm_5, <span class="at">width =</span> <span class="dv">30</span>, <span class="at">FUN =</span> sd, <span class="at">by =</span> <span class="dv">30</span>, <span class="at">align =</span> <span class="st">&quot;right&quot;</span>)</span>
<span id="cb1051-2"><a href="TimeSeriesAnalysis.html#cb1051-2" tabindex="-1"></a>ibm_sds <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(ibm_sds)</span>
<span id="cb1051-3"><a href="TimeSeriesAnalysis.html#cb1051-3" tabindex="-1"></a><span class="fu">head</span>(ibm_sds)</span></code></pre></div>
<p>The <code>rollapply</code> function will, by default, return an object with as many observations as your input data with the missing values filled with <code>NA</code>. In the preceding example we use <code>na.omit</code> to drop the <code>NA</code> values so that our resulting object has records only for the dates for which we have values.</p>
</div>
</div>
<div id="recipe-id082" class="section level2 hasAnchor" number="14.13">
<h2><span class="header-section-number">14.13</span> Plotting the Autocorrelation Function<a href="TimeSeriesAnalysis.html#recipe-id082" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id082" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id082" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You want to plot the autocorrelation function (ACF) of your time series.</p>
</div>
<div id="solution-id082" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id082" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use the <code>acf</code> function:</p>
<div class="sourceCode" id="cb1052"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1052-1"><a href="TimeSeriesAnalysis.html#cb1052-1" tabindex="-1"></a><span class="fu">acf</span>(ts)</span></code></pre></div>
</div>
<div id="discussion-id082" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id082" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The autocorrelation function is an important tool for revealing the
interrelationships within a time series. It is a collection of
correlations, <span class="math inline">\(\rho_k\)</span> for <em>k</em> = 1, 2, 3, …, where <span class="math inline">\(\rho_k\)</span> is the
correlation between all pairs of data points that are exactly <em>k</em> steps
apart.</p>
<p>Visualizing the autocorrelations is much more useful than listing them,
so the <code>acf</code> function plots them for each value of <em>k</em>.
The following example shows the
autocorrelation functions for two time series, one with autocorrelations
and one without. The dashed line delimits the significant and
insignificant correlations: values above the line are significant.
(The height of the dashed line in Figures <a href="TimeSeriesAnalysis.html#fig:autocorr1">14.5</a> and <a href="TimeSeriesAnalysis.html#fig:autocorr2">14.6</a> is determined by the amount of data.)</p>
<div class="sourceCode" id="cb1053"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1053-1"><a href="TimeSeriesAnalysis.html#cb1053-1" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;./data/ts_acf.rdata&quot;</span>)</span>
<span id="cb1053-2"><a href="TimeSeriesAnalysis.html#cb1053-2" tabindex="-1"></a></span>
<span id="cb1053-3"><a href="TimeSeriesAnalysis.html#cb1053-3" tabindex="-1"></a><span class="fu">acf</span>(ts1, <span class="at">main =</span> <span class="st">&quot;Significant Autocorrelations&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:autocorr1"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/autocorr1-1.png" alt="Autocorrelations at each lag: ts1" width="85%" />
<p class="caption">
Figure 14.5: Autocorrelations at each lag: ts1
</p>
</div>
<div class="sourceCode" id="cb1054"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1054-1"><a href="TimeSeriesAnalysis.html#cb1054-1" tabindex="-1"></a><span class="fu">acf</span>(ts2, <span class="at">main =</span> <span class="st">&quot;Insignificant Autocorrelations&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:autocorr2"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/autocorr2-1.png" alt="Autocorrelations at each lag: ts2" width="85%" />
<p class="caption">
Figure 14.6: Autocorrelations at each lag: ts2
</p>
</div>
<p>The presence of autocorrelations is one indication that an
autoregressive integrated moving average (ARIMA) model could model the
time series. From the ACF, you can count the number of significant
autocorrelations, which is a useful estimate of the number of moving
average (MA) coefficients in the model. Figure <a href="TimeSeriesAnalysis.html#fig:autocorr1">14.5</a> shows seven
significant autocorrelations, for example, so we estimate that its ARIMA
model will require seven MA coefficients (MA(7)). That estimate is just
a starting point, however, and must be verified by fitting and
diagnosing the model.</p>
</div>
</div>
<div id="recipe-id104" class="section level2 hasAnchor" number="14.14">
<h2><span class="header-section-number">14.14</span> Testing a Time Series for Autocorrelation<a href="TimeSeriesAnalysis.html#recipe-id104" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id104" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id104" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You want to test your time series for the presence of autocorrelations.</p>
</div>
<div id="solution-id104" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id104" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use the <code>Box.test</code> function, which implements the Box–Pierce test for
autocorrelation:</p>
<div class="sourceCode" id="cb1055"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1055-1"><a href="TimeSeriesAnalysis.html#cb1055-1" tabindex="-1"></a><span class="fu">Box.test</span>(ts)</span></code></pre></div>
<p>The output includes a <em>p</em>-value. Conventionally, a <em>p</em>-value of less
than 0.05 indicates that the data contains significant autocorrelations,
whereas a <em>p</em>-value exceeding 0.05 provides no such evidence.</p>
</div>
<div id="discussion-id104" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id104" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Graphing the autocorrelation function is useful for digging into your
data. Sometimes, however, we just need to know whether or not the data
is autocorrelated. A statistical test such as the Box–Pierce test can
provide an answer.</p>
<p>We can apply the Box–Pierce test to the data whose autocorrelation
function we plotted in Recipe <a href="TimeSeriesAnalysis.html#recipe-id082">14.13</a>, <a href="TimeSeriesAnalysis.html#recipe-id082">“Plotting the Autocorrelation Function”</a>. The test shows
<em>p</em>-values for the two time series that are nearly 0 and 0.79,
respectively:</p>
<div class="sourceCode" id="cb1056"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1056-1"><a href="TimeSeriesAnalysis.html#cb1056-1" tabindex="-1"></a><span class="fu">Box.test</span>(ts1)</span>
<span id="cb1056-2"><a href="TimeSeriesAnalysis.html#cb1056-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1056-3"><a href="TimeSeriesAnalysis.html#cb1056-3" tabindex="-1"></a><span class="co">#&gt;  Box-Pierce test</span></span>
<span id="cb1056-4"><a href="TimeSeriesAnalysis.html#cb1056-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1056-5"><a href="TimeSeriesAnalysis.html#cb1056-5" tabindex="-1"></a><span class="co">#&gt; data:  ts1</span></span>
<span id="cb1056-6"><a href="TimeSeriesAnalysis.html#cb1056-6" tabindex="-1"></a><span class="co">#&gt; X-squared = 108, df = 1, p-value &lt;2e-16</span></span>
<span id="cb1056-7"><a href="TimeSeriesAnalysis.html#cb1056-7" tabindex="-1"></a></span>
<span id="cb1056-8"><a href="TimeSeriesAnalysis.html#cb1056-8" tabindex="-1"></a><span class="fu">Box.test</span>(ts2)</span>
<span id="cb1056-9"><a href="TimeSeriesAnalysis.html#cb1056-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1056-10"><a href="TimeSeriesAnalysis.html#cb1056-10" tabindex="-1"></a><span class="co">#&gt;  Box-Pierce test</span></span>
<span id="cb1056-11"><a href="TimeSeriesAnalysis.html#cb1056-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1056-12"><a href="TimeSeriesAnalysis.html#cb1056-12" tabindex="-1"></a><span class="co">#&gt; data:  ts2</span></span>
<span id="cb1056-13"><a href="TimeSeriesAnalysis.html#cb1056-13" tabindex="-1"></a><span class="co">#&gt; X-squared = 0.07, df = 1, p-value = 0.8</span></span></code></pre></div>
<p>The <em>p</em>-value near 0 indicates that the first time series has
significant autocorrelations. (We don’t know which autocorrelations are
significant; we just know they exist.) The <em>p</em>-value of 0.8 indicates
that the test did not detect autocorrelations in the second time series.</p>
<p>The <code>Box.test</code> function can also perform the Ljung–Box test, which is
better for small samples. That test calculates a <em>p</em>-value whose
interpretation is the same as that for the Box–Pierce <em>p</em>-value:</p>
<div class="sourceCode" id="cb1057"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1057-1"><a href="TimeSeriesAnalysis.html#cb1057-1" tabindex="-1"></a><span class="fu">Box.test</span>(ts, <span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span>)</span></code></pre></div>
</div>
<div id="see_also-id104" class="section level3 unnumbered hasAnchor">
<h3>See Also<a href="TimeSeriesAnalysis.html#see_also-id104" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>See Recipe <a href="TimeSeriesAnalysis.html#recipe-id082">14.13</a>, <a href="TimeSeriesAnalysis.html#recipe-id082">“Plotting the Autocorrelation Function”</a>, to plot the
autocorrelation function, a visual check of the autocorrelation.</p>
</div>
</div>
<div id="recipe-id083" class="section level2 hasAnchor" number="14.15">
<h2><span class="header-section-number">14.15</span> Plotting the Partial Autocorrelation Function<a href="TimeSeriesAnalysis.html#recipe-id083" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id083" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id083" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You want to plot the partial autocorrelation function (PACF) for your
time series.</p>
</div>
<div id="solution-id083" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id083" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use the <code>pacf</code> function:</p>
<div class="sourceCode" id="cb1058"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1058-1"><a href="TimeSeriesAnalysis.html#cb1058-1" tabindex="-1"></a><span class="fu">pacf</span>(ts)</span></code></pre></div>
</div>
<div id="discussion-id083" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id083" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The partial autocorrelation function is another tool for revealing the
interrelationships in a time series. However, its interpretation is much
less intuitive than that of the autocorrelation function. We’ll leave the
mathematical definition of partial correlation to a textbook on
statistics. Here, we’ll just say that the partial correlation between two
random variables, <em>X</em> and <em>Y</em>, is the correlation that remains after
accounting for the correlation shown by <em>X</em> and <em>Y</em>, with all other
variables. In the case of time series, the partial autocorrelation at
lag <em>k</em> is the correlation between all data points that are exactly <em>k</em>
steps apart—after accounting for their correlation with the data between
those <em>k</em> steps.</p>
<p>The practical value of a PACF is that it helps you to identify the
number of autoregression (AR) coefficients in an ARIMA model. The following example shows
the PACF for the two time series used in Recipe <a href="TimeSeriesAnalysis.html#recipe-id082">14.13</a>, <a href="TimeSeriesAnalysis.html#recipe-id082">“Plotting the Autocorrelation Function”</a>.
One of these series has partial autocorrelations and one
does not. Lag values whose lines cross above the dotted line are
statistically significant. In the first time series (Figure <a href="TimeSeriesAnalysis.html#fig:partautocorr1">14.7</a>) there are two such values, at <em>k</em> = 1 and <em>k</em>
= 2, so our initial ARIMA model will have two AR coefficients (AR(2)).
As with autocorrelation, however, that is just an initial estimate and
must verified by fitting and diagnosing the model. The second time series (Figure <a href="TimeSeriesAnalysis.html#fig:partautocorr2">14.8</a>) shows no such autocorrelation pattern.</p>
<div class="sourceCode" id="cb1059"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1059-1"><a href="TimeSeriesAnalysis.html#cb1059-1" tabindex="-1"></a><span class="fu">pacf</span>(ts1, <span class="at">main =</span> <span class="st">&quot;Significant Partial Autocorrelations&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:partautocorr1"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/partautocorr1-1.png" alt="Autocorrelations at each lag: ts1" width="85%" />
<p class="caption">
Figure 14.7: Autocorrelations at each lag: ts1
</p>
</div>
<div class="sourceCode" id="cb1060"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1060-1"><a href="TimeSeriesAnalysis.html#cb1060-1" tabindex="-1"></a><span class="fu">pacf</span>(ts2, <span class="at">main =</span> <span class="st">&quot;Insignificant Partial Autocorrelations&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:partautocorr2"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/partautocorr2-1.png" alt="Autocorrelations at each lag: ts2" width="85%" />
<p class="caption">
Figure 14.8: Autocorrelations at each lag: ts2
</p>
</div>
</div>
<div id="see_also-id083" class="section level3 unnumbered hasAnchor">
<h3>See Also<a href="TimeSeriesAnalysis.html#see_also-id083" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>See Recipe <a href="TimeSeriesAnalysis.html#recipe-id082">14.13</a>, <a href="TimeSeriesAnalysis.html#recipe-id082">“Plotting the Autocorrelation Function”</a>.</p>
</div>
</div>
<div id="recipe-id084" class="section level2 hasAnchor" number="14.16">
<h2><span class="header-section-number">14.16</span> Finding Lagged Correlations Between Two Time Series<a href="TimeSeriesAnalysis.html#recipe-id084" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id084" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id084" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You have two time series, and you are wondering if there is a lagged
correlation between them.</p>
</div>
<div id="solution-id084" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id084" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use the <code>Ccf</code> function from the package <code>forecast</code> to plot the cross-correlation function, which
will reveal lagged correlations:</p>
<div class="sourceCode" id="cb1061"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1061-1"><a href="TimeSeriesAnalysis.html#cb1061-1" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb1061-2"><a href="TimeSeriesAnalysis.html#cb1061-2" tabindex="-1"></a><span class="fu">Ccf</span>(ts1, ts2)</span></code></pre></div>
</div>
<div id="discussion-id084" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id084" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The cross-correlation function helps you discover lagged correlations
between two time series. A lagged correlation occurs when today’s value
in one time series is correlated with a future or past value in the
other time series.</p>
<p>Consider the relationship between commodity prices and bond prices. Some
analysts believe those prices are connected because changes in commodity
prices are a barometer of inflation, one of the key factors in bond
pricing. Can we discover a correlation between them?</p>
<p>Figure <a href="TimeSeriesAnalysis.html#fig:bondcmd">14.9</a> shows a
cross-correlation function generated from daily changes in bond prices
and a commodity price index:<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<div class="sourceCode" id="cb1062"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1062-1"><a href="TimeSeriesAnalysis.html#cb1062-1" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb1062-2"><a href="TimeSeriesAnalysis.html#cb1062-2" tabindex="-1"></a><span class="co">#&gt; Registered S3 method overwritten by &#39;quantmod&#39;:</span></span>
<span id="cb1062-3"><a href="TimeSeriesAnalysis.html#cb1062-3" tabindex="-1"></a><span class="co">#&gt;   method            from</span></span>
<span id="cb1062-4"><a href="TimeSeriesAnalysis.html#cb1062-4" tabindex="-1"></a><span class="co">#&gt;   as.zoo.data.frame zoo</span></span>
<span id="cb1062-5"><a href="TimeSeriesAnalysis.html#cb1062-5" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;./data/bnd_cmty.Rdata&quot;</span>)</span>
<span id="cb1062-6"><a href="TimeSeriesAnalysis.html#cb1062-6" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">coredata</span>(bonds)[, <span class="dv">1</span>]</span>
<span id="cb1062-7"><a href="TimeSeriesAnalysis.html#cb1062-7" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fu">coredata</span>(cmdtys)[, <span class="dv">1</span>]</span>
<span id="cb1062-8"><a href="TimeSeriesAnalysis.html#cb1062-8" tabindex="-1"></a></span>
<span id="cb1062-9"><a href="TimeSeriesAnalysis.html#cb1062-9" tabindex="-1"></a><span class="fu">Ccf</span>(b, c, <span class="at">main =</span> <span class="st">&quot;Bonds vs. Commodities&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:bondcmd"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/bondcmd-1.png" alt="Cross-correlation function" width="85%" />
<p class="caption">
Figure 14.9: Cross-correlation function
</p>
</div>
<p>Note that since the objects we start with, <code>bonds</code> and <code>cmdtys</code>, are <code>xts</code> objects, we extract from each the vector of data using <code>coredata()[1]</code>. This is because the <code>Ccf</code> function expects inputs to be simple vectors.</p>
<p>Every vertical line shows the correlation between the two time series at
some lag, as indicated along the x-axis. If a correlation extends above
or below the dotted lines, it is statistically significant.</p>
<p>Notice that the correlation at lag 0 is –0.24, which is the simple
correlation between the variables:</p>
<div class="sourceCode" id="cb1063"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1063-1"><a href="TimeSeriesAnalysis.html#cb1063-1" tabindex="-1"></a><span class="fu">cor</span>(b, c)</span>
<span id="cb1063-2"><a href="TimeSeriesAnalysis.html#cb1063-2" tabindex="-1"></a><span class="co">#&gt; [1] -0.24</span></span></code></pre></div>
<p>Much more interesting are the correlations at lags 1, 5, and 8, which are
statistically significant. Evidently there is some “ripple effect” in
the day-to-day prices of bonds and commodities because changes today are
correlated with changes tomorrow. Discovering this sort of relationship
is useful to short-term forecasters such as market analysts and bond
traders.</p>
</div>
</div>
<div id="recipe-id088" class="section level2 hasAnchor" number="14.17">
<h2><span class="header-section-number">14.17</span> Detrending a Time Series<a href="TimeSeriesAnalysis.html#recipe-id088" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id088" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id088" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Your time series data contains a trend that you want to remove.</p>
</div>
<div id="solution-id088" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id088" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use linear regression to identify the trend component, and then subtract the
trend component from the original time series. These two lines show how
to detrend the <code>zoo</code> object <code>ts</code> and put the result in <code>detr</code>:</p>
<div class="sourceCode" id="cb1064"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1064-1"><a href="TimeSeriesAnalysis.html#cb1064-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">coredata</span>(ts) <span class="sc">~</span> <span class="fu">index</span>(ts))</span>
<span id="cb1064-2"><a href="TimeSeriesAnalysis.html#cb1064-2" tabindex="-1"></a>detr <span class="ot">&lt;-</span> <span class="fu">zoo</span>(<span class="fu">resid</span>(m), <span class="fu">index</span>(ts))</span></code></pre></div>
</div>
<div id="discussion-id088" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id088" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Some time series data contains trends, which means that it gradually
slopes upward or downward over time. Suppose your time series object (a <code>zoo</code> object in this case), <code>yield</code>, contains a trend as shown in Figure <a href="TimeSeriesAnalysis.html#fig:cornyields">14.10</a>:</p>
<pre><code>#&gt; `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:cornyields"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/cornyields-1.png" alt="Time series with trend" width="85%" />
<p class="caption">
Figure 14.10: Time series with trend
</p>
</div>
<p>We can remove the trend component in two steps. First, identify the
overall trend by using the linear model function, <code>lm</code>. The model should
use the time series index for the <em>x</em> variable and the time series data
for the <em>y</em> variable.</p>
<div class="sourceCode" id="cb1066"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1066-1"><a href="TimeSeriesAnalysis.html#cb1066-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">coredata</span>(yield) <span class="sc">~</span> <span class="fu">index</span>(yield))</span></code></pre></div>
<p>Second, remove the linear trend from the original data by subtracting
the straight line found by <code>lm</code>. This is easy because we have access to
the linear model’s residuals, which are defined by the difference
between the original data and the fitted line:</p>
<p><span class="math inline">\(r_i = y_i - \beta_1 x_i - \beta_0\)</span></p>
<p>where <span class="math inline">\(r_i\)</span> is the <em>i</em>th residual, and where <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_0\)</span> are the
model’s slope and intercept, respectively. We can extract the residuals
from the linear model by using the <code>resid</code> function and then embed the
residuals inside a <code>zoo</code> object:</p>
<div class="sourceCode" id="cb1067"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1067-1"><a href="TimeSeriesAnalysis.html#cb1067-1" tabindex="-1"></a>detr <span class="ot">&lt;-</span> <span class="fu">zoo</span>(<span class="fu">resid</span>(m), <span class="fu">index</span>(yield))</span></code></pre></div>
<p>Notice that we use the same time index as the original data. When we
plot <code>detr</code> it is clearly trendless, as evident in Figure <a href="TimeSeriesAnalysis.html#fig:detrplot">14.11</a>.</p>
<div class="sourceCode" id="cb1068"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1068-1"><a href="TimeSeriesAnalysis.html#cb1068-1" tabindex="-1"></a><span class="fu">autoplot</span>(detr)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:detrplot"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/detrplot-1.png" alt="Residual plot" width="85%" />
<p class="caption">
Figure 14.11: Residual plot
</p>
</div>
<p>This data is the state average corn yield for Illinois in bushels per acre (bu/ac). So <code>detr</code> is the difference between actual yield and the trend. Sometimes when detrending you may want to determine the percent deviation from the trend. In that case we can divide by the initial measure:</p>
<div class="sourceCode" id="cb1069"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1069-1"><a href="TimeSeriesAnalysis.html#cb1069-1" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1069-2"><a href="TimeSeriesAnalysis.html#cb1069-2" tabindex="-1"></a><span class="co"># y &lt;- autoplot(yield) +</span></span>
<span id="cb1069-3"><a href="TimeSeriesAnalysis.html#cb1069-3" tabindex="-1"></a><span class="co">#   labs(x=&#39;Year&#39;, y=&#39;Yield (bu/ac)&#39;, title=&#39;IL Corn Yield&#39;)</span></span>
<span id="cb1069-4"><a href="TimeSeriesAnalysis.html#cb1069-4" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(detr, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>) <span class="sc">+</span></span>
<span id="cb1069-5"><a href="TimeSeriesAnalysis.html#cb1069-5" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1069-6"><a href="TimeSeriesAnalysis.html#cb1069-6" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Yield Dev (bu/ac)&quot;</span>,</span>
<span id="cb1069-7"><a href="TimeSeriesAnalysis.html#cb1069-7" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;IL Corn Yield Deviation from Trend (bu/ac)&quot;</span></span>
<span id="cb1069-8"><a href="TimeSeriesAnalysis.html#cb1069-8" tabindex="-1"></a>  )</span>
<span id="cb1069-9"><a href="TimeSeriesAnalysis.html#cb1069-9" tabindex="-1"></a>dp <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(detr <span class="sc">/</span> yield, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>) <span class="sc">+</span></span>
<span id="cb1069-10"><a href="TimeSeriesAnalysis.html#cb1069-10" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1069-11"><a href="TimeSeriesAnalysis.html#cb1069-11" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Yield Dev (%)&quot;</span>,</span>
<span id="cb1069-12"><a href="TimeSeriesAnalysis.html#cb1069-12" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;IL Corn Yield Deviation from Trend (%)&quot;</span></span>
<span id="cb1069-13"><a href="TimeSeriesAnalysis.html#cb1069-13" tabindex="-1"></a>  )</span>
<span id="cb1069-14"><a href="TimeSeriesAnalysis.html#cb1069-14" tabindex="-1"></a></span>
<span id="cb1069-15"><a href="TimeSeriesAnalysis.html#cb1069-15" tabindex="-1"></a>d <span class="sc">/</span> dp</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:detrended"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/detrended-1.png" alt="Detrended plots" width="85%" />
<p class="caption">
Figure 14.12: Detrended plots
</p>
</div>
<p>The top plot in Figure <a href="TimeSeriesAnalysis.html#fig:detrended">14.12</a> shows the yield deviation from the trend in bu/ac (the original units), while the lower plot shows the percent deviation from the trend.</p>
</div>
</div>
<div id="recipe-id085" class="section level2 hasAnchor" number="14.18">
<h2><span class="header-section-number">14.18</span> Fitting an ARIMA Model<a href="TimeSeriesAnalysis.html#recipe-id085" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id085" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id085" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You want to fit an ARIMA model to your time series data.</p>
</div>
<div id="solution-id085" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id085" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>auto.arima</code> function in the <code>forecast</code> package can select the
correct model order and fit the model to your data:</p>
<div class="sourceCode" id="cb1070"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1070-1"><a href="TimeSeriesAnalysis.html#cb1070-1" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb1070-2"><a href="TimeSeriesAnalysis.html#cb1070-2" tabindex="-1"></a><span class="fu">auto.arima</span>(x)</span></code></pre></div>
<p>If you already know the model order, (<em>p</em>, <em>d</em>, <em>q</em>), then the <code>arima</code>
function can fit the model directly:</p>
<div class="sourceCode" id="cb1071"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1071-1"><a href="TimeSeriesAnalysis.html#cb1071-1" tabindex="-1"></a><span class="fu">arima</span>(x, <span class="at">order =</span> <span class="fu">c</span>(p, d, q))</span></code></pre></div>
</div>
<div id="discussion-id085" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id085" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Creating an ARIMA model involves three steps:</p>
<ol style="list-style-type: decimal">
<li><p>Identify the model order.</p></li>
<li><p>Fit the model to the data, giving the coefficients.</p></li>
<li><p>Apply diagnostic measures to validate the model.</p></li>
</ol>
<p>The model order is usually denoted by three integers, (<em>p</em>, <em>d</em>, <em>q</em>),
where <em>p</em> is the number of autoregressive coefficients, <em>d</em> is the
degree of differencing, and <em>q</em> is the number of moving average
coefficients.</p>
<p>When most of us build an ARIMA model, we are usually clueless about the appropriate
order. Rather than tediously searching for the best combination of <em>p</em>,
<em>d</em>, and <em>q</em>, we typically use <code>auto.arima</code>, which does the searching for us:</p>
<div class="sourceCode" id="cb1072"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1072-1"><a href="TimeSeriesAnalysis.html#cb1072-1" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb1072-2"><a href="TimeSeriesAnalysis.html#cb1072-2" tabindex="-1"></a><span class="fu">library</span>(fpp2) <span class="co"># for example data</span></span>
<span id="cb1072-3"><a href="TimeSeriesAnalysis.html#cb1072-3" tabindex="-1"></a></span>
<span id="cb1072-4"><a href="TimeSeriesAnalysis.html#cb1072-4" tabindex="-1"></a><span class="fu">auto.arima</span>(ausbeer)</span>
<span id="cb1072-5"><a href="TimeSeriesAnalysis.html#cb1072-5" tabindex="-1"></a><span class="co">#&gt; Series: ausbeer </span></span>
<span id="cb1072-6"><a href="TimeSeriesAnalysis.html#cb1072-6" tabindex="-1"></a><span class="co">#&gt; ARIMA(1,1,2)(0,1,1)[4] </span></span>
<span id="cb1072-7"><a href="TimeSeriesAnalysis.html#cb1072-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1072-8"><a href="TimeSeriesAnalysis.html#cb1072-8" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb1072-9"><a href="TimeSeriesAnalysis.html#cb1072-9" tabindex="-1"></a><span class="co">#&gt;         ar1     ma1    ma2    sma1</span></span>
<span id="cb1072-10"><a href="TimeSeriesAnalysis.html#cb1072-10" tabindex="-1"></a><span class="co">#&gt;       0.050  -1.009  0.375  -0.743</span></span>
<span id="cb1072-11"><a href="TimeSeriesAnalysis.html#cb1072-11" tabindex="-1"></a><span class="co">#&gt; s.e.  0.196   0.183  0.153   0.050</span></span>
<span id="cb1072-12"><a href="TimeSeriesAnalysis.html#cb1072-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1072-13"><a href="TimeSeriesAnalysis.html#cb1072-13" tabindex="-1"></a><span class="co">#&gt; sigma^2 = 241:  log likelihood = -886</span></span>
<span id="cb1072-14"><a href="TimeSeriesAnalysis.html#cb1072-14" tabindex="-1"></a><span class="co">#&gt; AIC=1783   AICc=1783   BIC=1800</span></span></code></pre></div>
<p>In this case, <code>auto.arima</code> decided the best order was (1, 1, 2), which
means that it differenced the data once (<em>d</em> = 1) before selecting a
model with AR coefficients (<em>p</em> = 1) and two MA coefficients (<em>q</em> =
2). In addition, the <code>auto.arima</code> function determined that our data has seasonality and included the seasonal terms <em>P</em> = 0, <em>D</em> = 1, <em>Q</em> = 1 and a period of <em>m</em> = 4. The seasonality terms are similar to the nonseasonal ARIMA terms, but relate to the seasonality component of the model. The <em>m</em> term tells us the periodicity of the seasonality, which in this case is quarterly. We can see this easier if we plot the <code>ausbeer</code> data as in Figure <a href="TimeSeriesAnalysis.html#fig:ausbeer">14.13</a>:</p>
<div class="sourceCode" id="cb1073"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1073-1"><a href="TimeSeriesAnalysis.html#cb1073-1" tabindex="-1"></a><span class="fu">autoplot</span>(ausbeer)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:ausbeer"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/ausbeer-1.png" alt="Australian beer consumption" width="85%" />
<p class="caption">
Figure 14.13: Australian beer consumption
</p>
</div>
<p>By default, <code>auto.arima</code> limits <em>p</em> and <em>q</em> to the range 0 ≤ <em>p</em> ≤ 5 and
0 ≤ <em>q</em> ≤ 5. If you are confident that your model needs fewer than five
coefficients, use the <code>max.p</code> and <code>max.q</code> parameters to limit the search
further; this makes it faster. Likewise, if you believe that your model
needs more coefficients, use <code>max.p</code> and <code>max.q</code> to expand the search
limits.</p>
<p>If you want to turn off the seasonality component of <code>auto.arima</code>, you can set <code>seasonal = FALSE</code>:</p>
<div class="sourceCode" id="cb1074"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1074-1"><a href="TimeSeriesAnalysis.html#cb1074-1" tabindex="-1"></a><span class="fu">auto.arima</span>(ausbeer, <span class="at">seasonal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1074-2"><a href="TimeSeriesAnalysis.html#cb1074-2" tabindex="-1"></a><span class="co">#&gt; Series: ausbeer </span></span>
<span id="cb1074-3"><a href="TimeSeriesAnalysis.html#cb1074-3" tabindex="-1"></a><span class="co">#&gt; ARIMA(3,2,2) </span></span>
<span id="cb1074-4"><a href="TimeSeriesAnalysis.html#cb1074-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1074-5"><a href="TimeSeriesAnalysis.html#cb1074-5" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb1074-6"><a href="TimeSeriesAnalysis.html#cb1074-6" tabindex="-1"></a><span class="co">#&gt;          ar1     ar2     ar3     ma1    ma2</span></span>
<span id="cb1074-7"><a href="TimeSeriesAnalysis.html#cb1074-7" tabindex="-1"></a><span class="co">#&gt;       -0.957  -0.987  -0.925  -1.043  0.142</span></span>
<span id="cb1074-8"><a href="TimeSeriesAnalysis.html#cb1074-8" tabindex="-1"></a><span class="co">#&gt; s.e.   0.026   0.018   0.024   0.062  0.062</span></span>
<span id="cb1074-9"><a href="TimeSeriesAnalysis.html#cb1074-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1074-10"><a href="TimeSeriesAnalysis.html#cb1074-10" tabindex="-1"></a><span class="co">#&gt; sigma^2 = 327:  log likelihood = -935</span></span>
<span id="cb1074-11"><a href="TimeSeriesAnalysis.html#cb1074-11" tabindex="-1"></a><span class="co">#&gt; AIC=1882   AICc=1882   BIC=1902</span></span></code></pre></div>
<p>But notice that since the model fits a nonseasonal model, the coefficients are different than in the seasonal model.</p>
<p>If you already know the order of your ARIMA model, the <code>arima</code> function
can quickly fit the model to your data:</p>
<div class="sourceCode" id="cb1075"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1075-1"><a href="TimeSeriesAnalysis.html#cb1075-1" tabindex="-1"></a><span class="fu">arima</span>(ausbeer, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb1075-2"><a href="TimeSeriesAnalysis.html#cb1075-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1075-3"><a href="TimeSeriesAnalysis.html#cb1075-3" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb1075-4"><a href="TimeSeriesAnalysis.html#cb1075-4" tabindex="-1"></a><span class="co">#&gt; arima(x = ausbeer, order = c(3, 2, 2))</span></span>
<span id="cb1075-5"><a href="TimeSeriesAnalysis.html#cb1075-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1075-6"><a href="TimeSeriesAnalysis.html#cb1075-6" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb1075-7"><a href="TimeSeriesAnalysis.html#cb1075-7" tabindex="-1"></a><span class="co">#&gt;          ar1     ar2     ar3     ma1    ma2</span></span>
<span id="cb1075-8"><a href="TimeSeriesAnalysis.html#cb1075-8" tabindex="-1"></a><span class="co">#&gt;       -0.957  -0.987  -0.925  -1.043  0.142</span></span>
<span id="cb1075-9"><a href="TimeSeriesAnalysis.html#cb1075-9" tabindex="-1"></a><span class="co">#&gt; s.e.   0.026   0.018   0.024   0.062  0.062</span></span>
<span id="cb1075-10"><a href="TimeSeriesAnalysis.html#cb1075-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1075-11"><a href="TimeSeriesAnalysis.html#cb1075-11" tabindex="-1"></a><span class="co">#&gt; sigma^2 estimated as 319:  log likelihood = -935,  aic = 1882</span></span></code></pre></div>
<p>The output looks identical to <code>auto.arima</code> with the <code>seasonal</code> parameter set to <code>FALSE</code>. What you can’t see here is that <code>arima</code> executes much more quickly.</p>
<p>The output from <code>auto.arima</code> and <code>arima</code> includes the fitted
coefficients and the standard error (<code>s.e.</code>) for each coefficient:</p>
<pre><code>Coefficients:
          ar1      ar2      ar3      ma1     ma2
      -0.9569  -0.9872  -0.9247  -1.0425  0.1416
s.e.   0.0257   0.0184   0.0242   0.0619  0.0623</code></pre>
<p>You can find the coefficients’ confidence intervals by capturing the
ARIMA model in an object and then using the <code>confint</code> function:</p>
<div class="sourceCode" id="cb1077"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1077-1"><a href="TimeSeriesAnalysis.html#cb1077-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">arima</span>(<span class="at">x =</span> ausbeer, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb1077-2"><a href="TimeSeriesAnalysis.html#cb1077-2" tabindex="-1"></a><span class="fu">confint</span>(m)</span>
<span id="cb1077-3"><a href="TimeSeriesAnalysis.html#cb1077-3" tabindex="-1"></a><span class="co">#&gt;       2.5 % 97.5 %</span></span>
<span id="cb1077-4"><a href="TimeSeriesAnalysis.html#cb1077-4" tabindex="-1"></a><span class="co">#&gt; ar1 -1.0072 -0.907</span></span>
<span id="cb1077-5"><a href="TimeSeriesAnalysis.html#cb1077-5" tabindex="-1"></a><span class="co">#&gt; ar2 -1.0232 -0.951</span></span>
<span id="cb1077-6"><a href="TimeSeriesAnalysis.html#cb1077-6" tabindex="-1"></a><span class="co">#&gt; ar3 -0.9721 -0.877</span></span>
<span id="cb1077-7"><a href="TimeSeriesAnalysis.html#cb1077-7" tabindex="-1"></a><span class="co">#&gt; ma1 -1.1639 -0.921</span></span>
<span id="cb1077-8"><a href="TimeSeriesAnalysis.html#cb1077-8" tabindex="-1"></a><span class="co">#&gt; ma2  0.0195  0.264</span></span></code></pre></div>
<p>This output illustrates a major headache of ARIMA modeling: not all the
coefficients are necessarily significant. If one of the intervals contains
zero, the true coefficient might be zero itself, in which case the term is unnecessary.</p>
<p>If you discover that your model contains insignificant coefficients, use Recipe <a href="TimeSeriesAnalysis.html#recipe-id237">14.19</a>, <a href="TimeSeriesAnalysis.html#recipe-id237">“Removing Insignificant ARIMA Coefficients”</a>, to remove
them.</p>
<p>The <code>auto.arima</code> and <code>arima</code> functions contain useful features for
fitting the best model. For example, you can force them to include or
exclude a trend component. See the help pages for details.</p>
<p>A final caveat: the danger of <code>auto.arima</code> is that it makes ARIMA
modeling look simple. ARIMA modeling is <em>not</em> simple. It is more art
than science, and the automatically generated model is just a starting
point. We urge you to review a good book about ARIMA modeling
before settling on a final model.</p>
</div>
<div id="see_also-id085" class="section level3 unnumbered hasAnchor">
<h3>See Also<a href="TimeSeriesAnalysis.html#see_also-id085" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>See Recipe <a href="TimeSeriesAnalysis.html#recipe-id238">14.20</a>, <a href="TimeSeriesAnalysis.html#recipe-id238">“Running Diagnostics on an ARIMA Model”</a>, for
performing diagnostic tests on the ARIMA model.</p>
<p>As a textbook on time series forecasting, we highly recommend
<em>Forecasting: Principles and Practice</em> by Rob J. Hyndman and George Athanasopoulos
which is <a href="https://otexts.org/fpp2/">freely available online</a>.</p>
</div>
</div>
<div id="recipe-id237" class="section level2 hasAnchor" number="14.19">
<h2><span class="header-section-number">14.19</span> Removing Insignificant ARIMA Coefficients<a href="TimeSeriesAnalysis.html#recipe-id237" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id237" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id237" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One or more of the coefficients in your ARIMA model are statistically
insignificant. You want to remove them.</p>
</div>
<div id="solution-id237" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id237" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>arima</code> function includes the parameter <code>fixed</code>, which is a vector.
The vector should contain one element for every coefficient in the
model, including a term for the drift (if any). Each element is either
<code>NA</code> or <code>0</code>. Use <code>NA</code> for the coefficients to be kept and use <code>0</code> for the
coefficients to be removed. This example shows an ARIMA(2, 1, 2) model
with the first AR coefficient and the first MA coefficient forced to be
<code>0</code>:</p>
<div class="sourceCode" id="cb1078"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1078-1"><a href="TimeSeriesAnalysis.html#cb1078-1" tabindex="-1"></a><span class="fu">arima</span>(x, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="at">fixed =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>, <span class="dv">0</span>, <span class="cn">NA</span>))</span></code></pre></div>
</div>
<div id="discussion-id237" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id237" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>fpp2</code> package contains a dataset called <code>euretail</code>, which is a quarterly retail index for the Euro area. Let’s run <code>auto.arima</code> on the data and look at the 98% confidence intervals:</p>
<div class="sourceCode" id="cb1079"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1079-1"><a href="TimeSeriesAnalysis.html#cb1079-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(euretail)</span>
<span id="cb1079-2"><a href="TimeSeriesAnalysis.html#cb1079-2" tabindex="-1"></a>m</span>
<span id="cb1079-3"><a href="TimeSeriesAnalysis.html#cb1079-3" tabindex="-1"></a><span class="co">#&gt; Series: euretail </span></span>
<span id="cb1079-4"><a href="TimeSeriesAnalysis.html#cb1079-4" tabindex="-1"></a><span class="co">#&gt; ARIMA(0,1,3)(0,1,1)[4] </span></span>
<span id="cb1079-5"><a href="TimeSeriesAnalysis.html#cb1079-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1079-6"><a href="TimeSeriesAnalysis.html#cb1079-6" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb1079-7"><a href="TimeSeriesAnalysis.html#cb1079-7" tabindex="-1"></a><span class="co">#&gt;         ma1    ma2    ma3    sma1</span></span>
<span id="cb1079-8"><a href="TimeSeriesAnalysis.html#cb1079-8" tabindex="-1"></a><span class="co">#&gt;       0.263  0.369  0.420  -0.664</span></span>
<span id="cb1079-9"><a href="TimeSeriesAnalysis.html#cb1079-9" tabindex="-1"></a><span class="co">#&gt; s.e.  0.124  0.126  0.129   0.155</span></span>
<span id="cb1079-10"><a href="TimeSeriesAnalysis.html#cb1079-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1079-11"><a href="TimeSeriesAnalysis.html#cb1079-11" tabindex="-1"></a><span class="co">#&gt; sigma^2 = 0.156:  log likelihood = -28.6</span></span>
<span id="cb1079-12"><a href="TimeSeriesAnalysis.html#cb1079-12" tabindex="-1"></a><span class="co">#&gt; AIC=67.3   AICc=68.4   BIC=77.7</span></span>
<span id="cb1079-13"><a href="TimeSeriesAnalysis.html#cb1079-13" tabindex="-1"></a><span class="fu">confint</span>(m, <span class="at">level =</span> .<span class="dv">98</span>)</span>
<span id="cb1079-14"><a href="TimeSeriesAnalysis.html#cb1079-14" tabindex="-1"></a><span class="co">#&gt;          1 %   99 %</span></span>
<span id="cb1079-15"><a href="TimeSeriesAnalysis.html#cb1079-15" tabindex="-1"></a><span class="co">#&gt; ma1  -0.0246  0.551</span></span>
<span id="cb1079-16"><a href="TimeSeriesAnalysis.html#cb1079-16" tabindex="-1"></a><span class="co">#&gt; ma2   0.0774  0.661</span></span>
<span id="cb1079-17"><a href="TimeSeriesAnalysis.html#cb1079-17" tabindex="-1"></a><span class="co">#&gt; ma3   0.1190  0.721</span></span>
<span id="cb1079-18"><a href="TimeSeriesAnalysis.html#cb1079-18" tabindex="-1"></a><span class="co">#&gt; sma1 -1.0231 -0.304</span></span></code></pre></div>
<p>In this example, we can see that the 98% confidence interval for the <code>ma1</code> parameter contains 0 and we can reasonably conclude that this parameter is insignificant at this level of confidence. We can set this parameter to <code>0</code> using the <code>fixed</code> parameter:</p>
<div class="sourceCode" id="cb1080"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1080-1"><a href="TimeSeriesAnalysis.html#cb1080-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">arima</span>(euretail, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>), <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">fixed =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>))</span>
<span id="cb1080-2"><a href="TimeSeriesAnalysis.html#cb1080-2" tabindex="-1"></a>m</span>
<span id="cb1080-3"><a href="TimeSeriesAnalysis.html#cb1080-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1080-4"><a href="TimeSeriesAnalysis.html#cb1080-4" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb1080-5"><a href="TimeSeriesAnalysis.html#cb1080-5" tabindex="-1"></a><span class="co">#&gt; arima(x = euretail, order = c(0, 1, 3), seasonal = c(0, 1, 1), fixed = c(0, </span></span>
<span id="cb1080-6"><a href="TimeSeriesAnalysis.html#cb1080-6" tabindex="-1"></a><span class="co">#&gt;     NA, NA, NA))</span></span>
<span id="cb1080-7"><a href="TimeSeriesAnalysis.html#cb1080-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1080-8"><a href="TimeSeriesAnalysis.html#cb1080-8" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb1080-9"><a href="TimeSeriesAnalysis.html#cb1080-9" tabindex="-1"></a><span class="co">#&gt;       ma1    ma2    ma3    sma1</span></span>
<span id="cb1080-10"><a href="TimeSeriesAnalysis.html#cb1080-10" tabindex="-1"></a><span class="co">#&gt;         0  0.404  0.293  -0.700</span></span>
<span id="cb1080-11"><a href="TimeSeriesAnalysis.html#cb1080-11" tabindex="-1"></a><span class="co">#&gt; s.e.    0  0.129  0.107   0.135</span></span>
<span id="cb1080-12"><a href="TimeSeriesAnalysis.html#cb1080-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1080-13"><a href="TimeSeriesAnalysis.html#cb1080-13" tabindex="-1"></a><span class="co">#&gt; sigma^2 estimated as 0.156:  log likelihood = -30.8,  aic = 69.5</span></span></code></pre></div>
<p>Observe that the <code>ma1</code> coefficient is now <code>0</code>. The
remaining coefficients (<code>ma2</code>, <code>ma3</code>, <code>sma1</code>) are still significant, as shown
by their confidence intervals, so we have a reasonable model:</p>
<div class="sourceCode" id="cb1081"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1081-1"><a href="TimeSeriesAnalysis.html#cb1081-1" tabindex="-1"></a><span class="fu">confint</span>(m, <span class="at">level =</span> .<span class="dv">98</span>)</span>
<span id="cb1081-2"><a href="TimeSeriesAnalysis.html#cb1081-2" tabindex="-1"></a><span class="co">#&gt;          1 %   99 %</span></span>
<span id="cb1081-3"><a href="TimeSeriesAnalysis.html#cb1081-3" tabindex="-1"></a><span class="co">#&gt; ma1       NA     NA</span></span>
<span id="cb1081-4"><a href="TimeSeriesAnalysis.html#cb1081-4" tabindex="-1"></a><span class="co">#&gt; ma2   0.1049  0.703</span></span>
<span id="cb1081-5"><a href="TimeSeriesAnalysis.html#cb1081-5" tabindex="-1"></a><span class="co">#&gt; ma3   0.0438  0.542</span></span>
<span id="cb1081-6"><a href="TimeSeriesAnalysis.html#cb1081-6" tabindex="-1"></a><span class="co">#&gt; sma1 -1.0140 -0.386</span></span></code></pre></div>
</div>
</div>
<div id="recipe-id238" class="section level2 hasAnchor" number="14.20">
<h2><span class="header-section-number">14.20</span> Running Diagnostics on an ARIMA Model<a href="TimeSeriesAnalysis.html#recipe-id238" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id238" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id238" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You have built an ARIMA model using the <code>forecast</code> package, and you want to run diagnostic tests to
validate the model.</p>
</div>
<div id="solution-id238" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id238" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use the <code>checkresiduals</code> function. This example fits the ARIMA model using <code>auto.arima</code>, puts the results in <code>m</code>, and then runs diagnostics on the model:</p>
<div class="sourceCode" id="cb1082"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1082-1"><a href="TimeSeriesAnalysis.html#cb1082-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(x)</span>
<span id="cb1082-2"><a href="TimeSeriesAnalysis.html#cb1082-2" tabindex="-1"></a><span class="fu">checkresiduals</span>(m)</span></code></pre></div>
</div>
<div id="discussion-id238" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id238" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The result of <code>checkresiduals</code> is a set of three graphs, as shown in Figure <a href="TimeSeriesAnalysis.html#fig:diag1">14.14</a>. A good model should
produce results like these:</p>
<pre><code>#&gt; 
#&gt;  Ljung-Box test
#&gt; 
#&gt; data:  Residuals from ARIMA(1,1,2)(0,1,1)[4]
#&gt; Q* = 5, df = 4, p-value = 0.3
#&gt; 
#&gt; Model df: 4.   Total lags used: 8</code></pre>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:diag1"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/diag1-1.png" alt="Residuals plots: Good model" width="85%" />
<p class="caption">
Figure 14.14: Residuals plots: Good model
</p>
</div>
<p>Here’s what’s good about the graphs:</p>
<ul>
<li><p>The standardized residuals don’t show clusters of volatility.</p></li>
<li><p>The autocorrelation function (ACF) shows no significant
autocorrelation between the residuals.</p></li>
<li><p>The residuals look bell-shaped, suggesting they are reasonably symmetrical.</p></li>
<li><p>The <em>p</em>-value in the Ljung–Box test is large, indicating that the residuals are patternless—meaning all the information has been extracted by the model and only noise is left behind.</p></li>
</ul>
<p>For contrast, Figure <a href="TimeSeriesAnalysis.html#fig:diag2">14.15</a> shows diagnostic charts with problems:</p>
<pre><code>#&gt; 
#&gt;  Ljung-Box test
#&gt; 
#&gt; data:  Residuals from ARIMA(1,1,1)(0,0,1)[4]
#&gt; Q* = 22, df = 5, p-value = 5e-04
#&gt; 
#&gt; Model df: 3.   Total lags used: 8</code></pre>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:diag2"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/diag2-1.png" alt="Residuals plots: Problem model" width="85%" />
<p class="caption">
Figure 14.15: Residuals plots: Problem model
</p>
</div>
<ul>
<li><p>The ACF shows significant autocorrelations between residuals.</p></li>
<li><p>The <em>p</em>-values for the Ljung–Box statistics are small, indicating
there is some pattern in the residuals. There is still information
to be extracted from the data.</p></li>
<li><p>The residuals appear asymmetrical.</p></li>
</ul>
<p>These are basic diagnostics, but they are a good start. Find a good book
on ARIMA modeling and perform the recommended diagnostic tests before
concluding that your model is sound. Additional checks of the residuals
could include:</p>
<ul>
<li>Tests for normality</li>
<li>Quantile–quantile (Q–Q) plot</li>
<li>Scatter plot against the fitted values</li>
</ul>
</div>
</div>
<div id="recipe-id086" class="section level2 hasAnchor" number="14.21">
<h2><span class="header-section-number">14.21</span> Making Forecasts from an ARIMA Model<a href="TimeSeriesAnalysis.html#recipe-id086" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id086" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id086" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You have an ARIMA model for your time series that you built with the <code>forecast</code> package. You want to forecast the
next few observations in the series.</p>
</div>
<div id="solution-id086" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id086" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Save the model in an object, and then apply the <code>forecast</code> function to the
object. This example saves the model from Recipe <a href="TimeSeriesAnalysis.html#recipe-id237">14.19</a>, <a href="TimeSeriesAnalysis.html#recipe-id237">“Removing Insignificant ARIMA Coefficients”</a>, and predicts
the next eight observations:</p>
<div class="sourceCode" id="cb1085"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1085-1"><a href="TimeSeriesAnalysis.html#cb1085-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">arima</span>(euretail, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>), <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">fixed =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>))</span>
<span id="cb1085-2"><a href="TimeSeriesAnalysis.html#cb1085-2" tabindex="-1"></a><span class="fu">forecast</span>(m)</span>
<span id="cb1085-3"><a href="TimeSeriesAnalysis.html#cb1085-3" tabindex="-1"></a><span class="co">#&gt;         Point Forecast Lo 80 Hi 80 Lo 95 Hi 95</span></span>
<span id="cb1085-4"><a href="TimeSeriesAnalysis.html#cb1085-4" tabindex="-1"></a><span class="co">#&gt; 2012 Q1           95.1  94.6  95.6  94.3  95.9</span></span>
<span id="cb1085-5"><a href="TimeSeriesAnalysis.html#cb1085-5" tabindex="-1"></a><span class="co">#&gt; 2012 Q2           95.2  94.5  95.9  94.1  96.3</span></span>
<span id="cb1085-6"><a href="TimeSeriesAnalysis.html#cb1085-6" tabindex="-1"></a><span class="co">#&gt; 2012 Q3           95.2  94.2  96.3  93.7  96.8</span></span>
<span id="cb1085-7"><a href="TimeSeriesAnalysis.html#cb1085-7" tabindex="-1"></a><span class="co">#&gt; 2012 Q4           95.3  93.9  96.6  93.2  97.3</span></span>
<span id="cb1085-8"><a href="TimeSeriesAnalysis.html#cb1085-8" tabindex="-1"></a><span class="co">#&gt; 2013 Q1           94.5  92.8  96.1  91.9  97.0</span></span>
<span id="cb1085-9"><a href="TimeSeriesAnalysis.html#cb1085-9" tabindex="-1"></a><span class="co">#&gt; 2013 Q2           94.5  92.6  96.5  91.5  97.5</span></span>
<span id="cb1085-10"><a href="TimeSeriesAnalysis.html#cb1085-10" tabindex="-1"></a><span class="co">#&gt; 2013 Q3           94.5  92.3  96.7  91.1  97.9</span></span>
<span id="cb1085-11"><a href="TimeSeriesAnalysis.html#cb1085-11" tabindex="-1"></a><span class="co">#&gt; 2013 Q4           94.5  92.0  97.0  90.7  98.3</span></span></code></pre></div>
</div>
<div id="discussion-id086" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id086" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>forecast</code> function will calculate the next few observations and their
standard errors according to the model. It returns a list with 10
elements. When we print the model, as we just did, <code>forecast</code> returns the time series points it is forecasting, the forecast, and two pairs of confidence bands: high/low 80% and high/low 95%.</p>
<p>If we want to extract out just the forecast, we can do that by assigning the results to an object, and then pulling out the list item named <code>mean</code>:</p>
<div class="sourceCode" id="cb1086"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1086-1"><a href="TimeSeriesAnalysis.html#cb1086-1" tabindex="-1"></a>fc_m <span class="ot">&lt;-</span> <span class="fu">forecast</span>(m)</span>
<span id="cb1086-2"><a href="TimeSeriesAnalysis.html#cb1086-2" tabindex="-1"></a>fc_m<span class="sc">$</span>mean</span>
<span id="cb1086-3"><a href="TimeSeriesAnalysis.html#cb1086-3" tabindex="-1"></a><span class="co">#&gt;      Qtr1 Qtr2 Qtr3 Qtr4</span></span>
<span id="cb1086-4"><a href="TimeSeriesAnalysis.html#cb1086-4" tabindex="-1"></a><span class="co">#&gt; 2012 95.1 95.2 95.2 95.3</span></span>
<span id="cb1086-5"><a href="TimeSeriesAnalysis.html#cb1086-5" tabindex="-1"></a><span class="co">#&gt; 2013 94.5 94.5 94.5 94.5</span></span></code></pre></div>
<p>The result is a <code>Time-Series</code> object containing the forecasts created by the <code>forecast</code> function.</p>
</div>
</div>
<div id="recipe-plotting_forecast" class="section level2 hasAnchor" number="14.22">
<h2><span class="header-section-number">14.22</span> Plotting a Forecast<a href="TimeSeriesAnalysis.html#recipe-plotting_forecast" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-plotting_forecast" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-plotting_forecast" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You have created a time series forecast with the <code>forecast</code> package and you would like to plot it.</p>
</div>
<div id="solution-plotting_forecast" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-plotting_forecast" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Time series models created with the <code>forecast</code> package have a plotting method that uses <code>ggplot2</code> to create graphs easily, as shown in Figure <a href="TimeSeriesAnalysis.html#fig:forecast1">14.16</a>:</p>
<div class="sourceCode" id="cb1087"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1087-1"><a href="TimeSeriesAnalysis.html#cb1087-1" tabindex="-1"></a>fc_m <span class="ot">&lt;-</span> <span class="fu">forecast</span>(m)</span>
<span id="cb1087-2"><a href="TimeSeriesAnalysis.html#cb1087-2" tabindex="-1"></a><span class="fu">autoplot</span>(fc_m)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:forecast1"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/forecast1-1.png" alt="Forecast cone of uncertainty: Default" width="85%" />
<p class="caption">
Figure 14.16: Forecast cone of uncertainty: Default
</p>
</div>
</div>
<div id="discussion-plotting_forecast" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-plotting_forecast" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>autoplot</code> function makes a very reasonable figure, as shown in Figure <a href="TimeSeriesAnalysis.html#fig:forecast1">14.16</a>. Since the resulting figure is a <code>ggplot</code> object, we can adjust the plotting parameters the same way we would any other <code>ggplot</code> object. Here we add labels and a title and change the theme, as shown in Figure <a href="TimeSeriesAnalysis.html#fig:forecast2">14.17</a>:</p>
<div class="sourceCode" id="cb1088"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1088-1"><a href="TimeSeriesAnalysis.html#cb1088-1" tabindex="-1"></a><span class="fu">autoplot</span>(fc_m) <span class="sc">+</span></span>
<span id="cb1088-2"><a href="TimeSeriesAnalysis.html#cb1088-2" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Euro Index&quot;</span>) <span class="sc">+</span></span>
<span id="cb1088-3"><a href="TimeSeriesAnalysis.html#cb1088-3" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Year/Quarter&quot;</span>) <span class="sc">+</span></span>
<span id="cb1088-4"><a href="TimeSeriesAnalysis.html#cb1088-4" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Forecasted Retail Index&quot;</span>) <span class="sc">+</span></span>
<span id="cb1088-5"><a href="TimeSeriesAnalysis.html#cb1088-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:forecast2"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/forecast2-1.png" alt="Forecast cone of uncertainty: Labeled" width="85%" />
<p class="caption">
Figure 14.17: Forecast cone of uncertainty: Labeled
</p>
</div>
</div>
<div id="see_also-plotting_forecast" class="section level3 unnumbered hasAnchor">
<h3>See Also<a href="TimeSeriesAnalysis.html#see_also-plotting_forecast" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Chapter @ref(#Graphics) for more info on working with <code>ggplot</code> figures.</p>
</div>
</div>
<div id="recipe-id087" class="section level2 hasAnchor" number="14.23">
<h2><span class="header-section-number">14.23</span> Testing for Mean Reversion<a href="TimeSeriesAnalysis.html#recipe-id087" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id087" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id087" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You want to know if your time series is mean reverting (stationary).</p>
</div>
<div id="solution-id087" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id087" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A common test for mean reversion is the Augmented Dickey–Fuller (ADF)
test, which is implemented by the <code>adf.test</code> function of the <code>tseries</code>
package:</p>
<div class="sourceCode" id="cb1089"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1089-1"><a href="TimeSeriesAnalysis.html#cb1089-1" tabindex="-1"></a><span class="fu">library</span>(tseries)</span>
<span id="cb1089-2"><a href="TimeSeriesAnalysis.html#cb1089-2" tabindex="-1"></a><span class="fu">adf.test</span>(ts)</span></code></pre></div>
<p>The output from <code>adf.test</code> includes a <em>p</em>-value. Conventionally, if <em>p</em>
&lt; 0.05, the time series is likely mean reverting, whereas a <em>p</em>
&gt; 0.05 provides no such evidence.</p>
</div>
<div id="discussion-id087" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id087" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When a time series is mean reverting, it tends to return to its long-run
average. It may wander off, but eventually it wanders back. If a time
series is not mean reverting, then it can wander away without ever
returning to the mean.</p>
<p>Figure <a href="TimeSeriesAnalysis.html#fig:goog200plot">14.18</a> appears to be wandering upward and not returning. The large <em>p</em>-value from the <code>adf.test</code> confirms that it is not mean reverting:</p>
<div class="sourceCode" id="cb1090"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1090-1"><a href="TimeSeriesAnalysis.html#cb1090-1" tabindex="-1"></a><span class="fu">library</span>(tseries)</span>
<span id="cb1090-2"><a href="TimeSeriesAnalysis.html#cb1090-2" tabindex="-1"></a><span class="fu">library</span>(fpp2)</span>
<span id="cb1090-3"><a href="TimeSeriesAnalysis.html#cb1090-3" tabindex="-1"></a><span class="fu">autoplot</span>(goog200)</span>
<span id="cb1090-4"><a href="TimeSeriesAnalysis.html#cb1090-4" tabindex="-1"></a><span class="fu">adf.test</span>(goog200)</span>
<span id="cb1090-5"><a href="TimeSeriesAnalysis.html#cb1090-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1090-6"><a href="TimeSeriesAnalysis.html#cb1090-6" tabindex="-1"></a><span class="co">#&gt;  Augmented Dickey-Fuller Test</span></span>
<span id="cb1090-7"><a href="TimeSeriesAnalysis.html#cb1090-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1090-8"><a href="TimeSeriesAnalysis.html#cb1090-8" tabindex="-1"></a><span class="co">#&gt; data:  goog200</span></span>
<span id="cb1090-9"><a href="TimeSeriesAnalysis.html#cb1090-9" tabindex="-1"></a><span class="co">#&gt; Dickey-Fuller = -2, Lag order = 5, p-value = 0.7</span></span>
<span id="cb1090-10"><a href="TimeSeriesAnalysis.html#cb1090-10" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: stationary</span></span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:goog200plot"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/goog200plot-1.png" alt="Time series without mean reversion" width="85%" />
<p class="caption">
Figure 14.18: Time series without mean reversion
</p>
</div>
<p>The time series in Figure <a href="TimeSeriesAnalysis.html#fig:hsalesplot">14.19</a>, however, is just bouncing around its average
value. The small <em>p</em>-value (0.012) confirms that it is mean reverting:</p>
<div class="sourceCode" id="cb1091"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1091-1"><a href="TimeSeriesAnalysis.html#cb1091-1" tabindex="-1"></a><span class="fu">autoplot</span>(hsales)</span>
<span id="cb1091-2"><a href="TimeSeriesAnalysis.html#cb1091-2" tabindex="-1"></a><span class="fu">adf.test</span>(hsales)</span>
<span id="cb1091-3"><a href="TimeSeriesAnalysis.html#cb1091-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1091-4"><a href="TimeSeriesAnalysis.html#cb1091-4" tabindex="-1"></a><span class="co">#&gt;  Augmented Dickey-Fuller Test</span></span>
<span id="cb1091-5"><a href="TimeSeriesAnalysis.html#cb1091-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1091-6"><a href="TimeSeriesAnalysis.html#cb1091-6" tabindex="-1"></a><span class="co">#&gt; data:  hsales</span></span>
<span id="cb1091-7"><a href="TimeSeriesAnalysis.html#cb1091-7" tabindex="-1"></a><span class="co">#&gt; Dickey-Fuller = -4, Lag order = 6, p-value = 0.01</span></span>
<span id="cb1091-8"><a href="TimeSeriesAnalysis.html#cb1091-8" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: stationary</span></span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:hsalesplot"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/hsalesplot-1.png" alt="Time series with mean reversion" width="85%" />
<p class="caption">
Figure 14.19: Time series with mean reversion
</p>
</div>
<p>The example data here comes from the <code>fpp2</code> package and comprises all <code>Time-Series</code> object types.
If your data were in a <code>zoo</code> or <code>xts</code> object, then you would need to call <code>coredata</code> to extract out the raw data from the object before passing it to <code>adf.test</code>:</p>
<div class="sourceCode" id="cb1092"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1092-1"><a href="TimeSeriesAnalysis.html#cb1092-1" tabindex="-1"></a><span class="fu">library</span>(xts)</span>
<span id="cb1092-2"><a href="TimeSeriesAnalysis.html#cb1092-2" tabindex="-1"></a><span class="fu">data</span>(sample_matrix)</span>
<span id="cb1092-3"><a href="TimeSeriesAnalysis.html#cb1092-3" tabindex="-1"></a>xts_obj <span class="ot">&lt;-</span> <span class="fu">as.xts</span>(sample_matrix, <span class="at">dateFormat =</span> <span class="st">&quot;Date&quot;</span>)[, <span class="st">&quot;Close&quot;</span>] <span class="co"># single vector of data</span></span>
<span id="cb1092-4"><a href="TimeSeriesAnalysis.html#cb1092-4" tabindex="-1"></a></span>
<span id="cb1092-5"><a href="TimeSeriesAnalysis.html#cb1092-5" tabindex="-1"></a><span class="fu">adf.test</span>(<span class="fu">coredata</span>(xts_obj))</span>
<span id="cb1092-6"><a href="TimeSeriesAnalysis.html#cb1092-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1092-7"><a href="TimeSeriesAnalysis.html#cb1092-7" tabindex="-1"></a><span class="co">#&gt;  Augmented Dickey-Fuller Test</span></span>
<span id="cb1092-8"><a href="TimeSeriesAnalysis.html#cb1092-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1092-9"><a href="TimeSeriesAnalysis.html#cb1092-9" tabindex="-1"></a><span class="co">#&gt; data:  coredata(xts_obj)</span></span>
<span id="cb1092-10"><a href="TimeSeriesAnalysis.html#cb1092-10" tabindex="-1"></a><span class="co">#&gt; Dickey-Fuller = -3, Lag order = 5, p-value = 0.3</span></span>
<span id="cb1092-11"><a href="TimeSeriesAnalysis.html#cb1092-11" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: stationary</span></span></code></pre></div>
<p>The <code>adf.test</code> function massages your data before performing the ADF
test. First it automatically detrends your data, and then it recenters the
data, giving it a mean of 0.</p>
<p>If either detrending or recentering is undesirable for your application,
use the <code>adfTest</code> function in the <code>fUnitRoots</code> package instead:</p>
<div class="sourceCode" id="cb1093"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1093-1"><a href="TimeSeriesAnalysis.html#cb1093-1" tabindex="-1"></a><span class="fu">library</span>(fUnitRoots)</span>
<span id="cb1093-2"><a href="TimeSeriesAnalysis.html#cb1093-2" tabindex="-1"></a><span class="fu">adfTest</span>(<span class="fu">coredata</span>(ts1), <span class="at">type =</span> <span class="st">&quot;nc&quot;</span>)</span></code></pre></div>
<p>With <code>type = "nc"</code>, the function neither detrends nor recenters your data.
With <code>type = "c"</code>, the function recenters your data but does not detrend
it.</p>
<p>Both the <code>adf.test</code> and the <code>adfTest</code> functions let you specify a lag
value that controls the exact statistic they calculate. These functions
provide reasonable defaults, but serious users should study the
textbook description of the ADF test to determine the appropriate lag
for their application.</p>
</div>
<div id="see_also-id087" class="section level3 unnumbered hasAnchor">
<h3>See Also<a href="TimeSeriesAnalysis.html#see_also-id087" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>urca</code> and <code>CADFtest</code> packages also implement tests for a unit root,
which is the test for mean reversion. Be careful when comparing the
tests from several packages. Each package can make slightly different
assumptions, which can lead to puzzling differences in the results.</p>
</div>
</div>
<div id="recipe-id195" class="section level2 hasAnchor" number="14.24">
<h2><span class="header-section-number">14.24</span> Smoothing a Time Series<a href="TimeSeriesAnalysis.html#recipe-id195" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="problem-id195" class="section level3 unnumbered hasAnchor">
<h3>Problem<a href="TimeSeriesAnalysis.html#problem-id195" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You have a noisy time series. You want to smooth the data to eliminate
the noise.</p>
</div>
<div id="solution-id195" class="section level3 unnumbered hasAnchor">
<h3>Solution<a href="TimeSeriesAnalysis.html#solution-id195" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>KernSmooth</code> package contains functions for smoothing. Use the
<code>dpill</code> function to select an initial bandwidth parameter, and then use the
<code>locploy</code> function to smooth the data:</p>
<div class="sourceCode" id="cb1094"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1094-1"><a href="TimeSeriesAnalysis.html#cb1094-1" tabindex="-1"></a><span class="fu">library</span>(KernSmooth)</span>
<span id="cb1094-2"><a href="TimeSeriesAnalysis.html#cb1094-2" tabindex="-1"></a></span>
<span id="cb1094-3"><a href="TimeSeriesAnalysis.html#cb1094-3" tabindex="-1"></a>gridsize <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb1094-4"><a href="TimeSeriesAnalysis.html#cb1094-4" tabindex="-1"></a>bw <span class="ot">&lt;-</span> <span class="fu">dpill</span>(t, y, <span class="at">gridsize =</span> gridsize)</span>
<span id="cb1094-5"><a href="TimeSeriesAnalysis.html#cb1094-5" tabindex="-1"></a>lp <span class="ot">&lt;-</span> <span class="fu">locpoly</span>(<span class="at">x =</span> t, <span class="at">y =</span> y, <span class="at">bandwidth =</span> bw, <span class="at">gridsize =</span> gridsize)</span>
<span id="cb1094-6"><a href="TimeSeriesAnalysis.html#cb1094-6" tabindex="-1"></a>smooth <span class="ot">&lt;-</span> lp<span class="sc">$</span>y</span></code></pre></div>
<p>Here, <code>t</code> is the time variable and <code>y</code> is the time series.</p>
</div>
<div id="discussion-id195" class="section level3 unnumbered hasAnchor">
<h3>Discussion<a href="TimeSeriesAnalysis.html#discussion-id195" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>KernSmooth</code> package is a standard part of the R distribution. It
includes the <code>locpoly</code> function, which constructs, around each
data point, a polynomial that is fitted to the nearby data points.
These are called <em>local polynomials</em>. The local polynomials are strung
together to create a smoothed version of the original data series.</p>
<p>The algorithm requires a bandwidth parameter to control the degree of
smoothing. A small bandwidth means less smoothing, in which case the
result follows the original data more closely. A large bandwidth means
more smoothing, so the result contains less noise. The tricky part is
choosing just the right bandwidth: not too small, not too large.</p>
<p>Fortunately, <code>KernSmooth</code> also includes the function <code>dpill</code> for
estimating the appropriate bandwidth, and it works quite well.
We recommend that you start with the <code>dpill</code> value and then experiment with
values above and below that starting point. There is no magic formula
here. You need to decide what level of smoothing works best in your
application.</p>
<p>The following is an example of smoothing. We’ll create some example data that is the sum of a simple sine wave and normally distributed “noise”:</p>
<div class="sourceCode" id="cb1095"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1095-1"><a href="TimeSeriesAnalysis.html#cb1095-1" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">201</span>)</span>
<span id="cb1095-2"><a href="TimeSeriesAnalysis.html#cb1095-2" tabindex="-1"></a>noise <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">201</span>)</span>
<span id="cb1095-3"><a href="TimeSeriesAnalysis.html#cb1095-3" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">sin</span>(t) <span class="sc">+</span> noise</span></code></pre></div>
<p>Both <code>dpill</code> and <code>locpoly</code> require a grid size—in other words, the number of
points for which a local polynomial is constructed.
We often use a grid size equal to the number of data points, which yields a fine resolution.
The resulting time series is very smooth. You might use a smaller grid
size if you want a coarser resolution or if you have a very large
dataset:</p>
<div class="sourceCode" id="cb1096"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1096-1"><a href="TimeSeriesAnalysis.html#cb1096-1" tabindex="-1"></a><span class="fu">library</span>(KernSmooth)</span>
<span id="cb1096-2"><a href="TimeSeriesAnalysis.html#cb1096-2" tabindex="-1"></a>gridsize <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb1096-3"><a href="TimeSeriesAnalysis.html#cb1096-3" tabindex="-1"></a>bw <span class="ot">&lt;-</span> <span class="fu">dpill</span>(t, y, <span class="at">gridsize =</span> gridsize)</span></code></pre></div>
<p>The <code>locpoly</code> function performs the smoothing and returns a list. The
<code>y</code> element of that list is the smoothed data:</p>
<div class="sourceCode" id="cb1097"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1097-1"><a href="TimeSeriesAnalysis.html#cb1097-1" tabindex="-1"></a>lp <span class="ot">&lt;-</span> <span class="fu">locpoly</span>(<span class="at">x =</span> t, <span class="at">y =</span> y, <span class="at">bandwidth =</span> bw, <span class="at">gridsize =</span> gridsize)</span>
<span id="cb1097-2"><a href="TimeSeriesAnalysis.html#cb1097-2" tabindex="-1"></a>smooth <span class="ot">&lt;-</span> lp<span class="sc">$</span>y</span>
<span id="cb1097-3"><a href="TimeSeriesAnalysis.html#cb1097-3" tabindex="-1"></a></span>
<span id="cb1097-4"><a href="TimeSeriesAnalysis.html#cb1097-4" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1097-5"><a href="TimeSeriesAnalysis.html#cb1097-5" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb1097-6"><a href="TimeSeriesAnalysis.html#cb1097-6" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> smooth), <span class="at">linetype =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:smoothplot"></span>
<img src="14_TimeSeriesAnalysis_files/figure-html/smoothplot-1.png" alt="Example time series plot" width="85%" />
<p class="caption">
Figure 14.20: Example time series plot
</p>
</div>
<p>In Figure <a href="TimeSeriesAnalysis.html#fig:smoothplot">14.20</a>, the smoothed data is shown
as a dashed line, while the solid line is our original example data. The figure demonstrates that <code>locpoly</code> did an
excellent job of extracting the original sine wave.</p>
</div>
<div id="see_also-id195" class="section level3 unnumbered hasAnchor">
<h3>See Also<a href="TimeSeriesAnalysis.html#see_also-id195" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>ksmooth</code>, <code>lowess</code>, and <code>HoltWinters</code> functions in the base
distribution can also perform smoothing. The <code>expsmooth</code> package
implements exponential smoothing.</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="5">
<li id="fn5"><p>Specifically: the <code>bonds</code> variable is the log-returns of the
Vanguard Long-Term Bond Index Fund (VBLTX), and the <code>cmdtys</code> variable is the
log-returns of the Invesco DB Commodity Tracking Fund (DBC). The data
was taken from the period 2007-01-01 through 2017-12-31.<a href="TimeSeriesAnalysis.html#fnref5" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="BeyondBasics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="SimpleProgramming.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": true,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/CerebralMastication/R-Cookbook/edit/master/14_TimeSeriesAnalysis.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
